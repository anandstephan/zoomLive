/*! For license information please see video_s.min.js.LICENSE.txt */
!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=35)}([function(e,t,r){"use strict";r.r(t),r.d(t,"Audio_Dec_WASM_OK",(function(){return n})),r.d(t,"Audio_Dec_Handle_OK",(function(){return a})),r.d(t,"Audio_Dec_WebSocket_OK",(function(){return i})),r.d(t,"Audio_Enc_WASM_OK",(function(){return o})),r.d(t,"Audio_Enc_Handle_OK",(function(){return s})),r.d(t,"Video_Dec_WASM_OK",(function(){return d})),r.d(t,"Video_Dec_Handle_OK",(function(){return u})),r.d(t,"Video_Dec_WebSocket_OK",(function(){return c})),r.d(t,"Video_Enc_WASM_OK",(function(){return l})),r.d(t,"Video_Enc_Handle_OK",(function(){return _})),r.d(t,"Sharing_Dec_WASM_OK",(function(){return f})),r.d(t,"Sharing_Dec_PICTURE",(function(){return h})),r.d(t,"AUDIO_DELAY",(function(){return p})),r.d(t,"Sharing_Dec_WebSocket_OK",(function(){return m})),r.d(t,"Sharing_Handle_OK",(function(){return v})),r.d(t,"Sharing_Data",(function(){return g})),r.d(t,"DECODE_MESSAGE",(function(){return y})),r.d(t,"Video_Capture_Tick",(function(){return S})),r.d(t,"MONITOR_MESSAGE",(function(){return E})),r.d(t,"SHARING_DECODE_MONITOR_MESSAGE",(function(){return b})),r.d(t,"WORKER_MAIN_VIDEO_ENCODE_RINGBUFFER_TICK",(function(){return M})),r.d(t,"WORKER_MAIN_AUDIO_ENCODE_RINGBUFFER_TICK",(function(){return A})),r.d(t,"WORKER_MAIN_VIDEO_DECODE_RINGBUFFER_TICK",(function(){return w})),r.d(t,"Audio_Encode_Preview_OK",(function(){return T})),r.d(t,"Video_Encode_Preview_OK",(function(){return R})),r.d(t,"QOS_MONITORING",(function(){return F})),r.d(t,"QOS_DEFAULT_POLLING_INTERVAL",(function(){return D})),r.d(t,"VIDEO_MONITOR_LOG_SECOENDS",(function(){return k})),r.d(t,"DOWNLOAD_WASM_FROM_MAIN_THREAD",(function(){return I})),r.d(t,"APP_TROUBLESHOOTING_INFO",(function(){return C})),r.d(t,"DELTA_D",(function(){return O})),r.d(t,"DELTA_C",(function(){return x})),r.d(t,"DELTA_S",(function(){return P})),r.d(t,"WCL_TROUBLESHOOTING_INFO",(function(){return L})),r.d(t,"SHARING_DATA_VIDEO_MODE",(function(){return U})),r.d(t,"MOUSE_DATA_VIDEO_MODE",(function(){return V})),r.d(t,"SHARING_DECODE_MESSAGE",(function(){return N})),r.d(t,"VIDEO_ENCODED_DATA",(function(){return B})),r.d(t,"VIDEO_DROP_RATIO_FROM_WCL",(function(){return H})),r.d(t,"VIDEO_DATA_DROP_RATIO",(function(){return W})),r.d(t,"AUDIO_ENCODED_DATA",(function(){return G})),r.d(t,"THREAD_STATE_IDLE",(function(){return j})),r.d(t,"THREAD_STATE_CREATING",(function(){return q})),r.d(t,"THREAD_STATE_CREATED",(function(){return Y})),r.d(t,"THREAD_ENCODE_BUFFER",(function(){return K})),r.d(t,"WASMPTR",(function(){return Q})),r.d(t,"AUDIO_MONITOR_LOG",(function(){return X})),r.d(t,"WhiteBoard_Video_Capture_Tick",(function(){return z})),r.d(t,"GLOBAL_TRACING_LOG",(function(){return Z})),r.d(t,"Audio_Dec_WASM_FAILED",(function(){return J})),r.d(t,"Audio_Dec_Handle_FAILED",(function(){return $})),r.d(t,"Audio_Dec_WebSocket_FAILED",(function(){return ee})),r.d(t,"Audio_Enc_WASM_FAILED",(function(){return te})),r.d(t,"Audio_Enc_Handle_FAILED",(function(){return re})),r.d(t,"Video_Dec_WASM_FAILED",(function(){return ne})),r.d(t,"Video_Dec_Handle_FAILED",(function(){return ae})),r.d(t,"Video_Dec_WebSocket_FAILED",(function(){return ie})),r.d(t,"Video_Enc_WASM_FAILED",(function(){return oe})),r.d(t,"Video_Enc_Handle_FAILED",(function(){return se})),r.d(t,"Sharing_Dec_WASM_FAILED",(function(){return de})),r.d(t,"Audio_Mute",(function(){return ue})),r.d(t,"Sharing_Handle_FAILED",(function(){return ce})),r.d(t,"Sharing_Dec_WebSocket_FAILED",(function(){return le})),r.d(t,"AUDIO_CLIPPING",(function(){return _e})),r.d(t,"MULTIVIEW_WEBGL_CONTEXT_LOST",(function(){return fe})),r.d(t,"WEBGL_CONTEXT_CREATE_FAILED",(function(){return he})),r.d(t,"MEDIA_VIDEO_REPORT_DROP_RATIO",(function(){return pe})),r.d(t,"MEDIA_S2C_KEEPALIVE",(function(){return me})),r.d(t,"MEDIA_AUDIO_DATA",(function(){return ve})),r.d(t,"MEDIA_AUDIO_RTCP",(function(){return ge})),r.d(t,"MEDIA_VIDEO_DATA",(function(){return ye})),r.d(t,"MEDIA_VIDEO_RTCP",(function(){return Se})),r.d(t,"MEDIA_NTP_UPDATE",(function(){return Ee})),r.d(t,"VIDEO_CAPTURER_RESOLUTION_360P",(function(){return be})),r.d(t,"VIDEO_CAPTURER_RESOLUTION_720P",(function(){return Me})),r.d(t,"CURRENT_VIDEO_RESOLUTION",(function(){return Ae})),r.d(t,"VIDEO_RENDER_MONITOR_LOG",(function(){return we})),r.d(t,"Sharing_Width_And_Height_Info",(function(){return Te})),r.d(t,"SHARING_RENDER_MONITOR_LOG",(function(){return Re})),r.d(t,"SHARING_GET_IMAGE_DATA_WRONG",(function(){return Fe})),r.d(t,"AES_GCM_IV_TO_WASM",(function(){return De})),r.d(t,"AES_GCM_IV_CALLBACK_FROM_WASM",(function(){return ke})),r.d(t,"CURRENT_SSRC_TIME",(function(){return Ie})),r.d(t,"CURRENT_DECODE_VIDEO_QUALITY",(function(){return Ce})),r.d(t,"CURRENT_DECODE_VIDEO_FPS",(function(){return Oe})),r.d(t,"CURRENT_CAPTURE_VIDEO_WIDTH_HEIGHT",(function(){return xe})),r.d(t,"CURRENT_DESKTOP_SHARING_WIDTH_HEIGHT",(function(){return Pe})),r.d(t,"SHARING_FIRST_DECODE_FRAME_RECEIVED",(function(){return Le})),r.d(t,"VIDEO_CAPTURER_RESOLUTION_CHANGE",(function(){return Ue})),r.d(t,"VIDEO_CAPTURE_FRAME_COUNT_STATISTIC",(function(){return Ve})),r.d(t,"SHARING_CAPTURE_FRAME_COUNT_STATISTIC",(function(){return Ne})),r.d(t,"UNSUPPORTED_SHARING_FORMAT",(function(){return Be})),r.d(t,"UNSUPPORTED_VIDEO_FORMAT",(function(){return He})),r.d(t,"FIRST_SHARING_FRAME_FOR_MOBILE",(function(){return We})),r.d(t,"VB_PTHREAD_MODEL_ALL_READY",(function(){return Ge})),r.d(t,"UPDATE_ENCRYPTION_GCM_MODEL_KEY",(function(){return je})),r.d(t,"CONNECT_WEBTRANSPORT_OK",(function(){return qe})),r.d(t,"CONNECT_WEBTRANSPORT_CLOSE",(function(){return Ye})),r.d(t,"CURRENT_MEDIA_DATA_TRANSPORT_TYPE",(function(){return Ke})),r.d(t,"CONNECT_WEBSOCKET_CLOSE",(function(){return Qe})),r.d(t,"CURRENT_ENCODED_TYPE",(function(){return Xe})),r.d(t,"WHITEBOARD_WORKER_MESSAGE",(function(){return ze})),r.d(t,"INTERPRETATION_ENABLE",(function(){return Ze})),r.d(t,"INTERPRETATION_SET_LANG",(function(){return Je})),r.d(t,"INTERPRETATION_MUTE",(function(){return $e})),r.d(t,"INTERPRETATION_SET_INTERPRETER",(function(){return et})),r.d(t,"serverHeartbeatMaxTimeoutSeconds",(function(){return tt})),r.d(t,"RQUEST_ANIMATION_MODE",(function(){return rt})),r.d(t,"SET_INTERVAL_MODE",(function(){return nt})),r.d(t,"VIDEO_INVALID",(function(){return at})),r.d(t,"VIDEO_RGBA",(function(){return it})),r.d(t,"VIDEO_I420",(function(){return ot})),r.d(t,"VIDEO_NV12",(function(){return st})),r.d(t,"VIDEO_BGRA",(function(){return dt})),r.d(t,"EVENT_ROLLBACK_BUFFER",(function(){return ut})),r.d(t,"EVENT_NEEDMORE_DATA",(function(){return ct})),r.d(t,"EVENT_CAPTURE_DATA",(function(){return lt})),r.d(t,"EVENT_CACHE_SIZE",(function(){return _t})),r.d(t,"WEBCODEC_ENCODE_OPEN_FLAG",(function(){return ft})),r.d(t,"VB_SIGNAL_TYPE_SET_BG",(function(){return ht})),r.d(t,"VB_SIGNAL_TYPE_SET_BLUR",(function(){return pt})),r.d(t,"QosSession",(function(){return mt})),r.d(t,"QosConnectType",(function(){return vt})),r.d(t,"MAX_VIDEO_CAPTURE_FPS",(function(){return gt})),r.d(t,"MIN_VIDEO_CAPTURE_FPS",(function(){return yt})),r.d(t,"VIDEO_CAPTURE_FPS",(function(){return St})),r.d(t,"VIDEO_CAPTURE_20FPS",(function(){return Et})),r.d(t,"DOWN_VIDEO_CAPTURE_FPS",(function(){return bt})),r.d(t,"LOWER_VIDEO_CAPTURE_FPS",(function(){return Mt})),r.d(t,"VIDEO_DATA_MAX_SIZE",(function(){return At})),r.d(t,"SHARING_NULL",(function(){return wt})),r.d(t,"SHARING_NORMAL",(function(){return Tt})),r.d(t,"SHARING_VIDEO_MODE",(function(){return Rt})),r.d(t,"SHARING_VIDEO_MODE_CAPTURED_FPS",(function(){return Ft})),r.d(t,"SHARING_NORMAL_MODE_CAPTURED_FPS",(function(){return Dt})),r.d(t,"VIDEO_RINGBUF_PKG_NUM",(function(){return kt})),r.d(t,"NETWORK_QUALITY_CHANGE",(function(){return It})),r.d(t,"ADDITIONNAL_MULTITHREAD_NUMBER_ENCODE_FOR_360P",(function(){return Ct})),r.d(t,"ADDITIONNAL_MULTITHREAD_NUMBER_ENCODE_FOR_720P",(function(){return Ot})),r.d(t,"WCL_PLATFORM_TYPE",(function(){return xt})),r.d(t,"RENDER_MODE_RAF",(function(){return Pt})),r.d(t,"RENDER_MODE_INTERVAL",(function(){return Lt}));var n=1,a=2,i=3,o=4,s=5,d=7,u=8,c=9,l=10,_=11,f=12,h=13,p=14,m=15,v=16,g=17,y=18,S=20,E=21,b=3021,M=22,A=23,w=24,T=26,R=27,F="QosMonitoring",D=1e3,k=5,I=30,C=31,O=32,x=33,P=34,L=35,U=36,V=37,N=38,B=39,H=40,W=41,G=42,j=43,q=44,Y=45,K=46,Q=47,X=48,z=60,Z=61,J=-1,$=-2,ee=-3,te=-4,re=-5,ne=-7,ae=-8,ie=-9,oe=-10,se=-11,de=-12,ue=-13,ce=-14,le=-15,_e=-23,fe=-26,he=-27,pe=100,me=0,ve=1,ge=6,ye=2,Se=7,Ee=9,be=10,Me=11,Ae=50,we=51,Te=52,Re=53,Fe=54,De=55,ke=56,Ie=57,Ce=66.5,Oe=66.6,xe=67,Pe=68,Le=69,Ue=71,Ve=72,Ne=73,Be=75,He=76,We=78,Ge=95,je=102,qe=105,Ye=106,Ke=107,Qe=108,Xe=109,ze=120,Ze=0,Je=1,$e=2,et=3,tt=65,rt=0,nt=1,at=-1,it=0,ot=1,st=2,dt=3,ut=0,ct=1,lt=2,_t=3,ft=!0,ht=0,pt=1,mt={SESSION_TYPE_CONF:0,SESSION_TYPE_AUDIO:1,SESSION_TYPE_DESKSHARE:2,SESSION_TYPE_VIDEO:3,SESSION_TYPE_CHAT:4,SESSION_TYPE_TELEPHONE:5,SESSION_TYPE_ZC_PING:6,SESSION_TYPE_TOTAL_CNT:7},vt={CONNECT_TYPE_UDP:0,CONNECT_TYPE_TCP:1},gt=30,yt=1,St=24,Et=20,bt=15,Mt=10,At=8294400,wt=0,Tt=1,Rt=2,Ft=15,Dt=5,kt=400,It="NETWORK_QUALITY_CHANGE",Ct=3,Ot=7,xt={DESKTOP:0,MOBILE:1,ANDROID:2,IPHONE:3},Pt=0,Lt=1},function(e,t,r){"use strict";r.d(t,"g",(function(){return _})),r.d(t,"e",(function(){return f})),r.d(t,"d",(function(){return h})),r.d(t,"i",(function(){return p})),r.d(t,"f",(function(){return m})),r.d(t,"h",(function(){return y})),r.d(t,"a",(function(){return E})),r.d(t,"c",(function(){return b})),r.d(t,"b",(function(){return M})),r.d(t,"j",(function(){return F}));var n=r(5),a=r.n(n),i=r(3),o=r.n(i),s=r(4),d=r.n(s),u=r(2),c=r.n(u),l=r(0);function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;postMessage({status:l.GLOBAL_TRACING_LOG,errorMessage:e,errorEvent:t})}function f(e){postMessage({status:l.WCL_TROUBLESHOOTING_INFO,data:e})}function h(e){postMessage({status:l.AUDIO_MONITOR_LOG,data:e})}function p(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];postMessage({status:l.MULTIVIEW_WEBGL_CONTEXT_LOST,canvasId:e,replaceCanvas:t})}function m(e){postMessage({status:l.WEBGL_CONTEXT_CREATE_FAILED,canvasId:e})}function v(e){return e.split("/").pop().split("?")[0].split("#")[0]}var g=0;function y(e,t,r,n,a,i,o){var s,d,u,c;if(f("instantiateCachedURL"),a)u=i,c=o;else if(s=self.wasmSuccessEvent,d=self.wasmFailEvent,u=self.databaseName,c=self.databaseDataType,v(t).includes("audio")){var p={};p.databaseName=u,p.databaseDataType=c,p.dbVersion=e,p.url=t,postMessage({status:"AUDIO_WASM_INFO",data:p})}function m(e,t){return f("fetch_wasm"),function(e){var t=self;return new Promise((function(r,n){t.addEventListener("message",(function(e){var t=e.data;"DOWNLOAD_WASM_FROM_MAIN_THREAD_OK"===t.command&&(f("DE"),r(t.data)),"DOWNLOAD_WASM_FROM_MAIN_THREAD_FAILED"===t.command&&n()})),f("DS"),postMessage({status:l.DOWNLOAD_WASM_FROM_MAIN_THREAD,url:e})}))}(e)}function S(t){return f("fetchAndInstantiate"+t),new Promise((function(i,o){try{if(indexedDB){var s,d=void 0===IDBTransaction.READ_WRITE?"readwrite":IDBTransaction.READ_WRITE,l=indexedDB.open(u,e);l.onerror=function(e){f("request error");var n=indexedDB.deleteDatabase(u);n.onerror=function(e){f("rt error"),console.log("Error deleting database")},n.onsuccess=function(e){f("rt success"),console.log("Database deleted successfully")},i(!a&&m(t).then((function(e){f("CS");var t=WebAssembly.instantiate(e,r);return f("CE"),t})))},l.onsuccess=function(e){if(f("request success"),!(s=e.target.result).objectStoreNames.contains("file"))return a?void i(!1):void i(m(t).then((function(e){f("CS");var t=WebAssembly.instantiate(e,r);f("CE");try{s.objectStoreNames.contains("file")||indexedDB.deleteDatabase(u)}catch(e){}return t})));var o=s.transaction(["file"],d).objectStore("file").get(c);o.onsuccess=function(e){if(f("getRet success"),o.result&&!n){f("result ok");var u=e.target.result;if(a)return i(u);f("CS");var l=WebAssembly.instantiate(u,r);return f("CE"),i(l)}f("result null"),i(!a&&m(t).then((function(e){s.transaction(["file"],d).objectStore("file").put(e,c),f("CS");var t=WebAssembly.instantiate(e,r);return f("CE"),t})))},o.onerror=function(e){f("getRet error"),i(!a&&m(t).then((function(e){f("CS");var t=WebAssembly.instantiate(e,r);return f("CE"),t})))}},l.onupgradeneeded=function(e){var t;f("request upgradeneeded"),(t=e.target.result).objectStoreNames.contains("file")&&t.deleteObjectStore("file"),t.createObjectStore("file")}}else{if(f("indexedDB null"),a)return void i(!1);i(m(t).then((function(e){f("CS");var t=WebAssembly.instantiate(e,r);return f("CE"),t})))}}catch(e){if(h("error"),a)return void i(!1);i(m(t).then((function(e){f("CS");var t=WebAssembly.instantiate(e,r);return f("CE"),t})))}}))}return a?S(t):S(t).then((function(e){var r,n=v(t)||"";g=0,n.includes("video.mt")?function(e){!function(e,t){var r=e.exports;Module.asm=r,registerTLSInit(Module.asm._emscripten_tls_init),wasmTable=Module.asm.__indirect_function_table,addOnInit(Module.asm.__wasm_call_ctors),wasmModule=t,ENVIRONMENT_IS_PTHREAD||removeRunDependency("wasm-instantiate")}(e.instance,e.module)}(e):n.includes("video")?function(e){var t;t=e.instance,e.module,Module.asm=t.exports,updateGlobalBufferAndViews((wasmMemory=Module.asm.memory).buffer),wasmTable=Module.asm.__indirect_function_table,addOnInit(Module.asm.__wasm_call_ctors),removeRunDependency("wasm-instantiate")}(e):(r=e.instance.exports,Module.asm=r,wasmTable=Module.asm.__indirect_function_table,addOnInit(Module.asm.__wasm_call_ctors),removeRunDependency("wasm-instantiate")),self.Fetch_WASM_OK=!0,postMessage({status:s})})).catch((function(n){_("Failed to instantiate WASM ".concat(t),n),n&&n instanceof WebAssembly.CompileError&&g<3?(g++,y(e,t,r,!0)):postMessage({status:d})}))}function S(){var e=this;this.promise=new Promise((function(t,r){e.reject=r,e.resolve=t}))}var E=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15e5;o()(this,e),this.uint8Map={},this.availableIndex=[],this.capacity=t,this.bytesPerElement=r,this.avaiableIndexMap={},this.deferedList=[];for(var n=0;n<t;n++)this.uint8Map[n]=new Uint8Array(r),this.availableIndex.push(n),this.avaiableIndexMap[n]=!0}return d()(e,[{key:"increaseBufferSize",value:function(e){var t=this.bytesPerElement+e;this.bytesPerElement=t;for(var r=0;r<this.capacity;r++){var n=this.uint8Map[r],a=new Uint8Array(t);a.set(n,0),this.uint8Map[r]=a}}},{key:"getCapacity",value:function(){return this.capacity}},{key:"get",value:function(){var e=this;if(this.availableIndex.length>0){var t=this.availableIndex.shift();return this.avaiableIndexMap[t]=!1,new Promise((function(r,n){r({index:t,uint8s:e.uint8Map[t]})}))}var r=new S;return this.deferedList.push(r),r.promise}},{key:"getSync",value:function(){if(this.availableIndex.length>0){var e=this.availableIndex.shift();return this.avaiableIndexMap[e]=!1,{index:e,uint8s:this.uint8Map[e]}}return null}},{key:"recycle",value:function(e){!0!==this.avaiableIndexMap[e]&&(this.avaiableIndexMap[e]=!0,this.availableIndex.push(e),this.deferedList.length>0&&this.deferedList.shift().resolve(this.get()))}}]),e}(),b=function(){function e(t){o()(this,e),this.sharedBufferList=t}return d()(e,[{key:"storeFlexible",value:function(e,t){var r=e.byteLength-this.sharedBufferList.bytesPerElement;if(r>0){var n=Math.floor(.1*this.sharedBufferList.bytesPerElement),a=r>n?r:n;if(a+this.sharedBufferList.bytesPerElement>t)return Promise.reject("too big, more than maxBytesPerElement");this.sharedBufferList.increaseBufferSize(a)}return this.store(e)}},{key:"store",value:function(e){var t=this;return this.sharedBufferList.get().then((function(r){try{return t.obj=r,r.uint8s.set(e,0),t.yuvdata=new Uint8Array(r.uint8s.buffer,0,e.byteLength),!0}catch(e){throw e}finally{t.autoRecycle()}}))}},{key:"storeSync",value:function(e){var t=this.sharedBufferList.getSync();return null!==t&&(this.obj=t,t.uint8s.set(e,0),this.yuvdata=new Uint8Array(t.uint8s.buffer,0,e.byteLength),!0)}},{key:"autoRecycle",value:function(){var e=this;this.autoRecycleInterval=setTimeout((function(){console.log("autoRecycle",e.obj.index),e.recycle()}),5e3)}},{key:"recycle",value:function(){try{this.autoRecycleInterval&&clearInterval(this.autoRecycleInterval),this.sharedBufferList.recycle(this.obj.index)}catch(e){_("Error in YuvWrap.recycle: ".concat(e))}}}]),e}(),M=function(){function e(t){o()(this,e),this.params=t,this.label=this.params.label||"",this.successfulConnectedCount=0,this.connectIndex=0,this.heartbeat=new Uint8Array([104,101,97,114,116,98,101,97,116]),this.transport=null,this.transport_ready=!1,this.isDestroyed=!1}var t,r,n,i,s;return d()(e,[{key:"connect",value:(s=a()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.reconnect();case 1:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"reconnect",value:(i=a()(c.a.mark((function e(){var t,r=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.isReconnectNow||this.isTimerExist||this.isDestroyed)){e.next=2;break}return e.abrupt("return");case 2:this.isReconnectNow=!0,this.isTimerExist=!0,t=Math.pow(2,this.connectIndex)-1,this.connectIndex+=1,setTimeout(a()(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.isDestroyed){e.next=2;break}return e.abrupt("return");case 2:return r.isTimerExist=!1,t=r.params.url,n=new WebTransport(t),r.transport=n,n.closed.then((function(){r.transport_ready=!1,r.params.onclose&&r.params.onclose(r,r.successfulConnectedCount)})).catch((function(e){r.transport_ready=!1,r.params.onerror&&r.params.onerror(e),r.params.onclose(r),r.connectIndex<8&&r.reconnect()})),e.prev=7,r.isReconnectNow=!1,e.next=11,n.ready;case 11:if(!r.isDestroyed){e.next=14;break}return r.close(),e.abrupt("return");case 14:return r.transport_ready=!0,r.successfulConnectedCount++,n.datagrams.incomingMaxAge=3e4,n.datagrams.outgoingMaxAge=3e4,n.datagrams.incomingHighWaterMark=1e4,n.datagrams.outgoingHighWaterMark=1e4,n.datagrams.writable.maxAge=3e4,n.datagrams.readable.maxAge=3e4,r.writer=n.datagrams.writable.getWriter(),r.reader=n.datagrams.readable.getReader(),e.next=26,r.writer.ready;case 26:r.params.onopen(r),e.next=34;break;case 29:return e.prev=29,e.t0=e.catch(7),r.params.onerror&&r.params.onerror(e.t0),r.close(),e.abrupt("return");case 34:r.startHeartbeat(),r.read();case 36:case"end":return e.stop()}}),e,null,[[7,29]])}))),1e3*t);case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"send",value:function(e){this.writer.write(e)}},{key:"sendAwaitReady",value:(n=a()(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.writer.ready;case 2:return e.next=4,this.writer.write(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"startHeartbeat",value:(r=a()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.sleep(3e3);case 3:return e.next=5,this.sendAwaitReady(this.heartbeat);case 5:e.next=0;break;case 7:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"sleep",value:function(e){return new Promise((function(t){return setTimeout(t,e)}))}},{key:"localTime",value:function(){var e=new Date;return"local time : "+e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear()+" @ "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+" "}},{key:"close",value:function(){this.transport_ready=!1,this.transport&&this.transport.close()}},{key:"forceClose",value:function(){this.isDestroyed=!0,this.close()}},{key:"read",value:(t=a()(c.a.mark((function e(){var t,r,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.reader;case 1:return e.next=4,t.read();case 4:if(r=e.sent,n=r.value,!r.done){e.next=9;break}return e.abrupt("break",12);case 9:this.params.onmessage(n),e.next=1;break;case 12:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),A=function(){function e(){o()(this,e),this.ssrcInfoMap=new Map,this.timer=null}return d()(e,[{key:"updateSSRCInfo",value:function(e,t){this.ssrcInfoMap.has(e)||this.ssrcInfoMap.set(e,{timeList:[],lastTime:0,fps:0}),this._calculateFPS(e,t),this._removeZeroFPS(),this._checkIfNewFrameComing()}},{key:"_calculateFPS",value:function(e,t){var r=this.ssrcInfoMap.get(e);if(r.timeList.push(t),r.lastTime=t,r.timeList.length>2){var n=r.timeList[0],a=r.timeList[r.timeList.length-1];if(a-n>=1e3){var i=Math.floor(1e3/((a-n)/(r.timeList.length-1)));r.fps!==i&&(this._notifyFPS(e,i),r.fps=i),r.timeList=[]}}r.timeList.length>30&&(r.timeList=r.timeList.slice(r.timeList.length-30))}},{key:"_removeZeroFPS",value:function(){var e=this;this.ssrcInfoMap.forEach((function(t,r){var n=e.ssrcInfoMap.get(r);n&&Date.now()-n.lastTime>2e3&&(e.ssrcInfoMap.delete(r),e._notifyFPS(r,0))}))}},{key:"_notifyFPS",value:function(e,t){postMessage({status:l.CURRENT_DECODE_VIDEO_FPS,data:{ssrc:e,fps:t}})}},{key:"_checkIfNewFrameComing",value:function(){var e=this;this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout((function(){e._removeZeroFPS(),e.timer=null}),2500)}}]),e}(),w=new Map,T=[90,180,360,720],R=new A;function F(e,t){var r=e.width,n=e.height,a=e.ssrc>>10<<10,i=T.reduce((function(e,t){return Math.abs(e-n)>Math.abs(t-n)?t:e}),T[0]),o=T.findIndex((function(e){return e===i}));if(!w.get(a)||w.get(a).quality!==o){var s={width:r,height:n,ssrc:a,quality:o};w.set(a,s),t?t(s):postMessage({status:l.CURRENT_DECODE_VIDEO_QUALITY,data:s})}R.updateSSRCInfo(a,Date.now())}},function(e,t,r){var n=r(22)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(20);function a(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,n(a.key),a)}}e.exports=function(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function r(e,t,r,n,a,i,o){try{var s=e[i](o),d=s.value}catch(e){return void r(e)}s.done?t(d):Promise.resolve(d).then(n,a)}e.exports=function(e){return function(){var t=this,n=arguments;return new Promise((function(a,i){var o=e.apply(t,n);function s(e){r(o,a,i,s,d,"next",e)}function d(e){r(o,a,i,s,d,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";function n(){this.a=[],this.b=0,this.residue=null}n.prototype.getLength=function(){return this.a.length-this.b},n.prototype.isEmpty=function(){return 0==this.a.length},n.prototype.enqueue=function(e){this.a.push(e)},n.prototype.dequeue=function(){if(0!=this.a.length){var e=this.a[this.b];return 2*++this.b>=this.a.length&&(this.a=this.a.slice(this.b),this.b=0),e}return null},n.prototype.peek=function(){return 0<this.a.length?this.a[this.b]:void 0},n.prototype.clear=function(){this.a=[],this.b=0},t.a=n},function(e,t,r){"use strict";var n=r(10),a=r.n(n),i=r(0);function o(e,t,r,n,a,s){if(this.canvasElement=e,this.contextOptions=n,this.glInitSucceed=0,this.textureindex=t||0,this.texturestride=this.textureindex?3:s?4:6,this.initmask=s||!1,o.prototype.ROTATION_CLOCK0=0,o.prototype.ROTATION_CLOCK90=1,o.prototype.ROTATION_CLOCK180=2,o.prototype.ROTATION_CLOCK270=3,a?this.contextGL=a.contextgl:this.initContextGL(),this.contextGL){this.webGLContextLostProtect(),a?(this.shaderProgram=a.program,this.waterMarkTextureRef=a.waterMarkTextureRef,this.repeatedWaterMarkTextureRef=a.repeatedWaterMarkTextureRef,this.initTextures(!1),this.vertexPosBuffer=a.vBuffer,this.texturePosBuffer=a.tBuffer):(this.initProgram(),this.initmask?this.initTextures(!1):this.initTextures(!0),this.initBuffers());var d=new ArrayBuffer(4);this.dummpyCursor=new Uint8Array(d),this.dummpyWaterMark=new Uint8Array(d);var u=this.contextGL.getError();this.glInitSucceed=u!=this.contextGL.NO_ERROR&&u!=this.contextGL.CONTEXT_LOST_WEBGL?0:1,this.cursorWidth=0,this.cursorHeight=0,this.hasCursor=0,this.hasWaterMark=0,this.watermarkOpacity=.15,this.watermarkData=null,this.watermarkWidth=0,this.watermarkHeight=0,this.isMultiView=!1,this.hasWholeFrame=0,this.croppingParams={},this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.width=0,this.croppingParams.height=0,this.textureWidth=0,this.textureHeight=0,this.canvasWidth=0,this.canvasHeight=0,this.picRotation=-1,this.bgColor=[0,0,0],this.cx=0,this.cy=0,this.cw=0,this.ch=0,this.colorRange=-1,this.videoMode=i.VIDEO_INVALID,this.rotation=this.ROTATION_CLOCK0,this.fillMode=0,this.fillModeForResolution=0}}function s(e,t,r,n,i){var o=e.contextGL,s=n.top/r,d=n.left/t,u=s+(n.height-1)/r,c=d+n.width/t,l=[d,s,c,s,c,u,d,u];i==e.ROTATION_CLOCK90&&(l.unshift(l[6],l[7]),l=l.slice(0,8)),i==e.ROTATION_CLOCK180&&(l.unshift(l[4],l[5],l[6],l[7]),l=l.slice(0,8)),i==e.ROTATION_CLOCK270&&(l.push(l[0],l[1]),l=l.slice(2));var _=l[0],f=l[1];l[0]=l[2],l[1]=l[3],l[2]=_,l[3]=f;var h=new Float32Array([].concat(a()(l),[1,0,0,0,1,1,0,1]));o.bindBuffer(o.ARRAY_BUFFER,e.texturePosBuffer),o.bufferData(o.ARRAY_BUFFER,h,o.DYNAMIC_DRAW)}o.prototype.webGLContextLostSimulate=function(){var e="undefined"==typeof window?self:window;e.webGLEXTSimulate=e.webGLEXTSimulate||[],e.webGLEXTSimulate.push(this.contextGL.getExtension("WEBGL_lose_context")),console.log("\n    webGLEXTSimulate[0].loseContext()\n    webGLEXTSimulate[0].restoreContext()\n    ")},o.prototype.webGLContextLostProtect=function(){var e=this;if(this.contextOptions){var t=this.canvasElement;t.addEventListener("webglcontextlost",(function(t){console.log("webglcontextlost",t),t.preventDefault(),e.contextOptions&&e.contextOptions.webglcontextlostCallback&&e.contextOptions.webglcontextlostCallback(t,e.contextOptions.params)}),{capture:!1,once:!0}),t.addEventListener("webglcontextrestored",(function(t){console.log("webglcontextrestored",t),e.contextOptions&&e.contextOptions.webglcontextrestoredCallback&&e.contextOptions.webglcontextrestoredCallback(t,e.contextOptions.params)}),{capture:!1,once:!0})}},o.prototype.isWebGL=function(){return this.contextGL},o.prototype.initContextGL=function(){for(var e=this.canvasElement,t=null,r=["webgl","experimental-webgl","moz-webgl","webkit-3d"],n=0;!t&&n<r.length;){var a=r[n];try{t=this.contextOptions?e.getContext(a,this.contextOptions):e.getContext(a)}catch(e){t=null}t&&"function"==typeof t.getParameter||(t=null),++n}this.contextGL=t},o.prototype.initProgram=function(){var e=this.contextGL,t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 masktexturePos;","varying vec2 textureCoord;","varying vec2 masktextureCoord;","void main()","{","gl_Position = vertexPos;","textureCoord = texturePos.xy;","masktextureCoord = masktexturePos.xy;","}"].join("\n"),r=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 masktextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform sampler2D cursorSampler;","uniform sampler2D waterMarkSampler;","uniform sampler2D  previewVideoSampler;","uniform sampler2D maskSampler;","uniform vec4 cursorInfo;","uniform int onlyRGBA;","uniform int bgraMode;","uniform int colorRange;","uniform int waterMarkFlag;","uniform int cursorFlag;","uniform int maskFlag;","uniform int yuvmode;","const mat4 YUV2RGB_L = mat4","(","1.1643828125, 0, 1.59602734375, -.87078515625,","1.1643828125, -.39176171875, -.81296875, .52959375,","1.1643828125, 2.017234375, 0, -1.081390625,","0, 0, 0, 1",");","const mat4 YUV2RGB_F = mat4","(","1.0, 0, 1.402, -.701,","1.0, -.34413, -.71414, .529135,","1.0, 1.772, 0, -.886,","0, 0, 0, 1",");","void main(void) {","vec4 c;","if(waterMarkFlag!=1) {","if(onlyRGBA==0){","highp float y = texture2D(ySampler,  textureCoord).r;","highp float u;","highp float v;","if(yuvmode==1){","u = texture2D(uSampler,  textureCoord).r;","v = texture2D(vSampler,  textureCoord).r;","}","else{","u = texture2D(uSampler,  textureCoord).r;","v = texture2D(uSampler,  textureCoord).a;","}","if (colorRange == 0)","{","  c = vec4(y, u, v, 1) * YUV2RGB_L;","} else {","  c = vec4(y, u, v, 1) * YUV2RGB_F;","}","if(cursorFlag==1)","{","if (cursorInfo.z > 0.0 && textureCoord.x >= cursorInfo.x && textureCoord.y >= cursorInfo.y && ","    textureCoord.x < cursorInfo.x+cursorInfo.z && textureCoord.y < cursorInfo.y+cursorInfo.w ){"," vec2 cursorCoord = textureCoord - cursorInfo.xy;"," cursorCoord /= cursorInfo.zw;"," vec4 cursor = texture2D(cursorSampler, cursorCoord);"," c = c*(1.0-cursor.a) + cursor*cursor.a;","}","}","}","else{"," c = texture2D(previewVideoSampler, textureCoord);","if(bgraMode==1)","{"," c = vec4(c.b, c.g, c.r, c.a);","}","}","}","if(waterMarkFlag==1)","{"," c = texture2D(waterMarkSampler, textureCoord);","if(c.r == 0.0 && c.g == 0.0 && c.b == 0.0){"," c.a = 0.0;","}","}","if(maskFlag==1 && waterMarkFlag!=1)","{","vec4 mask = texture2D(maskSampler, masktextureCoord);","if(mask.r != 0.0 || mask.g != 0.0 || mask.b != 0.0){","c = mask* mask.a+ c*(1.0-mask.a);","}","}","if (waterMarkFlag!=1){","c.a = 1.0;","}","gl_FragColor = c;","}"].join("\n"),n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)||e.isContextLost()||console.log("Vertex shader failed to compile: "+e.getShaderInfoLog(n));var a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,r),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)||e.isContextLost()||console.log("Fragment shader failed to compile: "+e.getShaderInfoLog(a));var i=e.createProgram();e.attachShader(i,n),e.attachShader(i,a),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)||e.isContextLost()||console.log("Program failed to compile: "+e.getProgramInfoLog(i)),e.useProgram(i),this.shaderProgram=i},o.prototype.initBuffers=function(){var e=this.contextGL,t=this.shaderProgram,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1,1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var n=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),this.vertexPosBuffer=r;var a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var i=e.getAttribLocation(t,"texturePos");if(e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),this.initmask&&!this.masktexturePosBuffer){var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var s=e.getAttribLocation(t,"masktexturePos");e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),this.masktexturePosBuffer=o}this.texturePosBuffer=a},o.prototype.initTextures=function(e){var t=this.contextGL,r=this.shaderProgram;t.pixelStorei(t.UNPACK_ALIGNMENT,1);var n=this.initTexture();this.yTextureRef=n;var a=this.initTexture();this.uTextureRef=a;var o=this.initTexture();if(this.vTextureRef=o,e){this.BindTextures(i.VIDEO_I420);var s=this.initTexture(),d=t.getUniformLocation(r,"cursorSampler");t.uniform1i(d,this.textureindex*this.texturestride+3),this.cursorTextureRef=s;var u=this.initTexture(),c=t.getUniformLocation(r,"waterMarkSampler");t.uniform1i(c,4),this.waterMarkTextureRef=u;var l=this.initTexture();this.repeatedWaterMarkTextureRef=l;var _=this.initTexture(),f=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(f,this.textureindex*this.texturestride+5),this.previewVideoTextureRef=_;var h=t.getUniformLocation(r,"cursorInfo");this.cursorInfoRef=h}if(this.initmask){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1);var p=this.initTexture(),m=t.getUniformLocation(r,"maskSampler");t.uniform1i(m,this.textureindex*this.texturestride+6),this.maskTextureRef=p}var v=t.getUniformLocation(r,"colorRange");this.colorRangeRef=v,this.onlyRGBARef=t.getUniformLocation(r,"onlyRGBA"),this.bgraModeRef=t.getUniformLocation(r,"bgraMode"),this.waterMarkFlagRef=t.getUniformLocation(r,"waterMarkFlag"),this.maskFlagRef=t.getUniformLocation(r,"maskFlag"),this.cursorFlagRef=t.getUniformLocation(r,"cursorFlag"),this.yuvmodeRef=t.getUniformLocation(r,"yuvmode")},o.prototype.BindTextures=function(e){var t=this.contextGL,r=this.shaderProgram;if(t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.activeTexture(t.TEXTURE0+0),t.bindTexture(t.TEXTURE_2D,this.yTextureRef),t.activeTexture(t.TEXTURE0+1),t.bindTexture(t.TEXTURE_2D,this.uTextureRef),t.activeTexture(t.TEXTURE0+2),t.bindTexture(t.TEXTURE_2D,this.vTextureRef),e==i.VIDEO_I420){var n=t.getUniformLocation(r,"ySampler");t.uniform1i(n,0);var a=t.getUniformLocation(r,"uSampler");t.uniform1i(a,1);var o=t.getUniformLocation(r,"vSampler");t.uniform1i(o,2)}else if(this.isRGBAMode(e)){var s=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(s,0);var d=t.getUniformLocation(r,"ySampler");t.uniform1i(d,0);var u=t.getUniformLocation(r,"uSampler");t.uniform1i(u,0);var c=t.getUniformLocation(r,"vSampler");t.uniform1i(c,0)}else if(e==i.VIDEO_NV12){var l=t.getUniformLocation(r,"ySampler");t.uniform1i(l,0);var _=t.getUniformLocation(r,"uSampler");t.uniform1i(_,1);var f=t.getUniformLocation(r,"vSampler");t.uniform1i(f,0)}var h=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(h,0);var p=t.getUniformLocation(r,"maskSampler");this.initmask?(t.activeTexture(t.TEXTURE0+6),t.bindTexture(t.TEXTURE_2D,this.maskTextureRef),t.uniform1i(p,6)):t.uniform1i(p,0);var m=t.getUniformLocation(r,"cursorSampler");t.uniform1i(m,0);var v=t.getUniformLocation(this.shaderProgram,"waterMarkSampler");t.uniform1i(v,0)},o.prototype.initTexture=function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t},o.prototype.clearDisplay=function(){var e=this.contextGL;e&&(e.enable(e.BLEND),e.blendFunc(e.ZERO,e.ZERO)),this.render()},o.prototype.cleanup=function(){var e=this.contextGL;e&&this.glInitSucceed&&(e.deleteProgram(this.program),e.activeTexture(e.TEXTURE0+this.textureindex*this.texturestride),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE1+this.textureindex*this.texturestride),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE2+this.textureindex*this.texturestride),e.bindTexture(e.TEXTURE_2D,null),this.textureindex||this.initmask||(e.activeTexture(e.TEXTURE3+this.textureindex*this.texturestride),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE4+this.textureindex*this.texturestride),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(this.GetRepeatedWatermarkTextureValue(e)),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE5+this.textureindex*this.texturestride),e.bindTexture(e.TEXTURE_2D,null)),e.bindBuffer(e.ARRAY_BUFFER,null),e.deleteTexture(this.yTextureRef),e.deleteTexture(this.uTextureRef),e.deleteTexture(this.vTextureRef),this.textureindex||this.initmask||(e.deleteTexture(this.cursorTextureRef),e.deleteTexture(this.waterMarkTextureRef),e.deleteTexture(this.repeatedWaterMarkTextureRef),e.deleteTexture(this.previewVideoTextureRef),e.deleteBuffer(this.vertexPosBuffer),e.deleteBuffer(this.texturePosBuffer)),this.maskTextureRef&&e.deleteTexture(this.maskTextureRef),this.masktexturePosBuffer&&e.deleteBuffer(this.masktexturePosBuffer),this.contextGL=null,this.glInitSucceed=0)},o.prototype.drawNextOutputPicture=function(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.contextGL?this.drawNextOuptutPictureGL(e,t,r,n,a):this.drawNextOuptutPictureRGBA(e,t,r,n)},o.prototype.updateVertexInfoForMultiView=function(e,t,r,n,a){var i,o,s,d,u=this.contextGL;if(this.isUseFillMode({width:r,height:n,rotation:a}))i=0,o=0,s=1,d=1;else{var c=a==this.ROTATION_CLOCK90||a==this.ROTATION_CLOCK270?n:r,l=a==this.ROTATION_CLOCK90||a==this.ROTATION_CLOCK270?r:n,_=c/l*t;_>e?(i=0,s=1,d=1-(o=(t-l/c*e)/2/t)):(o=0,d=1,s=1-(i=(e-_)/2/e))}i=2*i-1,s=2*s-1,o=1-2*o,d=1-2*d;var f=new Float32Array([s,o,i,o,s,d,i,d,1,1,-1,1,1,-1,-1,-1]);u.bindBuffer(u.ARRAY_BUFFER,this.vertexPosBuffer),u.bufferData(u.ARRAY_BUFFER,f,u.DYNAMIC_DRAW)},o.prototype.updateTextureInfoForMultiView=function(e,t,r,n,i,o,s){var d,u,c,l,_=this.contextGL;if(this.isUseFillMode({width:r.width,height:r.height,rotation:n})){var f=n==this.ROTATION_CLOCK90||n==this.ROTATION_CLOCK270?s/o:o/s,h=r.left||0,p=r.top||0;if(r.width/r.height>f){var m=r.height*f;d=p/t,u=(Math.round((r.width-m)/2)+h)/e,c=d+(r.height-1)/t,l=u+m/e}else{var v=r.width/f;c=(d=(Math.round((r.height-v)/2)+p)/t)+(v-1)/t,l=(u=h/e)+r.width/e}}else d=r.top/t,u=r.left/e,c=d+(r.height-1)/t,l=u+r.width/e;var g=[u,d,l,d,l,c,u,c];n==this.ROTATION_CLOCK90&&(g.unshift(g[6],g[7]),g=g.slice(0,8)),n==this.ROTATION_CLOCK180&&(g.unshift(g[4],g[5],g[6],g[7]),g=g.slice(0,8)),n==this.ROTATION_CLOCK270&&(g.push(g[0],g[1]),g=g.slice(2));var y=g[0],S=g[1];g[0]=g[2],g[1]=g[3],g[2]=y,g[3]=S,i&&(g[0]=1-g[0],g[2]=1-g[2],g[4]=1-g[4],g[6]=1-g[6]);var E=new Float32Array([].concat(a()(g),[1,0,0,0,1,1,0,1]));_.bindBuffer(_.ARRAY_BUFFER,this.texturePosBuffer),_.bufferData(_.ARRAY_BUFFER,E,_.DYNAMIC_DRAW)},o.prototype.drawNextOuptutPictureGL=function(e,t,r,n,a){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=this.contextGL;if(u&&this.glInitSucceed){this.texturePosBuffer;var c=this.yTextureRef,l=this.uTextureRef,_=this.vTextureRef;u.enable(u.BLEND),u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA),a=a||this.ROTATION_CLOCK0;var f=(r=r||{top:0,left:0,width:e,height:t}).width!=this.croppingParams.width||r.height!=this.croppingParams.height,h=r.top!=this.croppingParams.top||r.left!=this.croppingParams.left,p=u.canvas.width!=this.canvasWidth||u.canvas.height!=this.canvasHeight,m=e!=this.textureWidth||t!=this.textureHeight,v=a!=this.picRotation;(f||p||v)&&function(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=e.contextGL,o=i.canvas.width,s=i.canvas.height;a&&(o=a.width,s=a.height);var d,u,c,l,_=n==e.ROTATION_CLOCK90||n==e.ROTATION_CLOCK270?r:t,f=n==e.ROTATION_CLOCK90||n==e.ROTATION_CLOCK270?t:r,h=_/f*s;h>o?(d=0,c=1,l=1-(u=(s-f/_*o)/2/s)):(u=0,l=1,c=1-(d=(o-h)/2/o)),d=2*d-1,c=2*c-1,u=1-2*u,l=1-2*l;var p=new Float32Array([c,u,d,u,c,l,d,l,c,u,d,u,c,l,d,l]);i.bindBuffer(i.ARRAY_BUFFER,e.vertexPosBuffer),i.bufferData(i.ARRAY_BUFFER,p,i.DYNAMIC_DRAW)}(this,r.width,r.height,a,d),(f||h||m||v)&&s(this,e,t,r,a);var g=o?0:1;g!=this.colorRange&&(u.uniform1i(this.colorRangeRef,g),this.colorRange=g),d?u.viewport(d.x,d.y,d.width,d.height):u.viewport(0,0,u.canvas.width,u.canvas.height),u.uniform1i(this.onlyRGBARef,0),u.uniform1i(this.yuvmodeRef,i.VIDEO_I420),Object.assign(this.croppingParams,r),this.textureWidth=e,this.textureHeight=t,this.picRotation=a,this.canvasWidth=u.canvas.width,this.canvasHeight=u.canvas.height,u.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),u.clear(u.COLOR_BUFFER_BIT);var y=n,S=e*t,E=y.subarray(0,S);u.activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,c),u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,e,t,0,u.LUMINANCE,u.UNSIGNED_BYTE,E);var b=e/2*t/2,M=y.subarray(S,S+b);u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,l),u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,e/2,t/2,0,u.LUMINANCE,u.UNSIGNED_BYTE,M);var A=b,w=y.subarray(S+b,S+b+A);u.activeTexture(u.TEXTURE2),u.bindTexture(u.TEXTURE_2D,_),u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,e/2,t/2,0,u.LUMINANCE,u.UNSIGNED_BYTE,w),u.activeTexture(u.TEXTURE3),u.bindTexture(u.TEXTURE_2D,this.cursorTextureRef),this.hasCursor?u.uniform1i(this.cursorFlagRef,1):u.texImage2D(u.TEXTURE_2D,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,this.dummpyCursor),u.uniform4f(this.cursorInfoRef,this.cx,this.cy,this.cw,this.ch),u.activeTexture(u.TEXTURE5),u.bindTexture(u.TEXTURE_2D,this.previewVideoTextureRef),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,this.dummpyWaterMark);var T=u.getUniformLocation(this.shaderProgram,"maskSampler");u.uniform1i(T,5),this.render(),this.hasWholeFrame=1}},o.prototype.updateTextureBlock=function(e,t,r,n,a){var i=this.contextGL;if(i&&this.glInitSucceed){var o=a;if(!(!this.hasWholeFrame||e<=0||t<=0||r<0||n<0||r+e>this.textureWidth||n+t>this.textureHeight)&&a&&a.length==e*t*3/2){var s=this.yTextureRef,d=this.uTextureRef,u=this.vTextureRef,c=e*t,l=o.subarray(0,c);i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,s),i.texSubImage2D(i.TEXTURE_2D,0,r,n,e,t,i.LUMINANCE,i.UNSIGNED_BYTE,l);var _=e/2*t/2,f=o.subarray(c,c+_);i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,d),i.texSubImage2D(i.TEXTURE_2D,0,r/2,n/2,e/2,t/2,i.LUMINANCE,i.UNSIGNED_BYTE,f);var h=_,p=o.subarray(c+_,c+_+h);i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,u),i.texSubImage2D(i.TEXTURE_2D,0,r/2,n/2,e/2,t/2,i.LUMINANCE,i.UNSIGNED_BYTE,p)}}},o.prototype.updateCursor=function(e,t,r){var n=this.contextGL;n&&this.glInitSucceed&&(e<=0||t<=0||!r||r.length!=e*t*4||(n.activeTexture(n.TEXTURE3),n.bindTexture(n.TEXTURE_2D,this.cursorTextureRef),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,t,0,n.RGBA,n.UNSIGNED_BYTE,r),this.cursorWidth=e,this.cursorHeight=t,this.hasCursor=1))},o.prototype.updateWatherMark=function(e,t,r){this.contextGL&&this.glInitSucceed&&(e<=0||t<=0||!r||r.length!=e*t*4||(this.watermarkData=r,this.watermarkWidth=e,this.watermarkHeight=t,this.hasWaterMark=1))},o.prototype.drawWatermark=function(){var e=this.contextGL;if(this.IsSetWaterMark()&&this.watermarkData&&this.watermarkWidth&&this.watermarkHeight){e.uniform1i(this.waterMarkFlagRef,1),this.IsWatermarkRepeated()?(e.activeTexture(this.GetRepeatedWatermarkTextureValue(e)),e.bindTexture(e.TEXTURE_2D,this.repeatedWaterMarkTextureRef)):(e.activeTexture(e.TEXTURE4),e.bindTexture(e.TEXTURE_2D,this.waterMarkTextureRef)),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.watermarkWidth,this.watermarkHeight,0,e.RGBA,e.UNSIGNED_BYTE,this.watermarkData);var t=e.getUniformLocation(this.shaderProgram,"waterMarkSampler");e.uniform1i(t,this.IsWatermarkRepeated()?this.GetRepeatedWatermarkUniformValue():4),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLE_STRIP,4,4)}},o.prototype.render=function(){var e=this.contextGL;e&&this.glInitSucceed&&(e.uniform1i(this.waterMarkFlagRef,0),e.drawArrays(e.TRIANGLE_STRIP,0,4),this.drawWatermark())},o.prototype.draw=function(e,t,r,n,a){var i=this.contextGL;if(i&&this.glInitSucceed&&!(!this.hasWholeFrame||e&&(n<0||a<0))){i.viewport(0,0,i.canvas.width,i.canvas.height);var o=this.yTextureRef,s=this.uTextureRef,d=this.vTextureRef,u=this.cursorTextureRef;if(i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,s),i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,d),i.activeTexture(i.TEXTURE3),i.bindTexture(i.TEXTURE_2D,u),e&&this.hasCursor){var c=t/this.croppingParams.width,l=r/this.croppingParams.height,_=n/this.croppingParams.width,f=a/this.croppingParams.height;this.cx=c,this.cy=l,this.cw=_,this.ch=f,i.uniform4f(this.cursorInfoRef,c,l,_,f)}else i.uniform4f(this.cursorInfoRef,0,0,0,0);this.render()}},o.prototype.clear=function(){var e=this.contextGL;e&&this.glInitSucceed&&(e.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),e.clear(e.COLOR_BUFFER_BIT),this.hasWholeFrame=0,this.hasCursor=0)},o.prototype.clearCanvas=function(e){var t=this.contextGL;t&&this.glInitSucceed&&(e?t.clearColor(e.R,e.G,e.B,e.A):t.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),t.clear(t.COLOR_BUFFER_BIT))},o.prototype.drawNextOuptutPictureRGBA=function(e,t,r,n){var a=n,i=this.canvasElement.getContext("2d"),o=i.getImageData(0,0,e,t);o.data.set(a),i.putImageData(o,0,0)},o.prototype.isRGBAMode=function(e){return-1!==[i.VIDEO_RGBA,i.VIDEO_BGRA].indexOf(e)},o.prototype.UpdateRemoteVideoTextures=function(e,t,r,n,a){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=this.contextGL;if(s&&this.glInitSucceed){var d=this.yTextureRef,u=this.uTextureRef,c=this.vTextureRef;s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA);var l=this.isRGBAMode(this.videoMode);if(e<=0||t<=0||!n||!n.length||n.length!=e*t*3/2&&!l||r&&(r.top<0||r.left<0||r.left+r.width>e||r.top+r.height>t))return!1;var _=o?0:1;if(this.colorRange=_,this.rotation=a,Object.assign(this.croppingParams,r),this.textureWidth=e,this.textureHeight=t,this.canvasWidth=s.canvas.width,this.canvasHeight=s.canvas.height,s.bindTexture(s.TEXTURE_2D,d),!l){var f=n,h=e*t,p=f.subarray(0,h);s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e,t,0,s.LUMINANCE,s.UNSIGNED_BYTE,p);var m=0,v=0;this.videoMode==i.VIDEO_I420?v=m=e/2*t/2:this.videoMode==i.VIDEO_NV12&&(m=e*t/2,v=0);var g=f.subarray(h,h+m);if(s.bindTexture(s.TEXTURE_2D,u),v){s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e/2,t/2,0,s.LUMINANCE,s.UNSIGNED_BYTE,g);var y=f.subarray(h+m,h+m+v);s.bindTexture(s.TEXTURE_2D,c),s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e/2,t/2,0,s.LUMINANCE,s.UNSIGNED_BYTE,y)}else s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE_ALPHA,e/2,t/2,0,s.LUMINANCE_ALPHA,s.UNSIGNED_BYTE,g);return!0}s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,t,0,s.RGBA,s.UNSIGNED_BYTE,n)}},o.prototype.UpdateRemoteVideoTexturesImageBitmap=function(e,t,r,n,a){var i=this.contextGL;if(i&&this.glInitSucceed){if(e<=0||t<=0||!r)return;this.textureWidth=e,this.textureHeight=t,Number.isNaN(a)||(this.rotation=a),Object.assign(this.croppingParams,n),i.bindTexture(i.TEXTURE_2D,this.yTextureRef);var o=i.RGBA,s=i.RGBA,d=i.UNSIGNED_BYTE;i.texImage2D(i.TEXTURE_2D,0,o,s,d,r)}},o.prototype.updateSelfMaskImage=function(e,t,r){var n=this.contextGL;n&&this.glInitSucceed&&(e<=0||t<=0||!r||r.length!=e*t*4||(n.bindTexture(n.TEXTURE_2D,this.maskTextureRef),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,t,0,n.RGBA,n.UNSIGNED_BYTE,r)))},o.prototype.VideoFlip=function(){var e=this.contextGL;e&&this.glInitSucceed&&e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1)},o.prototype.DrawRemoteVideo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.contextGL;if(r&&this.glInitSucceed){var n=this.isRGBAMode(this.videoMode)?1:0;r.uniform1i(this.colorRangeRef,this.colorRange),this.setUniformFlag(n,this.hasCursor,this.videoMode),this.initmask&&r.uniform1i(this.maskFlagRef,1),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,t,e.width,e.height),r.viewport(e.x,e.y,e.width,e.height),this.updateVertexInfoForMultiView(e.width,e.height,this.croppingParams.width,this.croppingParams.height,this.rotation),this.BindTextures(this.videoMode),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),this.render()}},o.prototype.readPixelsSyncRequest=function(e,t,r,n){var a,i=this.contextGL;return this.destination&&this.destination.length==r*n*4||(this.destination=new Uint8Array(r*n*4)),a=this.destination,i.flush(),i.readPixels(e,t,r,n,i.RGBA,i.UNSIGNED_BYTE,a),a},o.prototype.UpdateSelfVideoTextures=function(e,t,r,n){var a=this.contextGL;a&&this.glInitSucceed&&(e<=0||t<=0||!r||r.length%4!=0||(this.textureWidth=e,this.textureHeight=t,this.rotation=this.ROTATION_CLOCK0,Object.assign(this.croppingParams,n),a.bindTexture(a.TEXTURE_2D,this.yTextureRef),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,e,t,0,a.RGBA,a.UNSIGNED_BYTE,r)))},o.prototype.DrawSelfVideo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.contextGL;n&&this.glInitSucceed&&(this.setUniformFlag(1,this.hasCursor,this.videoMode),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,r,e.width,e.height),n.viewport(e.x,e.y,e.width,e.height),t?(n.enable(n.BLEND),n.blendFunc(n.ZERO,n.ZERO),this.updateVertexInfoForMultiView(e.width,e.height,e.width,e.height,this.ROTATION_CLOCK0)):(n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.updateVertexInfoForMultiView(e.width,e.height,this.croppingParams.width,this.croppingParams.height,this.rotation)),this.BindTextures(i.VIDEO_RGBA),this.render())},o.prototype.IsSetWaterMark=function(){return this.hasWaterMark},o.prototype.SetWaterMarkFlag=function(e){this.hasWaterMark=e,e||(this.SetWatermarkRepeated(!1),this.SetWatermarkOpacity(),this.SetWatermarkPosition(16))},o.prototype.setUniformFlag=function(e,t,r){var n=this.contextGL;n&&(n.uniform1i(this.onlyRGBARef,e),n.uniform1i(this.bgraModeRef,e&&r===i.VIDEO_BGRA?1:0),n.uniform1i(this.cursorFlagRef,t),e||n.uniform1i(this.yuvmodeRef,r))},o.prototype.SetVideoMode=function(e){this.videoMode=e},o.prototype.GetVideoMode=function(e){return this.videoMode},o.prototype.SetWatermarkRepeated=function(e){this.watermarkRepeated=e},o.prototype.IsWatermarkRepeated=function(){return!!this.watermarkRepeated},o.prototype.SetWatermarkOpacity=function(e){this.watermarkOpacity=e||.15},o.prototype.GetWatermarkOpacity=function(){return this.watermarkOpacity},o.prototype.SetWatermarkPosition=function(e){this.watermarkPosition=e||16},o.prototype.GetWatermarkPosition=function(){return this.watermarkPosition},o.prototype.SetMultiView=function(e){return this.isMultiView=e},o.prototype.GetRepeatedWatermarkUniformValue=function(){return this.isMultiView?30:7},o.prototype.GetRepeatedWatermarkTextureValue=function(e){return this.isMultiView?e.TEXTURE30:e.TEXTURE7},o.prototype.setFillMode=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.fillMode=e,this.fillModeForResolution=t},o.prototype.isUseFillMode=function(e){var t=e.width,r=e.height,n=e.rotation;if(!this.fillMode)return!1;if(!this.fillModeForResolution)return!0;if(!t||!r)return!1;var a=n===this.ROTATION_CLOCK90||n==this.ROTATION_CLOCK270?r/t:t/r;return(Array.isArray(this.fillModeForResolution)?this.fillModeForResolution:[this.fillModeForResolution]).some((function(e){return Math.abs(a-e)<.01}))},t.a=o},function(e,t,r){"use strict";var n=r(3),a=r.n(n),i=r(4),o=r.n(i),s=r(6),d=function(){function e(){a()(this,e),this._highFrequencyLogs={}}return o()(e,[{key:"setInstance",value:function(e){this._instance=e}},{key:"getMessageFromErrorEvent",value:function(e,t){var r=e;return t instanceof ErrorEvent?(t.filename&&(r+=" File: ".concat(t.filename)),(t.lineno||t.colno)&&(r+=" Line: ".concat(t.lineno,":").concat(t.colno)),t.message&&(r+=" Message: ".concat(t.message)),t.stack&&(r+="\nStack: ".concat(t.stack))):t instanceof Error&&(t.fileName&&(r+=" File: ".concat(t.fileName)),(t.lineNumber||t.columnNumber)&&(r+=" Line: ".concat(t.lineNumber,":").concat(t.columnNumber)),t.message&&(r+=" Message: ".concat(t.message)),t.stack&&(r+=" Stack: ".concat(t.stack)),t.name&&(r+=" Name: ".concat(t.name))),r}},{key:"error",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e=this.getMessageFromErrorEvent(e,t),this._highFrequencyLogs[e]?this._highFrequencyLogs[e]+=1:this._highFrequencyLogs[e]=1;var r=u(this._highFrequencyLogs[e]);this._instance&&r&&this._instance.error(e)}}]),e}(),u=function(e){return 0==(e&e-1)},c=new d;r.d(t,"b",(function(){return l})),r.d(t,"a",(function(){return _})),r.d(t,"c",(function(){return f}));var l=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t.byteLength,d=arguments.length>6?arguments[6]:void 0;a()(this,e),this.offset=o,this._BYTES_PER_ELEMENT=r,this.capacity=(s-8)/r,this.usableCapacity=this.capacity-1,this.buf=t,this.write_ptr=new Uint32Array(this.buf,o,1),this.read_ptr=new Uint32Array(this.buf,o+4,1),this.storageUint8sByteOffset=o+8,this.storageUint8s=new Uint8Array(this.buf,this.storageUint8sByteOffset,s-8),this.byteLength=s,this.label=n,this.usingOneElementBuffer=i,d&&(this.wasmMemory=d),i&&(this.oneElementBuffer=new ArrayBuffer(r)),this.repushhander=0,this.repushlogcount=0,this.monitorpace=0}return o()(e,[{key:"checkBuffer",value:function(){this.wasmMemory&&this.wasmMemory.buffer!=this.buf&&(console.log("buffer change"),this.buf=this.wasmMemory.buffer,this.storageUint8s=new Uint8Array(this.buf,this.storageUint8sByteOffset,this.byteLength-8))}},{key:"enqueue",value:function(e){return this.push(e)}},{key:"enqueueSafe",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;for(this.dataBuffer||(this.dataBuffer=new s.a);this.dataBuffer.getLength()>0&&this.available_write()>0;){var a=this.dataBuffer.dequeue();a&&this.enqueue(a)}var i=this.dataBuffer.getLength();if(e){if(this.available_write()>0&&0==i)return this.enqueue(e),!0;if(!r)return!1;this.dataBuffer.enqueue(e),++i}if(i>0&&!this.repushhander&&(this.repushhander=setTimeout((function(){t.repushlogcount%10==0&&console.warn("<<< retry consume cache data"),t.repushlogcount++,t.repushhander=0,t.enqueueSafe(null)}),10)),i>=1e3&&(c.error("Cached data in SAB reached critical value, will be cleared"),this.dataBuffer.clear()),i>0&&n){var o=performance.now();(!this.monitorpace||o-this.monitorpace>2e4)&&(this.monitorpace=o,n("vqsl"+i))}return!0}},{key:"push",value:function(e){return e instanceof Array?this._pushArray(e):this._push(e)}},{key:"_pushArray",value:function(e){var t=this,r=Atomics.load(this.read_ptr,0),n=Atomics.load(this.write_ptr,0);if((n+1)%this.capacity==r)return 0;this.checkBuffer();var a=0;e.forEach((function(e){t.storageUint8s.set(e,n*t._BYTES_PER_ELEMENT+8+4+a),a+=e.byteLength})),new Uint32Array(this.buf,this.offset+n*this._BYTES_PER_ELEMENT+8,1)[0]=a;var i=(n+1)%this.capacity;return Atomics.store(this.write_ptr,0,i),{rd:r,wr:i}}},{key:"_push",value:function(e){var t=Atomics.load(this.read_ptr,0),r=Atomics.load(this.write_ptr,0);if((r+1)%this.capacity==t)return 0;this.checkBuffer(),this.storageUint8s.set(e,r*this._BYTES_PER_ELEMENT+8+4,e.byteLength),new Uint32Array(this.buf,this.offset+r*this._BYTES_PER_ELEMENT+8,1)[0]=e.byteLength;var n=(r+1)%this.capacity;return Atomics.store(this.write_ptr,0,n),{rd:t,wr:n}}},{key:"addReadPtr",value:function(){var e=Atomics.load(this.read_ptr,0);Atomics.store(this.read_ptr,0,(e+1)%this.capacity)}},{key:"dequeue",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=Atomics.load(this.read_ptr,0),r=Atomics.load(this.write_ptr,0);if(this._available_read(t,r)<=0)return null;this.checkBuffer();var n,a,i,o=new Uint32Array(this.buf,this.offset+t*this._BYTES_PER_ELEMENT+8,1);if(e){n=this.oneElementBuffer?new Uint8Array(this.oneElementBuffer,0,o[0]):new Uint8Array(o[0]);var s=new Uint8Array(this.storageUint8s.buffer,t*this._BYTES_PER_ELEMENT+8+4+this.storageUint8sByteOffset,n.byteLength);n.set(s,0)}else n=this.storageUint8s.subarray(t*this._BYTES_PER_ELEMENT+8+4,t*this._BYTES_PER_ELEMENT+8+4+o[0]),a=t*this._BYTES_PER_ELEMENT+8+4+this.storageUint8sByteOffset,i=t*this._BYTES_PER_ELEMENT+8+4+o[0]+this.storageUint8sByteOffset;return e&&Atomics.store(this.read_ptr,0,(t+1)%this.capacity),e?n:{bCopyData:e,uint8s:n,begin:a,end:i}}},{key:"available_read",value:function(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_read(e,t)}},{key:"available_write",value:function(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_write(e,t)}},{key:"is_available_write",value:function(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._is_available_write(e,t)}},{key:"_available_read",value:function(e,t){return(t+this.capacity-e)%this.capacity}},{key:"_available_write",value:function(e,t){return this.usableCapacity-this._available_read(e,t)}},{key:"_is_available_write",value:function(e,t){return this._available_write(e,t)>0}},{key:"_storage_capacity",value:function(){return this.capacity}}],[{key:"getStorageForCapacity",value:function(){return new SharedArrayBuffer(8+((arguments.length>0&&void 0!==arguments[0]?arguments[0]:30)+1)*(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500))}}]),e}(),_=function(){function e(t,r,n,i){if(a()(this,e),!(t instanceof l))throw new Error("RingBuffer required");this.rb=t,this.dataCallback=r,this.interval=null,this.requestID=null,this.timeout_call=n,this.tick_lasted_time=0,this.timeoutMS=i>20?i:50}return o()(e,[{key:"consume",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.interval||(this.bCopyData=r,this.interval=setInterval((function(){e._dequeue()}),t),console.log("consume interval ".concat(this.interval)))}},{key:"consumeAll",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.bCopyData=e,this._dequeue()}},{key:"_dequeue",value:function(){if(this.timeout_call){var e=performance.now();if(0!=this.tick_lasted_time){var t=e-this.tick_lasted_time;t>=this.timeoutMS&&this.timeout_call(t,e)}this.tick_lasted_time=e}for(;this.rb.available_read()>0;){var r=this.rb.dequeue(this.bCopyData);this.dataCallback(r),this.bCopyData||this.rb.addReadPtr()}}},{key:"_consumeForAnimationFrame",value:function(){this._dequeue(),this.requestID=requestAnimationFrame(this._consumeForAnimationFrame.bind(this))}},{key:"consumeUsingRequestAnimationFrame",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.requestID||(this.bCopyData=e,this._consumeForAnimationFrame())}},{key:"cancelConsume",value:function(){console.log("cancelConsume interval ".concat(this.interval," requestID ").concat(this.requestID)),this.tick_lasted_time=0,clearInterval(this.interval),this.requestID&&cancelAnimationFrame(this.requestID),this.interval=null,this.requestID=null}}]),e}(),f=function(){function e(){a()(this,e),this.timeStampKey="video_timestamp",this.keysList=["video_ssrc","video_width","video_height","rendering_x","rendering_y","rendering_w","rendering_h","rotation","yuv_limited"],this.bCopyData=null,this.begin=null,this.end=null}return o()(e,[{key:"setOBJ",value:function(e){this.obj=e,this.yuvUint8s=e.data}},{key:"setBuffer",value:function(e){!1===e.bCopyData?(this.objUint8s=e.uint8s,this.bCopyData=e.bCopyData,this.begin=e.begin,this.end=e.end):(this.objUint8s=e,this.bCopyData=!0,this.begin=0,this.end=e.byteLength)}},{key:"buffer2Obj",value:function(){var e=new Uint32Array(this.objUint8s.buffer,this.begin,9),t=new DataView(this.objUint8s.buffer,this.begin+40,16),r={};this.keysList.forEach((function(t,n){r[t]=e[n]})),r[this.timeStampKey]=Number(t.getBigUint64(0,!0));var n,a=Number(t.getBigUint64(8,!0)),i=new Uint8Array(this.objUint8s.buffer,this.begin+40+8+8,a);return this.bCopyData,n=i,r.data=n,r}},{key:"obj2buffer",value:function(){var e=this,t=new Uint8Array(56),r=this.keysList,n=new Uint32Array(t.buffer,0,9),a=new DataView(t.buffer,40,16);return r.forEach((function(t,r){n[r]=e.obj[t]})),a.setBigUint64(0,BigInt(this.obj[this.timeStampKey]),!0),a.setBigUint64(8,BigInt(this.yuvUint8s.byteLength),!0),[t,this.yuvUint8s]}}]),e}()},function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"d",(function(){return a})),r.d(t,"c",(function(){return i})),r.d(t,"e",(function(){return o})),r.d(t,"a",(function(){return s})),r.d(t,"g",(function(){return d})),r.d(t,"f",(function(){return u})),r.d(t,"h",(function(){return c}));var n=3,a=6,i=24,o="SHARING_PARAM_INFO_FROM_SOCKET",s="AUDIO_QOS_DATA",d="VIDEO_QOS_DATA",u="VIDEOSHARE_QOS_DATA",c={VIDEO_ENCODE:"0",VIDEO_DECODE:"1",AUDIO_ENCODE:"2",AUDIO_DECODE:"3",SHARING_ENCODE:"4",SHARING_DECODE:"5"}},function(e,t,r){var n=r(24),a=r(25),i=r(19),o=r(26);e.exports=function(e){return n(e)||a(e)||i(e)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},,function(e,t,r){"use strict";r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return l}));var n=r(6);function a(){this.ssrcQueueMap=new Map,a.prototype.AddQueue=function(e){var t=new n.a;return this.ssrcQueueMap.set(e,t),t},a.prototype.DeleteQueue=function(e){this.ssrcQueueMap.delete(e)},a.prototype.GetQueue=function(e){return this.ssrcQueueMap.get(e)},a.prototype.GetQueueData=function(e){return this.ssrcQueueMap.get(e).dequeue()},a.prototype.PutQueueData=function(e,t){this.ssrcQueueMap.get(e).enqueue(t)},a.prototype.GetQueueLength=function(e){var t=this.ssrcQueueMap.get(e);return null!==t?t.getLength():0}}var i=function(){this.frames=0,this.ntp=new n.a};i.prototype={UpdateVideoInfo:function(e){this.frames++,this.ntp.getLength()>30&&this.ntp.dequeue(),this.ntp.enqueue(e)},GetVideoFpsInfo:function(){var e=this.ntp.getLength();if(!(e<5)){for(var t=0,r=0,n=0,a=0,i=0;i<e;i++){var o=this.ntp.dequeue();0==o&&0==n?r++:0!=o?(a=0,0==n&&(n=o),t=o):0!=n&&t!=n&&0==o&&a++}return 0==t||t==n?0:e-r-a-1!=0?(t-n)/(e-r-a-1):0}}};var o=function(){this.ssrcInfoMap=new Map};function s(){this.ssrcQueueMap=new Map,this.ssrcInfo=new o,s.prototype.AddQueue=function(e){var t=new n.a;return this.ssrcQueueMap.set(e,t),t},s.prototype.DeleteQueue=function(e){this.ssrcQueueMap.delete(e)},s.prototype.GetQueue=function(e){return this.ssrcQueueMap.get(e)},s.prototype.ClearQueue=function(){this.ssrcQueueMap.clear()},s.prototype.GetQueueData=function(e){return this.ssrcQueueMap.get(e).dequeue()},s.prototype.PutQueueData=function(e,t){this.ssrcQueueMap.get(e).enqueue(t)},s.prototype.GetQueueLength=function(e){var t=this.ssrcQueueMap.get(e);return t?t.getLength():0},s.prototype.UpdateInfo=function(e,t){this.ssrcInfo.UpdateSSRCInfo(e,t)},s.prototype.GetFpsInfo=function(e){return this.ssrcInfo.GetSSRCFpsInfo(e)}}function d(){this.map=new Map,this.VideoQueueMGR=new s}o.prototype={UpdateSSRCInfo:function(e,t){var r=this.ssrcInfoMap.get(e);r||(r=new i,this.ssrcInfoMap.set(e,r)),r.UpdateVideoInfo(t)},GetSSRCFpsInfo:function(e){var t=this.ssrcInfoMap.get(e);return t?t.GetVideoFpsInfo():0}},function(){function e(){this.map=new Map,this.AudioQueueMGR=new a,this.timemap=new Map}e.prototype.Add=function(e,t){this.map.set(e,t),this.AudioQueueMGR.AddQueue(e)},e.prototype.Clear=function(){this.map.clear()},e.prototype.Keys=function(){return this.map.keys()},e.prototype.UpdateSSRCTimeMap=function(e){this.timemap=e},e.prototype.GetSSRCTimeMap=function(e){return this.timemap?this.timemap.get(e):null}}(),d.prototype.Add=function(e,t){this.map.set(e,t)},d.prototype.Clear=function(){this.map.clear()},d.prototype.Keys=function(){return this.map.keys()};var u=function(){this.frames=0,this.ntp=new n.a};u.prototype={UpdateSharingInfo:function(e){this.frames++,this.ntp.getLength()>30&&this.ntp.dequeue(),this.ntp.enqueue(e)},GetSharingFpsInfo:function(){var e=this.ntp.getLength();if(!(e<5)){for(var t=0,r=0,n=0,a=0,i=0;i<e;i++){var o=this.ntp.dequeue();0==o&&0==n?r++:0!=o?(a=0,0==n&&(n=o),t=o):0!=n&&t!=n&&0==o&&a++}return 0==t||t==n?0:e-r-a-1!=0?(t-n)/(e-r-a-1):0}}};var c=function(){this.ssrcInfoMap=new Map};function l(){this.ssrcQueueMap=new Map,this.ssrcInfo=new c,l.prototype.AddQueue=function(e){var t=new n.a;return this.ssrcQueueMap.set(e,t),t},l.prototype.DeleteQueue=function(e){this.ssrcQueueMap.delete(e)},l.prototype.GetQueue=function(e){return this.ssrcQueueMap.get(e)},l.prototype.ClearQueue=function(){this.ssrcQueueMap.clear()},l.prototype.GetQueueData=function(e){return this.ssrcQueueMap.get(e).dequeue()},l.prototype.PutQueueData=function(e,t){this.ssrcQueueMap.get(e).enqueue(t)},l.prototype.GetQueueLength=function(e){var t=this.ssrcQueueMap.get(e);return t?t.getLength():0},l.prototype.UpdateInfo=function(e,t){this.ssrcInfo.UpdateSSRCInfo(e,t)},l.prototype.GetFpsInfo=function(e){return this.ssrcInfo.GetSSRCFpsInfo(e)}}function _(){this.map=new Map,this.sQueue=new n.a,this.SharingQueueMGR=new l}c.prototype={UpdateSSRCInfo:function(e,t){var r=this.ssrcInfoMap.get(e);r||(r=new u,this.ssrcInfoMap.set(e,r)),r.UpdateSharingInfo(t)},GetSSRCFpsInfo:function(e){var t=this.ssrcInfoMap.get(e);return t?t.GetSharingFpsInfo():0}},_.prototype.Clear=function(){this.map.clear()},_.prototype.Keys=function(){return this.map.keys()},_.prototype.Add=function(e,t){this.map.set(e,t)},_.prototype.Get=function(e){return this.map.get(e)},_.prototype.PutData=function(e){e&&this.sQueue&&this.sQueue.enqueue(e)},_.prototype.GetData=function(){if(this.sQueue)return this.sQueue.dequeue()},_.prototype.ClearBuffer=function(){this.sQueue&&(this.sQueue=new n.a)}},function(e,t){function r(t){return e.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n={SET_USER_NODE_LIST:"SET_USER_NODE_LIST"}},function(e,t,r){"use strict";r.d(t,"b",(function(){return m}));var n=r(16),a=r.n(n),i=r(32),o=r.n(i),s=r(9),d=r(0),u=r(17),c=r(7),l=r(12),_=r(1);function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){o()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m=function(e,t){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:16/9;if(!e||!t)return null;var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)||0,a=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)||0;if(e/t>r){var i=t*r;return{width:i,height:t,left:Math.round((e-i)/2)+n,top:0+a}}var o=e/r;return{width:e,height:o,left:0+n,top:Math.round((t-o)/2)+a}};function v(e){this.Notify_APPUI=e.Notify_APPUI,this.isSupportOffscreenCanvas=e.isSupportOffscreenCanvas,this.jsMediaEngine=e.jsMediaEngine,this.threadNumbs=e.videodecodethreadnumb,this.globalTracingLogger=e.globalTracingLogger,this.waterMarkCanvas=null,this.videoRenderLevel=10,this.videoRenderLevelCount=1,this.renderPeriodTotal=100,this.renderPeriodCount=0,this.renderPeriodTotalFps=0,this.renderPeriodFpsCount=0,this.lastRenderAudioTimeStamp=0,this.videoBufEmptyCount=0,this.videoBufCount=0,this.videoRenderMaxLevel=15,this.timestamp=0,this.audioPlayTime=0,this.videoTimestamp=0,this.videoWaterMarkName="",this.isCreateVideoWaterMark=!1,this.isWaterMarkRepeatedEnable=!1,this.waterMarkOpacity=.15,this.currentactive=0,this.currentVideoHeight=0,this.currentVideoWidth=0,this.videoRenderArray=[],this.WaterMarkRGBA=new u.a,this.vMonitorCount=0,this.videoQueue=new l.b,this.timestart=0,this.rendingFlag=!0,this.rAFID=0,this.rAFIDBack=null,this.prevRequestAnimationTimestap=0,this.retryRequestAnimationStep=2,this.renderMGR=null,this.ssrcDispalyMap=new Map,this.ssrcHaddataMap=new Map,this.selfvideossrc=0,this.localVideoPtr=0,this.sabBuffer=0,this.localvideossrc=0,this.encodedVideoSharedArrayBufferUint8Array=null,this.encodedVideoSharedArrayBufferUint16Array=null,this.encodedVideoSharedArrayWasmMemory=null,this.startCaptureVideo=!1,this.clearColor=new Uint8Array(4),this.videorendercanvas=null,this.keyrender=null,this.renderIndex=0,this.renderMode=0,this.intervalHandle,this.croppingParams={top:0,left:0,height:1,width:1},this.coordinate={x:0,y:0,width:640,height:360},this.isSupportVideoTrackReader=!1,this.bWebglContextLostProtectingMap=new Map,this.ismirror=!1,this.lfTimeStamp=0,this.activeFps=0,this.lastActiveSSRC=0,this.disableOriginalRatio=!1,this.enableReplaceCanvasWhenContextLost=e.enableReplaceCanvasWhenContextLost}v.prototype.clearUseridRender=function(e,t){var r=e[0],n=r.display;if(n)if(n.SetWaterMarkFlag(0),this.renderMode)n.clearCanvas(t);else{var a=r.ssrc;if(!n||!t)return;this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.height=1,this.croppingParams.width=1,this.clearColor[0]=255*t.R,this.clearColor[1]=255*t.G,this.clearColor[2]=255*t.B,this.clearColor[3]=255*t.A,n.UpdateSelfVideoTextures(1,1,this.clearColor,this.croppingParams);var i=this;this.ssrcDispalyMap.forEach((function(e,t){var r,n;i.Get_Logical_SSrc(t)==i.Get_Logical_SSrc(i.selfvideossrc)&&(r=!0),i.Get_Logical_SSrc(t)==i.Get_Logical_SSrc(a)&&(n=!0),e.forEach((function(e){if(e.haddata||n){var t=e.display;i.coordinate.x=e.x,i.coordinate.y=e.y,i.coordinate.width=e.width,i.coordinate.height=e.height,t&&(n?t.DrawSelfVideo(i.coordinate,!0):t.GetVideoMode()!=d.VIDEO_INVALID&&(-1==[d.VIDEO_RGBA,d.VIDEO_BGRA].indexOf(t.GetVideoMode())&&r?t.DrawSelfVideo(i.coordinate,!1,i.ismirror):r?t.DrawRemoteVideo(i.coordinate,i.ismirror):t.DrawRemoteVideo(i.coordinate)))}}))}))}},v.prototype.Set_Render_Array_rAF=function(e){if(this.videoRenderArray=e,this.ssrcDispalyMap.clear(),this.ssrcHaddataMap.clear(),this.videoRenderArray.length>0)for(var t=0;t<this.videoRenderArray.length;t++){var r=this.ssrcDispalyMap.get(this.Get_Logical_SSrc(this.videoRenderArray[t].ssrc));r?r.push(this.videoRenderArray[t]):((r=[]).push(this.videoRenderArray[t]),this.ssrcDispalyMap.set(this.Get_Logical_SSrc(this.videoRenderArray[t].ssrc),r),this.ssrcHaddataMap.set(this.Get_Logical_SSrc(this.videoRenderArray[t].ssrc),!1))}},v.prototype.Set_Render_Array=function(e,t){this.renderMode?this.Set_Render_Array_IntervalMode(e,t):this.Set_Render_Array_rAF(e)},v.prototype.ClearQueue=function(){this.videoQueue&&this.videoQueue.ClearQueue(),this.currentVideoHeight=0,this.currentVideoWidth=0},v.prototype.Put_Video_Into_Buffer=function(e){if(this.videoQueue){var t=this.videoQueue.GetQueue(e.ssrc);if(t||(t=this.videoQueue.AddQueue(e.ssrc)),t.enqueue(e),this.videoQueue&&this.videoQueue.ssrcInfo){var r=e.ssrc>>10;this.videoQueue.ssrcInfo.UpdateSSRCInfo(r,e.ntptime)}for(var n=this.videoQueue.GetQueueLength(e.ssrc)-10;n>=0;)n--}},v.prototype.Update_RemoteVideo_Texture=function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this.Check_Request_Animation(),r){if(e&&n){var a=this.Get_Logical_SSrc(n),i=this.ssrcDispalyMap.get(a);if(!i)return;var o=this;this.ssrcHaddataMap.set(a,!0),this.croppingParams.top=e.visibleRect?0:e.cropTop,this.croppingParams.left=e.visibleRect?0:e.cropLeft,this.croppingParams.height=e.visibleRect?e.visibleRect.height:e.cropHeight,this.croppingParams.width=e.visibleRect?e.visibleRect.width:e.cropWidth,i&&i.forEach((function(t){t.haddata=!0;var r=t.display;o.coordinate.x=t.x,o.coordinate.y=t.y,o.coordinate.width=t.width,o.coordinate.height=t.height,r&&(r.SetVideoMode(d.VIDEO_RGBA),o.Should_Update_Watermark(r,t.width,t.height,t.width,t.height)&&o.Update_Display_Watermark(r,t.width,t.height,t.width,t.height),e&&r.UpdateRemoteVideoTexturesImageBitmap(o.croppingParams.width,o.croppingParams.height,e,o.croppingParams,e.rotation))}))}}else{if(e&&e.ssrc){var s,u=this.Get_Logical_SSrc(e.ssrc),c=this.ssrcDispalyMap.get(u);if(!c)return void(e.yuvdataptr&&Module._free(e.yuvdataptr));var l=this;this.ssrcHaddataMap.set(u,!0);var _=e;this.croppingParams.top=_.r_y,this.croppingParams.left=_.r_x,this.croppingParams.height=_.r_h,this.croppingParams.width=_.r_w,(s=_).enableMultiDecodeVideoWithoutSAB?s.yuvdata=s.data:s.yuvdata=Module.HEAPU8.subarray(s.yuvdataptr,s.yuvdataptr+s.yuvlength),!s.yuvdata.length||s.yuvdata.length!=s.width*s.height*3/2||this.croppingParams.top<0||this.croppingParams.left<0||this.croppingParams.left+this.croppingParams.width>s.width||this.croppingParams.top+this.croppingParams.height>s.height||c&&c.forEach((function(e){e.haddata=!0;var r=e.display;l.coordinate.x=e.x,l.coordinate.y=e.y,l.coordinate.width=e.width,l.coordinate.height=e.height,r&&(r.SetVideoMode(d.VIDEO_I420),t.Should_Update_Watermark(r,e.width,e.height,e.width,e.height)&&t.Update_Display_Watermark(r,e.width,e.height,e.width,e.height),s&&r.UpdateRemoteVideoTextures(s.width,s.height,l.croppingParams,s.yuvdata,s.rotation,s.yuv_limited,l.coordinate,false))}))}e.yuvdataptr&&Module._free(e.yuvdataptr)}},v.prototype.Set_Cropping_Mode=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.disableOriginalRatio=!!e},v.prototype.Update_Cropping_Params=function(){if(this.disableOriginalRatio){var e=m(this.croppingParams.width,this.croppingParams.height,this.croppingParams.left,this.croppingParams.top);e&&(this.croppingParams=p(p({},this.croppingParams),e))}},v.prototype.Update_SelfVideo_Texture=function(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:d.VIDEO_RGBA,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(i?(this.croppingParams.top=i.top,this.croppingParams.left=i.left,this.croppingParams.width=i.width,this.croppingParams.height=i.height):(this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.height=t,this.croppingParams.width=e),this.renderMode){for(var o=0;o<this.videoRenderArray.length;o++)if(this.Get_Logical_SSrc(this.videoRenderArray[o].ssrc)==this.Get_Logical_SSrc(n)){this.coordinate.x=this.videoRenderArray[o].x,this.coordinate.y=this.videoRenderArray[o].y,this.coordinate.width=this.videoRenderArray[o].width,this.coordinate.height=this.videoRenderArray[o].height,this.Update_Cropping_Params(),this.videoRenderArray[o].display.SetVideoMode(a);var s=this.videoRenderArray[o],u=s.display,c=s.width,l=s.height;this.Should_Update_Watermark(u,c,l,c,l)&&this.Update_Display_Watermark(u,c,l,c,l),-1!==[d.VIDEO_RGBA,d.VIDEO_BGRA].indexOf(a)?(this.videoRenderArray[o].display.UpdateSelfVideoTextures(e,t,r,this.croppingParams),this.videoRenderArray[o].enableMultiDecodeVideoWithoutSAB?this.videoRenderArray[o].firstFrame=!0:this.videoRenderArray[o].display.DrawSelfVideo(this.coordinate,!1,this.ismirror)):(this.videoRenderArray[o].display.UpdateRemoteVideoTextures(e,t,this.croppingParams,r,0,0,this.coordinate,!1),this.videoRenderArray[o].enableMultiDecodeVideoWithoutSAB?this.videoRenderArray[o].firstFrame=!0:this.videoRenderArray[o].display.DrawRemoteVideo(this.coordinate,this.ismirror))}}else if(r&&n){var _=this.ssrcDispalyMap.get(n);this.ssrcHaddataMap.set(n,!0);var f=this;_&&_.forEach((function(n){n.haddata=!0,f.coordinate.x=n.x,f.coordinate.y=n.y,f.coordinate.width=n.width,f.coordinate.height=n.height,f.Update_Cropping_Params();var i=n.display;i&&(i.SetVideoMode(a),f.Should_Update_Watermark(i,n.width,n.height,n.width,n.height)&&f.Update_Display_Watermark(i,n.width,n.height,n.width,n.height),-1!==[d.VIDEO_RGBA,d.VIDEO_BGRA].indexOf(a)?i.UpdateSelfVideoTextures(e,t,r,f.croppingParams):i.UpdateRemoteVideoTextures(e,t,f.croppingParams,r,0,!0,f.coordinate,!1))}))}},v.prototype.Draw_Send_Video_Img=function(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:d.VIDEO_RGBA,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.Update_SelfVideo_Texture(t,r,e,n,a,i)},v.prototype.setMirrorMyVideoOption=function(e){this.ismirror=e},v.prototype.Start_Draw=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return this.rendingFlag=!0,this.renderMode=e,e?t?(this.intervalHandle=setInterval(this.JsMediaSDK_VideoRender_interval.bind(this),t),this.intervalHandle):null:(function(e){!!e&&(y=e)}(this),this.Start_Request_Animation_Frame())},v.prototype.Stop_Draw=function(){this.rendingFlag=!1,this.renderMode?clearInterval(this.intervalHandle):this.Stop_Request_Animation_Frame()},v.prototype.webGLContextLostProtect=function(e,t){var r=this;this.bWebglContextLostProtectingMap.get(e)||(this.bWebglContextLostProtectingMap.set(e,t),this.renderMode||(e.addEventListener("webglcontextlost",(function(n){console.log("webglcontextlost",t),r.rAFID&&r.Stop_Request_Animation_Frame(),r.enableReplaceCanvasWhenContextLost?(e.contextLostTimer&&(clearTimeout(e.contextLostTimer),e.contextLostTimer=null),e.contextLostTimer=setTimeout((function(){e.contextLostTimer=null,Object(_.i)(t,!0)}),3e3)):Object(_.i)(t),n.preventDefault()}),{capture:!1}),e.addEventListener("webglcontextrestored",(function(n){console.log("webglcontextrestored",t),r.enableReplaceCanvasWhenContextLost?e.contextLostTimer&&(clearTimeout(e.contextLostTimer),e.contextLostTimer=null,Object(_.i)(t,!0)):r.Restored_From_Context_Lost(e,e,t)}),{capture:!1})))},v.prototype._Replace_Video_Render_Array_From_Context_LOST=function(e){for(var t=e.canvas,r=e.oldCanvas,n=e.newDisplayMap,a=0;a<this.videoRenderArray.length;a++)if(this.videoRenderArray[a].canvas===r||this.videoRenderArray[a].canvas===t){r!==t&&(this.videoRenderArray[a].canvas=t);var i=this.videoRenderArray[a].display.fillMode;this.videoRenderArray[a].display=n?n.get(this.videoRenderArray[a].display.textureindex):this._Create_H264_Canvas({videoRenderArrayIndex:a,canvas:t,canvasId:this.videoRenderArray[a].rendercanvasID}),i&&this.videoRenderArray[a].display&&this.videoRenderArray[a].display.setFillMode(i,this.videoRenderArray[a].display.fillModeForResolution)}},v.prototype.Restored_From_Context_Lost=function(e,t,r){if(this.renderMode)this._Replace_Video_Render_Array_From_Context_LOST({canvas:e,oldCanvas:t});else{var n=new Map,a=new c.a(e,0,void 0,void 0);a.contextGL||Object(_.f)(r),a.SetMultiView(!0),n.set(0,a);for(var i=2;i<=this.threadNumbs;i++){var o=new c.a(e,i,void 0,void 0,{program:a.shaderProgram,contextgl:a.contextGL,vBuffer:a.vertexPosBuffer,tBuffer:a.texturePosBuffer,waterMarkTextureRef:a.waterMarkTextureRef,repeatedWaterMarkTextureRef:a.repeatedWaterMarkTextureRef});o.SetMultiView(!0),n.set(i,o)}var s=this.renderMGR.get(t);s[0]=s[0].map((function(e){return n.get(e.textureindex)})),s[1]=s[1].map((function(e){return n.get(e.textureindex)})),t!==e&&(this.renderMGR.delete(t),this.renderMGR.set(e,s)),this.ssrcDispalyMap.forEach((function(r,a){r.forEach((function(r){if(r.haddata=!1,r.canvas===t){t!==e&&(r.canvas=e);var a=r.display;r.display=n.get(a.textureindex)}}))})),this._Replace_Video_Render_Array_From_Context_LOST({canvas:e,oldCanvas:t,newDisplayMap:n}),this.rendingFlag&&this.Start_Request_Animation_Frame()}},v.prototype.Replace_Canvas=function(e,t){var r=this,n=null;this.bWebglContextLostProtectingMap.forEach((function(e,a){e===t&&(n=a,r.bWebglContextLostProtectingMap.delete(a))})),n&&(this.webGLContextLostProtect(e,t),this.Restored_From_Context_Lost(e,n,t)),this.isSupportOffscreenCanvas&&(this.waterMarkCanvas||this.videorendercanvas)&&(this.waterMarkCanvas=this.videorendercanvas=new OffscreenCanvas(640,360))},v.prototype.Get_Display=function(e,t){var r;this.renderMGR||(this.renderMGR=new Map),this.webGLContextLostProtect(e,t);var n=this.renderMGR.get(e);if(!n){var a=[];n=[a,[]],this.renderMGR.set(e,n);var i=new c.a(e,0,void 0,void 0);i.SetMultiView(!0),a.push(i);for(var o=2;o<=this.threadNumbs;o++){var s=new c.a(e,o,void 0,void 0,{program:i.shaderProgram,contextgl:i.contextGL,vBuffer:i.vertexPosBuffer,tBuffer:i.texturePosBuffer,waterMarkTextureRef:i.waterMarkTextureRef,repeatedWaterMarkTextureRef:i.repeatedWaterMarkTextureRef});s.SetMultiView(!0),a.push(s)}}var d=this.renderMGR.get(e),u=d[0],l=d[1];return d&&(u[0]&&(r=u.shift()),l.push(r)),r||this.Log_Error("No Display obtained from VideoRender.Get_Display"),r},v.prototype.GiveBack_Display=function(e){if(this.renderMGR){var t=e[0];if(t&&t.display){t.display.SetWaterMarkFlag(0),t.display.SetVideoMode(d.VIDEO_INVALID);var r=this.renderMGR.get(t.canvas);if(r){var n=r[0],a=r[1];a&&a.some((function(e,r){if(e===t.display)return a.splice(r,1),!0})),n.push(t.display)}}}},v.prototype.Get_Logical_SSrc=function(e){return e?e>>10<<10:-1},v.prototype.Set_LocalVideo_Ptr=function(e){e&&(this.localVideoPtr=e)},v.prototype.Set_LocalVideo_Buffer=function(e){e&&(this.encodedVideoSharedArrayWasmMemory=e,this.sabBuffer=e.buffer,this.encodedVideoSharedArrayBufferUint8Array=new Uint8Array(this.sabBuffer),this.encodedVideoSharedArrayBufferUint16Array=new Uint16Array(this.sabBuffer))},v.prototype.Set_LocalVideo_SSRC=function(e){e&&(this.localvideossrc=e,this.selfvideossrc=e)},v.prototype.Draw_LocalVideo=function(){if(this.localVideoPtr&&this.sabBuffer&&this.localvideossrc){this.encodedVideoSharedArrayWasmMemory&&this.encodedVideoSharedArrayWasmMemory.buffer!=this.sabBuffer&&(this.encodedVideoSharedArrayBufferUint8Array=new Uint8Array(this.encodedVideoSharedArrayWasmMemory.buffer),this.encodedVideoSharedArrayBufferUint16Array=new Uint16Array(this.encodedVideoSharedArrayWasmMemory.buffer),this.sabBuffer=this.encodedVideoSharedArrayWasmMemory.buffer);var e=Atomics.load(this.encodedVideoSharedArrayBufferUint8Array,this.localVideoPtr),t=!0;if(e==Atomics.load(this.encodedVideoSharedArrayBufferUint8Array,this.localVideoPtr+1)&&(t=!1),t){var r,n=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(d.VIDEO_DATA_MAX_SIZE+4+8+2)*e)/2],a=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(d.VIDEO_DATA_MAX_SIZE+4+8+2)*e+2)/2],i=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(d.VIDEO_DATA_MAX_SIZE+4+8+2)*e+4)/2],o=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(d.VIDEO_DATA_MAX_SIZE+4+8+2)*e+6)/2],s=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(d.VIDEO_DATA_MAX_SIZE+4+8+2)*e+8)/2],u=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(d.VIDEO_DATA_MAX_SIZE+4+8+2)*e+10)/2],c=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(d.VIDEO_DATA_MAX_SIZE+4+8+2)*e+12)/2];r=c&&c!==d.VIDEO_BGRA?n*a*3/2:n*a*4,this.croppingParams.top=i,this.croppingParams.left=o,this.croppingParams.height=u,this.croppingParams.width=s;var l=this.encodedVideoSharedArrayBufferUint8Array.subarray(this.localVideoPtr+4+(d.VIDEO_DATA_MAX_SIZE+4+8+2)*e+4+8,this.localVideoPtr+4+(d.VIDEO_DATA_MAX_SIZE+4+8+2)*e+4+8+r);this.Update_SelfVideo_Texture(n,a,l,this.Get_Logical_SSrc(this.localvideossrc),c,this.croppingParams),Atomics.store(this.encodedVideoSharedArrayBufferUint8Array,this.localVideoPtr,(e+1)%10)}}},v.prototype.Update_LocalVideo=function(e){var t=this.localvideossrc;this.Update_RemoteVideo_Texture(e,!0,t)},v.prototype.Set_Capture_Video_Flag=function(e){this.startCaptureVideo=e},v.prototype.Get_Capture_Video_Flag=function(){return this.startCaptureVideo},v.prototype.JsMediaSDK_VideoRender_interval=function(){if(this.startCaptureVideo&&this.Draw_LocalVideo(),0!=this.videoRenderArray.length)for(var e=0;e<this.videoRenderArray.length;e++){var t=this.videoRenderArray[e],r=t.display,n=t.canvas,a=t.enableMultiDecodeVideoWithoutSAB,i=t.ssrc,o=t.isMyself,u=null;if(this.Get_Logical_SSrc(i)===this.Get_Logical_SSrc(this.currentactive)){var c=Date.now();if(this.jsMediaEngine){var l=this.jsMediaEngine.Get_Video_SSRC_Latest_Time();this.timestamp=l.currentSSRCTime,this.audioPlayTime=l.audioPlayTime}this.calPacingTime(c),c-this.timestart<this.pacingTime||(u=this.Get_Decoded_Video_Frame(this.Get_Logical_SSrc(i)),this.timestart=c)}else u=this.Get_Decoded_Video_Frame(this.Get_Logical_SSrc(i));if(u){this.Get_Logical_SSrc(i)===this.Get_Logical_SSrc(this.currentactive)&&(this.videoTimestamp=u.ntptime);var f;f=u.yuvdata instanceof _.c?u.yuvdata.yuvdata:u.yuvdata,this.croppingParams.top=u.r_y,this.croppingParams.left=u.r_x,this.croppingParams.height=u.r_h,this.croppingParams.width=u.r_w;var h=u.width>u.height&&(1===u.rotation||3===u.rotation)||u.width<u.height&&1!==u.rotation&&3!==u.rotation,p=h?u.height:u.width,m=h?u.width:u.height,v=n.width,g=n.height;this.Should_Update_Watermark(r,p,m,v,g)&&this.Update_Display_Watermark(r,p,m,v,g),this.currentVideoHeight==this.croppingParams.height&&this.currentVideoWidth==this.croppingParams.width||(this.Notify_APPUI?this.Notify_APPUI(s.b,{width:this.croppingParams.width,height:this.croppingParams.height}):postMessage({status:d.CURRENT_VIDEO_RESOLUTION,width:this.croppingParams.width,height:this.croppingParams.height}),this.currentVideoHeight=this.croppingParams.height,this.currentVideoWidth=this.croppingParams.width),f.length==u.width*u.height*3/2&&u.r_x>=0&&u.r_y>=0&&u.r_x+u.r_w<=u.width&&u.r_y+u.r_h<=u.height?(8400==this.vMonitorCount&&(this.jsMediaEngine?this.jsMediaEngine.Send_Render_Monitor_Log("VDGLM"):postMessage({status:d.VIDEO_RENDER_MONITOR_LOG,data:"VDGLW"}),this.vMonitorCount=0),this.vMonitorCount++,a?r&&(r.SetVideoMode(d.VIDEO_I420),r.UpdateRemoteVideoTextures(u.width,u.height,this.croppingParams,f,u.rotation,u.yuv_limited),t.firstFrame=!0):(t.display.SetVideoMode(d.VIDEO_I420),t.display.drawNextOuptutPictureGL(u.width,u.height,this.croppingParams,f,u.rotation,u.yuv_limited,t))):this.Log_Error("Invalid YUV data: ".concat(u.r_x," ").concat(u.r_y," ").concat(u.r_w," ").concat(u.r_h," ").concat(u.width," ").concat(u.height)),u.yuvdata instanceof _.c&&u.yuvdata.recycle()}if(a&&t.firstFrame){var y={x:t.x,y:t.y,width:t.width,height:t.height};o?r.DrawSelfVideo(y):r.DrawRemoteVideo(y)}}},v.prototype.Get_Decoded_Video_Frame=function(e){if(this.videoQueue){var t=this.videoQueue.GetQueue(e);return t?t.dequeue():null}},v.prototype.Set_SSRC_Latest_Time_Stamp=function(e){this.timestamp!==e&&"number"==typeof e&&(this.timestamp=e,this.audioPlayTime=Date.now())},v.prototype.Get_Decoded_Video_Buffer_Length=function(e){return this.videoQueue?this.videoQueue.GetQueueLength(e):0},v.prototype.Get_SSRC_VIDEO_FPS=function(e){if(e>>=10,this.videoQueue&&this.videoQueue.ssrcInfo){var t=this.videoQueue.ssrcInfo.GetSSRCFpsInfo(e);if(t)return Math.round(t)}return 0},v.prototype.Change_Current_SSRC=function(e){this.currentactive=e,this.ClearQueue()},v.prototype.Set_Render_Array_IntervalMode=function(e,t){if(this.videoRenderArray=e,this.renderMode&&this.videoRenderArray.length>0)for(var r=0;r<this.videoRenderArray.length;r++){var n=this.videoRenderArray[r];t?n.display||(n.enableMultiDecodeVideoWithoutSAB=t,n.display=this.Get_Display(n.canvas,n.canvas.id),n.display&&n.display.setFillMode(n.fillMode,n.fillModeForResolution)):(n.display=this._Create_H264_Canvas({videoRenderArrayIndex:r,canvas:n.canvas,canvasId:n.rendercanvasID}),this.webGLContextLostProtect(n.canvas,n.rendercanvasID))}},v.prototype._Create_H264_Canvas=function(e){var t=e.videoRenderArrayIndex,r=e.canvas,n=e.canvasId;return new c.a(r,0,void 0,{webglcontextlostCallback:this.webglcontextlostCallback.bind(this),webglcontextrestoredCallback:this.webglcontextrestoredCallback.bind(this),params:{videoRenderArrayIndex:t,canvas:r,canvasId:n}})},v.prototype.webglcontextlostCallback=function(e,t){var r=t.canvas,n=t.canvasId;this.renderMode&&this.enableReplaceCanvasWhenContextLost&&r&&n&&(r.contextLostTimer&&(clearTimeout(r.contextLostTimer),r.contextLostTimer=null),r.contextLostTimer=setTimeout((function(){r.contextLostTimer=null,Object(_.i)(n,!0)}),3e3))},v.prototype.webglcontextrestoredCallback=function(e,t){var r=t.videoRenderArrayIndex,n=t.canvas,a=t.canvasId;this.renderMode&&(this.enableReplaceCanvasWhenContextLost&&n&&a?n.contextLostTimer&&(clearTimeout(n.contextLostTimer),n.contextLostTimer=null,Object(_.i)(a,!0)):this.videoRenderArray[r].display=this._Create_H264_Canvas({videoRenderArrayIndex:r,canvas:n,canvasId:a}))},v.prototype.ClearQueue=function(){try{var e,t=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}(this.videoQueue.ssrcQueueMap);try{for(t.s();!(e=t.n()).done;)for(var r=a()(e.value,2),n=(r[0],r[1]);!n.isEmpty();){var i=n.dequeue();i.yuvdata&&i.yuvdata instanceof _.c&&i.yuvdata.recycle()}}catch(e){t.e(e)}finally{t.f()}}catch(e){this.Log_Error("Exception during VideoRender.ClearQueue",e)}this.videoQueue&&this.videoQueue.ClearQueue(),this.currentVideoHeight=0,this.currentVideoWidth=0},v.prototype.Set_WaterMark_Info=function(e){var t=e.waterMarkCanvas,r=e.isCreateVideoWaterMark,n=e.videoWaterMarkName,a=e.watermarkOpacity,i=e.watermarkRepeated,o=e.watermarkPosition;this.waterMarkCanvas=t||this.videorendercanvas,this.isCreateVideoWaterMark=r,this.videoWaterMarkName=n,void 0!==i&&(this.isWaterMarkRepeatedEnable=!!i),void 0!==a&&(this.waterMarkOpacity=a),void 0!==o&&(this.watermarkPosition=o)},v.prototype.Set_WaterMark_Flag=function(e){if(this.videoRenderArray.length>0)for(var t=0;t<this.videoRenderArray.length;t++)this.videoRenderArray[t].display.SetWaterMarkFlag(e?1:0)},v.prototype.Should_Watermark_Repeated=function(e,t){return this.isWaterMarkRepeatedEnable&&e>306&&t>202};var g=function(e,t){if(e<640&&e){var r=640/e;e=640,t=Math.round(t*r)}return{width:e,height:t}};v.prototype.Update_Display_Watermark=function(e,t,r,n,a){var i=this.Should_Watermark_Repeated(n,a);this.waterMarkCanvas||this.videorendercanvas||(this.videorendercanvas=this.isSupportOffscreenCanvas?new OffscreenCanvas(640,360):null);var o=n<512||a<288?16:this.watermarkPosition,s=this.waterMarkCanvas||this.videorendercanvas;if(!("function"==typeof OffscreenCanvas&&s instanceof OffscreenCanvas&&OffscreenCanvasRenderingContext2D)||OffscreenCanvasRenderingContext2D.prototype.measureText){var d=g(t,r);t=d.width,r=d.height;var u=i?this.WaterMarkRGBA.Get_Repeated_WaterMarkRGBA({canvas:s,name:this.videoWaterMarkName,width:t,height:r,opacity:this.waterMarkOpacity,position:o}):this.WaterMarkRGBA.Get_WaterMarkRGBA({canvas:s,name:this.videoWaterMarkName,width:t,height:r,opacity:this.waterMarkOpacity,position:o});e.updateWatherMark(t,r,u)}},v.prototype.Should_Update_Watermark=function(e,t,r,n,a){if(!this.isCreateVideoWaterMark)return!1;var i=!1,o=g(t,r);o.width===e.watermarkWidth&&o.height===e.watermarkHeight||(i=!0);var s=this.Should_Watermark_Repeated(n,a);e.IsSetWaterMark()||(i=!0),s!==e.IsWatermarkRepeated()&&(i=!0,e.SetWatermarkRepeated(s)),this.waterMarkOpacity&&this.waterMarkOpacity!==e.GetWatermarkOpacity()&&(i=!0,e.SetWatermarkOpacity(this.waterMarkOpacity));var d=t<512||r<288?16:this.watermarkPosition;return d!==e.GetWatermarkPosition()&&(i=!0,e.SetWatermarkPosition(d)),i},v.prototype.Put_Video_Data_Queue=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;if(this.videoQueue){var r=this.videoQueue.GetQueue(e.ssrc);if(r||(r=this.videoQueue.AddQueue(e.ssrc)),r.enqueue(e),this.Get_Logical_SSrc(this.currentactive)==this.Get_Logical_SSrc(e.ssrc)&&(this.Get_Logical_SSrc(this.lastActiveSSRC)!=this.Get_Logical_SSrc(e.ssrc)&&(this.lfTimeStamp=0,this.activeFps=0),this.lastActiveSSRC=this.currentactive,this.lfTimeStamp&&(this.activeFps?this.activeFps=500/(e.ntptime-this.lfTimeStamp)+this.activeFps/2:this.activeFps=1e3/(e.ntptime-this.lfTimeStamp)),this.lfTimeStamp=e.ntptime),this.videoQueue&&this.videoQueue.ssrcInfo){var n=e.ssrc>>10;this.videoQueue.ssrcInfo.UpdateSSRCInfo(n,e.ntptime)}for(var a=this.videoQueue.GetQueueLength(e.ssrc)-t;a>=0;){var i=this.Get_Decoded_Video_Frame(e.ssrc);i.yuvdata instanceof _.c&&i.yuvdata.recycle(),a--}}else e.yuvdata&&e.yuvdata instanceof _.c&&e.yuvdata.recycle()},v.prototype.Set_VideoTrackReader=function(e){this.isSupportVideoTrackReader=e},v.prototype.Clear_OffScreenCavas=function(e){if(this.renderMGR&&this.renderMGR.get(e)){var t=this.renderMGR.get(e);if(t){var r=t[0],n=t[1];n.forEach((function(e){e.cleanup()})),r.forEach((function(e){e.cleanup()})),r=[],n=[],this.renderMGR.delete(e)}}e.width=1,e.height=1},v.prototype.Zoom_Render=function(e){},v.prototype.Decode_Ssrc=function(e){return this.ssrcDispalyMap.has(this.Get_Logical_SSrc(e))||this.Get_Logical_SSrc(e)==this.Get_Logical_SSrc(this.selfvideossrc)};var y,S="undefined"==typeof window;function E(e){var t=Date.now(),r=y;if(r.rendingFlag){try{r.startCaptureVideo&&r.localVideoPtr&&r.Draw_LocalVideo(),r.ssrcDispalyMap.forEach((function(e,n){var a;if(r.Get_Logical_SSrc(n)==r.Get_Logical_SSrc(r.selfvideossrc)&&(a=!0),r.Get_Logical_SSrc(n)===r.Get_Logical_SSrc(r.currentactive))if(r.calPacingTime(t),t-r.timestart<r.pacingTime);else{r.timestart=t;var i=r.Get_Decoded_Video_Frame(r.Get_Logical_SSrc(n));i&&(r.Update_RemoteVideo_Texture(i),r.videoTimestamp=i.ntptime)}else{var o=r.Get_Decoded_Video_Frame(r.Get_Logical_SSrc(n));o&&r.Update_RemoteVideo_Texture(o)}e.forEach((function(e){if(e.haddata){var t=e.display;r.coordinate.x=e.x,r.coordinate.y=e.y,r.coordinate.width=e.width,r.coordinate.height=e.height,t&&t.GetVideoMode()!=d.VIDEO_INVALID&&(a&&-1!==[d.VIDEO_RGBA,d.VIDEO_BGRA].indexOf(t.GetVideoMode())?t.DrawSelfVideo(r.coordinate,!1,r.ismirror):a?t.DrawRemoteVideo(r.coordinate,r.ismirror):t.DrawRemoteVideo(r.coordinate))}}))}))}catch(e){r.Log_Error("Exception while rendering video",e)}r.Start_Request_Animation_Frame(e)}else r.rAFID&&r.Stop_Request_Animation_Frame()}v.prototype.Check_Request_Animation=function(){if(S&&this.rendingFlag&&this.rAFID&&this.prevRequestAnimationTimestap){var e=performance.now()-this.prevRequestAnimationTimestap;e>1e3&&!this.rAFIDBack&&(postMessage({status:MONITOR_MESSAGE,data:"WCL_M,RCIF"}),console.log("Request_Animation_stop"),this.rAFIDBack=setInterval(E.bind(null,!0),30)),this.rAFIDBack&&e>=1e3*this.retryRequestAnimationStep&&(this.retryRequestAnimationStep<=32?this.retryRequestAnimationStep*=2:this.retryRequestAnimationStep+=30,this.Start_Request_Animation_Frame(!1,!0))}},v.prototype.Start_Request_Animation_Frame=function(e,t){if(!e&&this.rAFIDBack&&(console.log("Request_Animation_start"),this.Stop_Request_Animation_Frame_Backup()),!this.rAFIDBack)return t||(this.retryRequestAnimationStep=2),this.prevRequestAnimationTimestap=performance.now(),this.rAFID=requestAnimationFrame(E),this.rAFID},v.prototype.Stop_Request_Animation_Frame_Backup=function(){this.rAFIDBack&&(clearInterval(this.rAFIDBack),this.rAFIDBack=null)},v.prototype.Stop_Request_Animation_Frame=function(){cancelAnimationFrame(this.rAFID),this.rAFID=0,this.prevRequestAnimationTimestap=0,this.retryRequestAnimationStep=2,this.Stop_Request_Animation_Frame_Backup()},v.prototype.Log_Error=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.globalTracingLogger?this.globalTracingLogger.error(e,t):Object(_.g)(e,t)},v.prototype.calPacingTime=function(e){if(this.pacingTime=30,this.activeFps&&this.activeFps>0&&this.activeFps<100&&(this.pacingTime=1e3/this.activeFps),this.timestamp&&this.videoTimestamp){var t=this.timestamp+e-this.audioPlayTime,r=this.videoTimestamp+this.pacingTime-t,n=this.videoQueue.GetQueueLength(this.Get_Logical_SSrc(this.currentactive));r>65&&r<1e4&&n>=1&&(this.pacingTime=1.5*this.pacingTime),r<-65&&(this.pacingTime=1*this.pacingTime/2)}else this.timestamp||(this.pacingTime>150?this.pacingTime=1*this.pacingTime/2:this.pacingTime=this.pacingTime-10)},t.a=v},function(e,t,r){var n=r(27),a=r(28),i=r(19),o=r(29);e.exports=function(e,t){return n(e)||a(e,t)||i(e,t)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";var n=r(3),a=r.n(n),i=r(4),o=r.n(i),s=function(){function e(){a()(this,e)}return o()(e,[{key:"_drawWatermarkWithShadow",value:function(e){var t=e.ctx,r=e.textPos,n=e.opacity,a=e.name;t.fillStyle="rgba(0, 0, 0, ".concat(n,")"),t.fillText(a,r.x,r.y),t.fillStyle="rgba(255, 255, 255, ".concat(n,")"),t.fillText(a,r.x+1,r.y+1)}},{key:"_getTransformInfo",value:function(e){var t,r=e.canvas,n=e.position;if(1===n)t={x:r.width/2,y:0,rateRadio:0,maxWidth:r.width};else if(2===n)t={x:r.width/2,y:r.height,rateRadio:0,maxWidth:r.width};else if(4===n)t={x:0,y:r.height/2,rateRadio:Math.PI/2,maxWidth:r.height};else if(8===n)t={x:r.width,y:r.height/2,rateRadio:-Math.PI/2,maxWidth:r.height};else{var a=-21*Math.PI/180;t={x:r.width/2,y:r.height/2,rateRadio:a,maxWidth:Math.min(r.width/Math.cos(a),-r.height/Math.sin(a))}}return t.maxWidth>100&&(t.maxWidth-=50),t}},{key:"_calcTextPos",value:function(e){var t=e.position,r=e.ctx,n=e.name,a=e.textWidth,i=this._getPaddingWidth({ctx:r,position:t,name:n});return 1===t?{x:-a.width/2,y:i}:2===t||4===t||8===t?{x:-a.width/2,y:-i}:{x:-a.width/2,y:r.measureText(n[0]).width/2}}},{key:"_getPaddingWidth",value:function(e){var t=e.ctx,r=e.position,n=e.name;return[1,2,4,8].includes(r)?32:t.measureText(n[0]).width}},{key:"_setBaseLine",value:function(e){var t=e.ctx,r=e.position;t.textBaseline=1===r?"top":2===r||4===r||8===r?"bottom":"middle"}},{key:"Get_WaterMarkRGBA",value:function(e){var t=e.canvas,r=e.name,n=e.width,a=e.height,i=e.opacity,o=void 0===i?.15:i,s=e.position,d=e.convertToDataUrl;if(r&&n&&a){o=o||.15,n*=1,a*=1,t.width=n,t.height=a;var u,c=this._getTransformInfo({canvas:t,position:s}),l=t.getContext("2d");if(l.clearRect(0,0,t.width,t.height),l.translate(c.x,c.y),l.rotate(c.rateRadio),this._setBaseLine({ctx:l,position:s}),l.lineWidth=1,l.imageSmoothingEnabled=!0,1==r.length){var _=c.maxWidth/r.length;l.font=_+"px  'Segoe UI'",u=l.measureText(r)}else{var f=16;for(l.font=f+"px  'Segoe UI'",u=l.measureText(r);u.width<c.maxWidth-2*this._getPaddingWidth({ctx:l,position:s,name:r});)f+=1,l.font=f+"px  'Segoe UI'",u=l.measureText(r);if(u.width>c.maxWidth-2*this._getPaddingWidth({ctx:l,position:s,name:r}))if(f>16)f-=1,l.font=f+"px  'Segoe UI'",u=l.measureText(r);else{for(var h=r;r.length>5&&u.width>c.maxWidth-2*this._getPaddingWidth({ctx:l,position:s,name:r+"..."});)r=r.slice(0,r.length-1),u=l.measureText(r+"...");h!==r&&(r+="...")}}var p,m=this._calcTextPos({position:s,ctx:l,name:r,textWidth:u});if(this._drawWatermarkWithShadow({ctx:l,name:r,opacity:o,textPos:m}),d)p=t.toDataURL();else{var v=l.getImageData(0,0,l.canvas.width,l.canvas.height);p=new Uint8Array(v.data.buffer)}return l.rotate(-c.rateRadio),l.translate(-c.x,-c.y),p}}},{key:"Get_Repeated_WaterMarkRGBA",value:function(e){var t=e.canvas,r=e.name,n=e.width,a=e.height,i=e.opacity,o=void 0===i?.15:i,s=(e.position,e.convertToDataUrl);if(r&&n&&a){o=o||.15,n*=1,a*=1,t.width=n,t.height=a;var d=t.getContext("2d");d.clearRect(0,0,t.width,t.height),d.translate(n/2,a/2),d.rotate(-21*Math.PI/180),d.imageSmoothingEnabled=!0,d.font="".concat(32,"px 'Segoe UI'"),d.textBaseline="top";var u,c=d.measureText(r),l=.37*c.width,_=0,f=-a;do{var h=_%2==0?l-n:-n;do{d.fillStyle="rgba(0, 0, 0, ".concat(o,")"),d.fillText(r,h,f),d.fillStyle="rgba(255, 255, 255, ".concat(o,")"),d.fillText(r,h+1,f+1),h+=c.width+l}while(h<n);f+=32+l,_++}while(f<a);if(s)u=t.toDataURL();else{var p=d.getImageData(0,0,d.canvas.width,d.canvas.height);u=new Uint8Array(p.data.buffer)}return d.rotate(21*Math.PI/180),d.translate(-n/2,-a/2),u}}}]),e}();t.a=s},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(18);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(13).default,a=r(21);e.exports=function(e){var t=a(e,"string");return"symbol"===n(t)?t:String(t)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(13).default;e.exports=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!==n(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(13).default;function a(){"use strict";e.exports=a=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},r=Object.prototype,i=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},d=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function _(e,t,r,n){var a=t&&t.prototype instanceof p?t:p,i=Object.create(a.prototype),s=new F(n||[]);return o(i,"_invoke",{value:A(e,r,s)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=_;var h={};function p(){}function m(){}function v(){}var g={};l(g,d,(function(){return this}));var y=Object.getPrototypeOf,S=y&&y(y(D([])));S&&S!==r&&i.call(S,d)&&(g=S);var E=v.prototype=p.prototype=Object.create(g);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function M(e,t){var r;o(this,"_invoke",{value:function(a,o){function s(){return new t((function(r,s){!function r(a,o,s,d){var u=f(e[a],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==n(l)&&i.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,s,d)}),(function(e){r("throw",e,s,d)})):t.resolve(l).then((function(e){c.value=e,s(c)}),(function(e){return r("throw",e,s,d)}))}d(u.arg)}(a,o,r,s)}))}return r=r?r.then(s,s):s()}})}function A(e,t,r){var n="suspendedStart";return function(a,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw i;return{value:void 0,done:!0}}for(r.method=a,r.arg=i;;){var o=r.delegate;if(o){var s=w(o,r);if(s){if(s===h)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var d=f(e,t,r);if("normal"===d.type){if(n=r.done?"completed":"suspendedYield",d.arg===h)continue;return{value:d.arg,done:r.done}}"throw"===d.type&&(n="completed",r.method="throw",r.arg=d.arg)}}}function w(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var a=f(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,h;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function F(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(e){if(e){var t=e[d];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:k}}function k(){return{value:void 0,done:!0}}return m.prototype=v,o(E,"constructor",{value:v,configurable:!0}),o(v,"constructor",{value:m,configurable:!0}),m.displayName=l(v,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,l(e,c,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},b(M.prototype),l(M.prototype,u,(function(){return this})),t.AsyncIterator=M,t.async=function(e,r,n,a,i){void 0===i&&(i=Promise);var o=new M(_(e,r,n,a),i);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(E),l(E,c,"Generator"),l(E,d,(function(){return this})),l(E,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,F.prototype={constructor:F,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=i.call(a,"catchLoc"),d=i.call(a,"finallyLoc");if(s&&d){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;R(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:D(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},t}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},,function(e,t,r){var n=r(18);e.exports=function(e){if(Array.isArray(e))return n(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i,o,s=[],d=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;d=!1}else for(;!(d=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);d=!0);}catch(e){u=!0,a=e}finally{try{if(!d&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";r.r(t),r.d(t,"JsMediaSDK_Log",(function(){return b})),r.d(t,"Channel_Agent",(function(){return Ht})),r.d(t,"Open_Video_WebSocket_Connect",(function(){return Gt})),r.d(t,"video_websocket_on_open",(function(){return zt})),r.d(t,"video_websocket_on_message",(function(){return Zt})),r.d(t,"videoencode_create_helpthread",(function(){return sr})),r.d(t,"Exit_Thread",(function(){return dr})),r.d(t,"videocodec_create_helpthread",(function(){return ur})),r.d(t,"Before_Create_Thread",(function(){return cr})),r.d(t,"vbLoadingTimer",(function(){return hr})),r.d(t,"IsSupportMultiThread",(function(){return Ur})),r.d(t,"hardcodecpunumber",(function(){return Vr})),r.d(t,"IsSupportMultiThreadForWebcodec",(function(){return Nr})),r.d(t,"LimitWebCodecsEncoderTo360_js",(function(){return Br})),r.d(t,"UserAgentIsTesla_js",(function(){return Hr})),r.d(t,"GetCscThreadNum",(function(){return Wr})),r.d(t,"GetEncThreadNum",(function(){return Gr})),r.d(t,"video_websocket2_on_message",(function(){return Xr})),r.d(t,"removeSocketFromSocketList",(function(){return zr})),r.d(t,"video_websocket_on_close",(function(){return Zr})),r.d(t,"video_websocket_on_error",(function(){return Jr})),r.d(t,"change_capture_resolution",(function(){return $r})),r.d(t,"js_info_from_wcl",(function(){return en})),r.d(t,"media_data_transport_type_monitor",(function(){return rn})),r.d(t,"js_info_from_wcl_video_data",(function(){return nn})),r.d(t,"processed_capture_data_callback",(function(){return an})),r.d(t,"js_info_from_wcl_thread",(function(){return sn})),r.d(t,"frame_callback",(function(){return cn})),r.d(t,"monitor_drop_ratio",(function(){return ln})),r.d(t,"decode_callback",(function(){return fn})),r.d(t,"send_data",(function(){return hn})),r.d(t,"APP_Troubleshoting_Info",(function(){return pn})),r.d(t,"Monitor_Callback",(function(){return mn})),r.d(t,"Monitor_CallbackE",(function(){return vn})),r.d(t,"Monitor_CallbackD",(function(){return gn})),r.d(t,"LOG_OUT",(function(){return yn})),r.d(t,"wcl_trace_log",(function(){return Sn})),r.d(t,"Utf8ArrayToStr",(function(){return En})),r.d(t,"addDebugLogWebSocket",(function(){return bn})),r.d(t,"SAVE_IV",(function(){return Mn})),r.d(t,"getWasmMemory",(function(){return An})),r.d(t,"freeWasmMemory",(function(){return wn})),r.d(t,"Put_Decoded_Video_Buffer",(function(){return Fn})),r.d(t,"video_process_capture",(function(){return Hn})),r.d(t,"VideoEncodeInit",(function(){return Gn})),r.d(t,"Set_Mask_Bg_Image",(function(){return ua})),r.d(t,"GetEncoderState_js",(function(){return la})),r.d(t,"InitVideoEncoder_js",(function(){return _a})),r.d(t,"VideoEncoderConfigure_js",(function(){return fa})),r.d(t,"VideoEncoder_js",(function(){return ha})),r.d(t,"CloseVideoEncoder_js",(function(){return pa})),r.d(t,"Update_Mask_Texture",(function(){return Sa})),r.d(t,"Crop_Mask_Bg_16V9",(function(){return Ea})),r.d(t,"Get_Mix_Context_Data_And_Draw",(function(){return Ma})),r.d(t,"GetLogLevel_js",(function(){return ka})),r.d(t,"Get_Mix_Display_Data_And_Draw",(function(){return Ia})),r.d(t,"prepareModelFile",(function(){return La})),r.d(t,"prepareJSFile",(function(){return Na})),r.d(t,"Get_Mixed_VB_Data_and_Draw",(function(){return Ka})),r.d(t,"responseVideoQosData",(function(){return Xa})),r.d(t,"qos_monitor",(function(){return za})),r.d(t,"network_quality_callback",(function(){return Za})),r.d(t,"MCMMonitor_Video_LOG",(function(){return Ja})),r.d(t,"BigLog_js",(function(){return ei})),r.d(t,"Update_Video_Hd_Info",(function(){return ti}));var n=r(10),a=r.n(n),i=r(5),o=r.n(i),s=r(3),d=r.n(s),u=r(4),c=r.n(u),l=r(2),_=r.n(l),f=r(1),h=r(0),p=r(15),m=r(14),v=r(8),g=r(7),y=r(9);function S(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return E(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b(e){console.log(e)}function M(){this.a=[],this.b=0,this.residue=null}Object.keys(h).forEach((function(e){return self[e]=h[e]})),WebAssembly.instantiateStreaming=!1,self.wasmSuccessEvent=h.Video_Dec_WASM_OK,self.wasmFailEvent=h.Video_Dec_WASM_FAILED,self.databaseName="VIDEO_FILE",self.instantiateCachedURL=f.h,M.prototype.getLength=function(){return this.a.length-this.b},M.prototype.isEmpty=function(){return 0==this.a.length},M.prototype.enqueue=function(e){this.a.push(e)},M.prototype.dequeue=function(){if(0!=this.a.length){var e=this.a[this.b];return 2*++this.b>=this.a.length&&(this.a=this.a.slice(this.b),this.b=0),e}return null},M.prototype.peek=function(){return 0<this.a.length?this.a[this.b]:void 0};var A,w,T,R,F,D,k,I,C,O,x,P,L,U,V,N,B,H,W,G,j,q,Y,K,Q,X,z,Z,J,$,ee,te,re,ne=new M,ae=!0,ie=!1,oe=0,se=0;self.onWasmModuleReady=function(){A=Module.cwrap("_Video_Init","number",["number","number","string","string","number","number","number","boolean","boolean","boolean","number","boolean","boolean"]),w=Module.cwrap("_Video_UnInit","number",["number"]),Module.cwrap("_Video_Decode","number",["number","array","number"]),T=Module.cwrap("_Video_Encode","number",["number","number","number","number","number","number","number","boolean","number","number"]),R=Module.cwrap("_Video_Encode_YUV","number",["number","number","number","number","number","number","number","number","number","number","number","number","number","boolean","number","number"]),F=Module.cwrap("_Video_Try_Analysis","number",["number","array","number"]),D=Module.cwrap("_Video_Websocket_Speed","number",["number","number","number"]),k=Module.cwrap("_Video_Start_Encode","number",["number","number","number","number","number"]),I=Module.cwrap("_Video_Stop_Encode","number",["number"]),C=Module.cwrap("_Video_Update_Format","number",["number","number","number","number","number"]),Module.cwrap("_Video_VirtualBackground_Special_Action","number",["number","number","number","number","number","number","number"]),j=Module.cwrap("_Request_Video_Qos_Data","number",["number"]),O=Module.cwrap("_Video_Set_Data_Encryption","number",["number","number"]),x=Module.cwrap("_Add_Video_Cooker_info","number",["number","number","number","number"]),P=Module.cwrap("_Remove_Video_Cooker_Info","number",["number","number"]),L=Module.cwrap("_Get_Video_Meat_Weight","number",["number","number"]),U=Module.cwrap("_Set_Max_Receiving_Channel_Num","number",["number","number"]),V=Module.cwrap("_update_sync_time","number",["number","number","number"]),N=Module.cwrap("_release_video_receiving_channel","number",["number","number"]),B=Module.cwrap("_change_hw_status","number",["number","boolean"]),H=Module.cwrap("_Change_Connect_Type","number",["number","number"]),W=Module.cwrap("_Smooth_Send_For_Qos","number",["number"]),G=Module.cwrap("_request_nack_t_periodically_for_qos","number",["number"]),q=Module.cwrap("_update_video_uplink_bandwidth_limitation_by_server","number",["number","number"]),Y=Module.cwrap("_create_vb_thread","number",[]),K=Module.cwrap("_create_vb_no_sab_thread","number",[]),Q=Module.cwrap("_signal_vb_thread_bg","number",["number","number","number","number"]),X=Module.cwrap("_signal_vb_thread_blur","number",["number","number"]),z=Module.cwrap("_signal_vb_thread_video_yuv","number",["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"]),Z=Module.cwrap("_signal_vb_thread_video_rgba","number",["number","number","number","number","number","number","number","number"]),J=Module.cwrap("_update_video_cropping_mode","number",["number","number"]),$=Module.cwrap("_Video_Try_Analysis","number",["number","number","number"]),te=Module.cwrap("_collect_video_monitor_info","number",["number","boolean"]),re=Module.cwrap("_signal_vb_thread_close","number",[])};var de,ue,ce,le,_e,fe,he,pe,me,ve,ge,ye,Se,Ee,be,Me,Ae,we,Te,Re=null,Fe=[],De=null,ke=null,Ie=null,Ce=1,Oe=null,xe=!1,Pe=null,Le=0,Ue=0,Ve=0,Ne=!1,Be=!1,He=null,We=0,Ge=0,je=0,qe=0,Ye=0,Ke=null,Qe=!1,Xe=!1,ze=!1,Ze=!1,Je=!1,$e=!0,et=!1,tt=null,rt=null,nt=null,at=null,it=!1,ot=!1,st=null,dt=null,ut=null,ct=null,lt=null,_t=null,ft=0,ht=new Map,pt=null,mt=new Map,vt=null,gt=[],yt=!1,St=!1,Et="",bt=!1,Mt={ssrc:null,created:0,firstflag:!1},At=null,wt=1,Tt=1,Rt=0,Ft=!1,Dt=!1,kt=!1,It=!1,Ct=!1,Ot=!1,xt=new Map,Pt=navigator.hardwareConcurrency?navigator.hardwareConcurrency:4,Lt=h.VIDEO_CAPTURE_FPS,Ut=0,Vt={rgba_x:0,rgba_y:0,rgba_stride:0},Nt=!1;self.isPreviewMode=!1;var Bt={qosIntervalId:0,renderFlag:!1,monitorPanelFlag:!1,messageIndex:0,panelpollingInterval:0};function Ht(){this.socket=null,this.onopen=null,this.onmessage=null,this.onerror=null,this.onclose=null,this.websocketaddress=null,this.startwebsocketreconnecttime=null,this.reconnect=null,this.connectIndex=0,this.activeclosewebsocket=!1,this.init=function(e,t,r,n,a){this.websocketaddress=e,this.onopen=t,this.onmessage=r,this.onerror=n,this.onclose=a,function(e){var t=null,r=h.serverHeartbeatMaxTimeoutSeconds,n=null,a=e.onmessage,i=e.onopen,o=e.onclose;e.onmessage=function(r){t=(new Date).getTime(),a.call(e,r)},e.onopen=function(a){t=(new Date).getTime(),n||(n=setInterval((function(){(new Date).getTime()-t>=1e3*r&&(clearInterval(n),n=null,e.socket.close())}),1e3)),i.call(e,a,e)},e.onclose=function(t){try{clearInterval(n)}catch(e){Object(f.g)("WebSocket closed",e)}o.call(e,t,e)}}(this)},this.connect=function(e,t,r,n,a){var i=this;Object(f.e)("SB"),i.init(e,t,r,n,a),i.reconnect=function(){var e=this;if(!i.isReconnectNow&&!i.isTimerExist){i.isReconnectNow=!0,i.isTimerExist=!0;var t=Math.pow(2,i.connectIndex)-1;i.connectIndex+=1,setTimeout((function(){i.activeclosewebsocket||(i.isTimerExist=!1,i.startwebsocketreconnecttime=null,i.socket=new WebSocket(e.websocketaddress),i.socket.binaryType="arraybuffer",i.socket.onopen=function(e){i.isReconnectNow=!1,Object(f.e)("SE"),i.startwebsocketreconnecttime=(new Date).getTime()/1e3,i.onopen(e)},i.socket.onmessage=function(e){i.onmessage(e)},i.socket.onerror=function(e){Object(f.e)("SERR"),i.socket.close()},i.socket.onclose=function(e){Object(f.e)("SCLOSE"),i.isReconnectNow=!1,i.onclose(e),i.activeclosewebsocket||(i.connectIndex<10?i.reconnect():(postMessage({status:Video_Dec_WebSocket_FAILED}),console.log("NetWork is Bad, Don't to reconnect the serer!")))})}),1e3*t)}},i.reconnect()},this.send=function(e){var t;if(Pe){var r=(new Date).getTime()/1e3;if((t=r-Pe)>10){var n=Le-this.socket.bufferedAmount;0==this.socket.bufferedAmount?(Ve=Ve?.8*Ve+16e4:8e5,!Xe&&D(Re,Ve,0)):(Ue=8*n/(1*t),Ve=Ve?.8*Ve+.2*Ue:8e5,!Xe&&D(Re,Ve,0)),Le-=n,Pe=r}}else Le=0,Pe=(new Date).getTime()/1e3,!Xe&&D(Re,8e5,0);Le+=e.length;try{this.socket.send(e)}catch(e){Object(f.g)("Error when sending data on WebSocket",e)}},this.close=function(){try{this.removeFromSocketList(),this.activeclosewebsocket=!0,this.socket.close()}catch(e){Object(f.g)("WebSocket force closed",e)}},this.removeFromSocketList=function(){try{var e=Fe.indexOf(this);-1!==e&&Fe.splice(e,1)}catch(e){Object(f.g)("Exception in removeFromSocketList",e)}}}var Wt=new(function(){function e(){d()(this,e),this.intervalTimer=null}return c()(e,[{key:"start",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;this.stop(),this.intervalTimer=setInterval(e,t)}},{key:"stop",value:function(){this.intervalTimer&&(clearInterval(this.intervalTimer),this.intervalTimer=null)}}]),e}());function Gt(e,t,r,n,a,i){if(!isPreviewMode||i){var o=new Ht;return o.connect(e,t,r,n,a),o}}var jt=null;function qt(e,t){return Yt.apply(this,arguments)}function Yt(){return(Yt=o()(_.a.mark((function e(t,r){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!isPreviewMode||r){e.next=2;break}return e.abrupt("return");case 2:return jt=new f.b(t),e.next=5,jt.connect();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Kt(){var e=Xe||ze;if(Re&&e!=Je&&$e){var t=e?1:0,r=Xe?1:0,n=ze?1:0;Object(f.e)("VQOS-S-"+t+"-"+r+"-"+n),H(Re,e?0:2)}Je=e}function Qt(e){var t=e.params.url;ze=!0,Ie=e,t.includes("mode=2")&&Kt(),postMessage({status:h.CONNECT_WEBTRANSPORT_OK})}function Xt(e){var t=e.params.url;Ie=null,ze=!1,t.includes("mode=2")&&Kt(),postMessage({status:h.CONNECT_WEBTRANSPORT_CLOSE})}function zt(e,t){var r;if(t&&1===t.socket.readyState&&Fe.push(t),$e)for(et=!0;tt&&tt.getLength()>0&&(r=tt.dequeue());)nn(0,r.data,0,void 0,void 0,r.isDC,!0);postMessage({status:Video_Dec_WebSocket_OK})}function Zt(e){if(Re){var t=new Uint8Array(e.data);F(Re,t,t.length)}}var Jt,$t,er,tr=!1,rr=!1,nr={threadCreatedFlag:!1};nr.threadPoolBufferMGR=new Map,nr.SSrcWaitForThread=[],nr.initParseThread=!1,nr.unusedworkerarray=[],nr.countThread=3,nr.totalNumbofParseThread=3,nr.newworker=0,nr.totalthread=0,nr.zombiethreadssrc=0,nr.videodecodethreadnumb=1,nr.isSupportMultiThread=!1,nr.isSupportVideoTrackReader=!1,nr.isSupportOffscreenCanvas=!1,nr.isVideoCodecHelpThreadWorker=null,nr.offScreenCanvasHandle={donotrenderoffscreencanvas:null,donotrenderoffscreencanvasctx:null},nr.isEnableVideoDecodeHardWareThread=!1;var ar=1,ir=1280,or={isTeslaMode:!1};function sr(){Dr.nextWorker=Dr.threadarray.shift()}function dr(e){e=e>>10<<10,nr.threadPoolBufferMGR.get(e)&&nr.threadPoolBufferMGR.delete(e)}function ur(){var e,t=nr.threadPoolBufferMGR.get(nr.zombiethreadssrc);t&&(e=t.workerArray[2]),e&&e.postMessage({cmd:"webcodec"}),nr.isVideoCodecHelpThreadWorker=e}function cr(e){e=e>>10<<10;var t=nr.threadPoolBufferMGR.get(e);t&&(nr.newworker=t.workerArray[0])}var lr,_r,fr,hr=(lr=null,_r=null,{inited:!1,start:function(){this.inited=!0,this.clear(),lr=setTimeout((function(){xa||postMessage({status:"VBPredictAbout3s"})}),3e3),_r=setTimeout((function(){xa||postMessage({status:"VBPredictAbout10s",isVBPredictIn5s:!0})}),1e4)},clear:function(){clearTimeout(lr),clearTimeout(_r),lr=null,_r=null}});var pr=function(){return"undefined"!=typeof PThread},mr=function(e,t){e.onmessage=function(r){var n=r.data,i=n.cmd;if(e.pthread_ptr&&(PThread.currentProxiedOperationCallerThread=e.pthread_ptr),n.targetThread&&n.targetThread!=_pthread_self()){var o=PThread.pthreads[n.targetThread];return o?o.postMessage(n,n.transferList):Object(f.g)('Internal error! Worker sent a message "'+i+'" to target pthread '+n.targetThread+", but that thread no longer exists!"),void(pr&&(PThread.currentProxiedOperationCallerThread=void 0))}if("processProxyingQueue"===i)executeNotifiedProxyingQueue(n.queue);else if("spawnThread"===i)spawnThread(n);else if("cleanupThread"===i)cleanupThread(n.thread);else if("killThread"===i)killThread(n.thread);else if("cancelThread"===i)cancelThread(n.thread);else if("loaded"===i)e.loaded=!0,t&&t(e),e.runPthread&&e.runPthread();else if("size"==i)Module.decode_callback&&Module.decode_callback(r.data.ssrc,r.data.size);else if("decoded"==i){if(Module.put_data){if(fr){var s=fr>>10<<10;r.data.ssrc===s&&(fr=0,postMessage({status:58,data:"SVD"}))}Module.put_data(r.data)}}else if("js_info_from_wcl"==i)Module.js_info_from_wcl_thread&&Module.js_info_from_wcl_thread(r.data);else if("wcl_trace_log"==i)Module.wcl_trace_log&&Module.wcl_trace_log(r.data);else if("js_info_from_wcl_video_data"===i){var d=r.data.ssrc,u=r.data.data,c=r.data.is_sent_by_data;Module.js_info_from_wcl_video_data(d,u,0,void 0,void 0,c,!0)}else if("change_capture_resolution"==i)Module.change_capture_resolution&&Module.change_capture_resolution(r.data.type);else if("APP_Troubleshoting_Info"==i)Module.APP_Troubleshoting_Info&&Module.APP_Troubleshoting_Info(r.data.data,r.data.len);else if("SAVE_IV"==i){var l=r.data.ptr,_=r.data.len;Module.SAVE_IV(l,_)}else if("processed_capture_data_callback"==i){var h=r.data.ssrc,p=r.data.data,m=r.data.len_of_data,v=r.data.format_width,g=r.data.format_height,y=r.data.valid_x,S=r.data.valid_y,E=r.data.valid_width,b=r.data.valid_height,M=r.data.yuv_limited;Module.processed_capture_data_callback(h,p,m,v,g,y,S,E,b,M)}else if("modelReady"===i)Ca=performance.now(),hr.start();else if("vbPredictDone"===i)xa=!0,Oa=performance.now()-Ca,Dr.nextWorker=Dr.vbThreadWorker,Dr.nextWorker.postMessage({cmd:"vb"}),Y(),Dr.vbThreadCreatedFlag=!0,postMessage({status:"VBPredictDone",predictCostTime:Oa}),Wn&&(Ct||Wa({data:Qn}));else if("VideoEncodeInit"===r.data.cmd){var A=r.data.id,w=r.data.context;Module.codecMRG.initEncodeWebCodec(A,w)}else if("VideoEncodeConfigure"===r.data.cmd){var T=r.data.Width,R=r.data.Height,F=r.data.id,D=r.data.Bitrate,k=r.data.Framerate;Module.codecMRG.configEncodeWebCodec(F,D,k,T,R)}else if("VideoEncode"===r.data.cmd){var I=r.data.videoFrameId,C=r.data.dataLength,O=r.data.id,x=r.data.NewIDR,P=r.data.rawData;Module.codecMRG.encodeVideoFrame(O,I,x,P,C)}else if("chunk"===r.data.cmd){var L=r.data.data;Module.save(L)}else if("decoded_webcodec"===r.data.cmd){var U=r.data||{},V=U.id,N=U.data,B=U.frameIndex;Module.codecMRG.put_data({id:V,data:N,frameIndex:B})}else if("decoded_webcodec_render"===r.data.cmd){var H=r.data||{},W=H.id,G=H.ssrc,j=H.iFrameNum,q=H.rotation;fr!=G&&(fr=G,postMessage({status:58,data:"HVD"})),Module.codecMRG.render({id:W,iFrameNum:j,ssrc:G,rotation:q})}else if("reclaimed"===r.data.cmd){var K=r.data.data;Module.codecMRG.set_videowebcodecencodestate(K)}else if("print"===i)out("Thread "+n.threadId+": "+n.text);else if("printErr"===i)err("Thread "+n.threadId+": "+n.text);else if("alert"===i)alert("Thread "+n.threadId+": "+n.text);else if("setimmediate"===n.target)e.postMessage(n);else if("callHandler"===i){var Q;(Q=Module)[n.handler].apply(Q,a()(n.args))}else if("tCrashed"==r.data.cmd){var X="WCL_M,"+r.data.data.toString();postMessage({status:MONITOR_MESSAGE,data:X})}else i&&err("worker sent an unknown command "+i);pr()&&(PThread.currentProxiedOperationCallerThread=void 0)},e.onerror=function(e){var t="pthread sent an error! ".concat(e.filename,":").concat(e.lineno,":").concat(e.message);Object(f.g)(t,e),err(t)};for(var r=[],n=0,i=["onExit","onAbort","print","printErr"];n<i.length;n++){var o=i[n];Module.hasOwnProperty(o)&&r.push(o)}pr()?e.postMessage({cmd:"load",urlOrBlob:Module.mainScriptUrlOrBlob||_scriptDir,wasmMemory:wasmMemory,wasmModule:wasmModule,handlers:r,isTeslaMode:!!or.isTeslaMode,is360penablehw:!!Ar}):e.postMessage({cmd:"load",isSingleThreadVBWorker:e.isSingleThreadVBWorker})};function vr(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];PThread.loadWasmModuleToWorker=mr,e?(PThread.getNewWorker=function(){return Dr.nextWorker},PThread.returnWorkerToPool=function(e){var t=e.pthread_ptr;delete PThread.pthreads[t],e.pthread_ptr=0,__emscripten_thread_free_data(t),Dr.threadarray.push(e),PThread.runningWorkers.splice(PThread.runningWorkers.indexOf(e),1)}):(PThread.getNewWorker=function(){var e;if(nr.isVideoCodecHelpThreadWorker)e=nr.isVideoCodecHelpThreadWorker,nr.isVideoCodecHelpThreadWorker=null;else if(!nr.newworker||2!=nr.countThread&&nr.countThread){if(3==nr.countThread||1==nr.countThread){nr.countThread=nr.countThread-1;var t,r=nr.threadPoolBufferMGR.get(nr.zombiethreadssrc);r&&(2==nr.countThread?t=0:0==nr.countThread&&(t=1),e=r.workerArray[t])}}else nr.countThread&&(nr.countThread=nr.countThread-1),e=nr.newworker,nr.newworker=0;return e},PThread.returnWorkerToPool=function(e){var t=e.pthread_ptr;delete PThread.pthreads[t],e.pthread_ptr=0,__emscripten_thread_free_data(t),setTimeout((function(){br(e)}),0),PThread.runningWorkers.splice(PThread.runningWorkers.indexOf(e),1)})}function gr(e){return e?e>>10<<10:-1}function yr(e){nr.threadPoolBufferMGR.set(nr.zombiethreadssrc,{pduBuffer:new M,threadState:THREAD_STATE_IDLE,threadnumb:1,workerArray:[]});var t=nr.threadPoolBufferMGR.get(nr.zombiethreadssrc);e&&(t.threadState=THREAD_STATE_CREATING)}function Sr(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(t){if(r.threadState===THREAD_STATE_IDLE||104==t[0])a?$(e,a,t.length):n(e,t,t.length);else if(r.threadState===THREAD_STATE_CREATING){var i=new Uint8Array(t);r.pduBuffer.enqueue(i)}else if(r.threadState===THREAD_STATE_CREATED){for(var o=r.pduBuffer.dequeue();o;)n(e,o,o.length),o=r.pduBuffer.dequeue();a?$(e,a,t.length):n(e,t,t.length)}}else for(var s=r.pduBuffer.dequeue();s;)n(e,s,s.length),s=r.pduBuffer.dequeue()}function Er(e,t){if(Mt.ssrc&&gr(t)==gr(Mt.ssrc)&&(Mt.created=1),e.threadState=THREAD_STATE_CREATING,nr.SSrcWaitForThread.push(t),e.isCreateWorkers=!0,PThread.allocateUnusedWorkers)PThread.allocateUnusedWorkers(e.threadnumb,(function(){for(var t=0;t<e.threadnumb;t++){var r=nr.SSrcWaitForThread.shift();if(void 0!==r){var n=nr.threadPoolBufferMGR.get(r);n&&(n.threadState=THREAD_STATE_CREATED,Sr(Re,null,n,F))}}}));else for(var r=e.threadnumb,n=0;n<r;n++)nr.unusedworkerarray.length>0?br(nr.unusedworkerarray.shift()):nr.totalthread<ar&&(PThread.allocateUnusedWorker(),PThread.loadWasmModuleToWorker(PThread.unusedWorkers[nr.totalthread],br),nr.totalthread=nr.totalthread+1)}function br(e){for(var t=!1;nr.SSrcWaitForThread.length;){var r=nr.SSrcWaitForThread[0];if(r===nr.zombiethreadssrc||vt.Decode_Ssrc(r)||Mt.ssrc&&r==Mt.ssrc>>10<<10){if(void 0!==r){var n=nr.threadPoolBufferMGR.get(r);n&&(n.threadnumb=n.threadnumb-1,n.workerArray.push(e),n.threadnumb||(nr.SSrcWaitForThread.shift(),n.threadState=THREAD_STATE_CREATED,Mt.ssrc&&gr(r)==gr(Mt.ssrc)&&(Mt.created=2),Sr(Re,null,n,F))),t=!0;break}}else nr.SSrcWaitForThread.shift(),nr.threadPoolBufferMGR.delete(r)}t||nr.unusedworkerarray.push(e)}function Mr(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Ke||++se%24e4==0&&postMessage({status:MONITOR_MESSAGE,data:"WCL_M,RTCPVN"+se}),t&&r&&e){var a,i,o;if(1!=nr.videodecodethreadnumb&&(2==e[0]||103==e[0])&&e.length>15){if(2==e[0]){if(i=e[12]<<24|e[13]<<16|e[14]<<8|e[15],!(vt.Decode_Ssrc(i)||Mt.ssrc&&gr(i)==gr(Mt.ssrc)))return;i=i>>10<<10,a=nr.threadPoolBufferMGR.get(i)}else if(103==e[0]){if(i=e[7]<<24|e[6]<<16|e[5]<<8|e[4],!(vt.Decode_Ssrc(i)||Mt.ssrc&&gr(i)==gr(Mt.ssrc)))return;i=i>>10<<10,a=nr.threadPoolBufferMGR.get(i)}if(rn(),a)o=nr.threadPoolBufferMGR.get(i);else{if((o={}).isCreateWorkers=!1,o.threadState=THREAD_STATE_IDLE,o.pduBuffer=new M,!nr.initParseThread){var s=nr.threadPoolBufferMGR.get(nr.zombiethreadssrc);s.threadnumb=nr.totalNumbofParseThread,vr(!1),Er(s,nr.zombiethreadssrc),nr.initParseThread=!0}o.threadnumb=1,o.workerArray=[],nr.threadPoolBufferMGR.set(i,o),_n.set(i>>10<<10,2),Er(o,i)}}else i=nr.zombiethreadssrc,o=nr.threadPoolBufferMGR.get(i);Sr(t,e,o,r,n)}}var Ar=!1,wr=!1,Tr=!1,Rr=!0,Fr=h.WCL_PLATFORM_TYPE.DESKTOP,Dr={encodeThreadCreatedFlag:!1,codecThreadCreatedFlag:!1};Dr.threadPoolBufferMGR=new Map,Dr.waitingThread=[],Dr.vbThreadWorker=null,Dr.vbReadySetSpecialActionTrue=!1,Dr.threadState=THREAD_STATE_IDLE,Dr.isEnableVideoEncodeHardWareThread=!1,Dr.isSupportVirtualBackground=!1,Dr.videoencodethreadnumb=1,Dr.videoencodethreadmaxnumb=1,Dr.videoEncodeSmallVideoThread=null,Dr.nextWorker=null,Dr.loadedThreadCount=0,Dr.vbThreadCreatedFlag=!1,Dr.Signal_Encode_Thread={status:h.THREAD_STATE_IDLE,handle:null,initwebcodecflag:!1,latestflag:!1},Dr.threadarray=[];var kr=function(){function e(t){d()(this,e),this.workerJsUrl=t,this.worker=null,this.videoRenderObj=null,this.currentUserSsrc=0,this.vbDataQueueCounter=0}return c()(e,[{key:"setCurrentUserSsrc",value:function(e){this.currentUserSsrc=e}},{key:"generateVideoRenderObj",value:function(){this.videoRenderObj||(this.videoRenderObj=new p.a({Notify_APPUI:null,isSupportOffscreenCanvas:!0,jsMediaEngine:null,videodecodethreadnumb:1,enableReplaceCanvasWhenContextLost:!0}),this.videoRenderObj.setMirrorMyVideoOption(Ft),Ga&&this.videoRenderObj.Change_Current_SSRC(Ga),kn&&this.videoRenderObj.Set_LocalVideo_Buffer(kn),Dn&&this.videoRenderObj.Set_LocalVideo_Ptr(Dn))}},{key:"setMirrorMyVideoOption",value:function(e){this.videoRenderObj&&this.videoRenderObj.setMirrorMyVideoOption(e)}},{key:"replace_Canvas",value:function(e,t){this.videoRenderObj&&this.videoRenderObj.Replace_Canvas(e,t)}},{key:"render",value:function(e){var t=e.width,r=e.height,n=e.croppingParams,a=e.ptr,i=e.mode;if(this.videoRenderObj){var o=i&&i!==h.VIDEO_BGRA?t*r*3/2:t*r*4,s="number"==typeof a?Module.HEAPU8.subarray(a,a+o):a;this.videoRenderObj.Update_SelfVideo_Texture(t,r,s,gr(this.currentUserSsrc),i,n)}}},{key:"createVBThread",value:function(e){var t=this;this.workerJsUrl&&(this.worker=new Worker(this.workerJsUrl),this.worker.addEventListener("message",(function(e){e.data.status===h.Video_Dec_WASM_OK?t.postMessage({cmd:"loadWasmSuccess"}):"processed_capture_data_callback"==e.data.cmd&&t.updateVBDataQueueCounter(!1)})),this.worker.addEventListener("error",(function(e){Object(f.g)("Error from VB thread",e)})),this.worker.addEventListener("unhandledrejection",(function(e){Object(f.g)("Unhandled Promise rejection from VB thread: ".concat(e.reason))})),this.worker.isSingleThreadVBWorker=!0,mr(this.worker,e),this.generateVideoRenderObj())}},{key:"hasSubWorker",value:function(){return!!this.worker}},{key:"postMessage",value:function(e){if(this.worker){if("vbYuv"===e.cmd||"vbRgba"===e.cmd){if(!this.canTransferVBData(!0))return;this.updateVBDataQueueCounter(!0)}this.worker.postMessage(e)}}},{key:"updateVBDataQueueCounter",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.vbDataQueueCounter++:this.vbDataQueueCounter>0&&this.vbDataQueueCounter--}},{key:"canTransferVBData",value:function(e){return this.hasSubWorker()&&(!e||this.vbDataQueueCounter<=2)}}]),e}(),Ir=null,Cr=function(){function e(){var t=this;d()(this,e),this.initWasmSuccess=!1,this.tfjsUrl=null,this.modelArtifacts={},this.model=null,this.initTfSuccess=!1,this.IOhandle={load:function(){return t.modelArtifacts},save:function(){}},this.afnModel,this.afnModelArtifacts={},this.afnIOHandle={load:function(){return t.afnModelArtifacts},save:function(){}},this.baseModel,this.baseModelArtifacts={},this.baseIOHandle={load:function(){return t.baseModelArtifacts},save:function(){}},this.dualModelOKCount=0,this.tfLoad=!1,self.addEventListener("message",this.handleMessageFromEncodeWorker.bind(this)),self.execute=this.execute.bind(this),self.execute_afn=this.execute_afn.bind(this),self.execute_base=this.execute_base.bind(this)}return c()(e,[{key:"handleMessageFromEncodeWorker",value:function(e){var t=this;switch(e.data.cmd){case"load":break;case"loadWasmSuccess":this.initWasmSuccess=!0,this.checkVBThreadReady();break;case"vbObj0":this.tfjsUrl=e.data.tfjsUrl;var r=e.data.modelJSON;if(this.modelArtifacts.modelTopology=r.modelTopology,this.modelArtifacts.format=r.format,this.modelArtifacts.generatedBy=r.generatedBy,this.modelArtifacts.convertedBy=r.convertedBy,r.weightsManifest)for(var n=0;n<r.weightsManifest.length;n++)this.modelArtifacts.weightSpecs=r.weightsManifest[n].weights;r.trainingConfig&&(this.modelArtifacts.trainingConfig=r.trainingConfig),r.userDefinedMetadata&&(this.modelArtifacts.userDefinedMetadata=r.userDefinedMetadata),this.modelArtifacts.weightData=e.data.weightData,this.tfLoad&&(importScripts(this.tfjsUrl),tf.setBackend("webgl"),this.tfLoad=!0),tf.loadGraphModel(this.IOhandle).then((function(e){t.model=e,postMessage({cmd:"modelReady"});var r=new Float32Array(110592),n=tf.tensor4d(r,[1,144,256,3],"float32");t.model.predict(n),t.initTfSuccess=!0,t.checkVBThreadReady()}));break;case"vbObj1":this.tfjsUrl=e.data.tfjsUrl;var a=e.data.modelJSON;if(this.afnModelArtifacts.modelTopology=a.modelTopology,this.afnModelArtifacts.format=a.format,this.afnModelArtifacts.generatedBy=a.generatedBy,this.afnModelArtifacts.convertedBy=a.convertedBy,a.weightsManifest)for(var i=0;i<a.weightsManifest.length;i++)this.afnModelArtifacts.weightSpecs=a.weightsManifest[i].weights;a.trainingConfig&&(this.afnModelArtifacts.trainingConfig=a.trainingConfig),a.userDefinedMetadata&&(this.afnModelArtifacts.userDefinedMetadata=a.userDefinedMetadata),this.afnModelArtifacts.weightData=e.data.weightData,this.tfLoad||(importScripts(this.tfjsUrl),tf.setBackend("webgl"),this.tfLoad=!0),tf.loadGraphModel(this.afnIOHandle).then((function(e){t.afnModel=e,0==t.dualModelOKCount&&postMessage({cmd:"modelReady"});var r=new Float32Array(110592),n=new Float32Array(110592),a=new Float32Array(36864),i=tf.tensor4d(r,[1,144,256,3],"float32"),o=tf.tensor4d(n,[1,144,256,3],"float32"),s=tf.tensor4d(a,[1,144,256,1],"float32");t.afnModel.predict([i,o,s]),t.dualModelOKCount++,2==t.dualModelOKCount&&(t.initTfSuccess=!0,t.checkVBThreadReady())}));break;case"vbObj2":if(this.tfjsUrl=e.data.tfjsUrl,a=e.data.modelJSON,this.baseModelArtifacts.modelTopology=a.modelTopology,this.baseModelArtifacts.format=a.format,this.baseModelArtifacts.generatedBy=a.generatedBy,this.baseModelArtifacts.convertedBy=a.convertedBy,a.weightsManifest)for(i=0;i<a.weightsManifest.length;i++)this.baseModelArtifacts.weightSpecs=a.weightsManifest[i].weights;a.trainingConfig&&(this.baseModelArtifacts.trainingConfig=a.trainingConfig),a.userDefinedMetadata&&(this.baseModelArtifacts.userDefinedMetadata=a.userDefinedMetadata),this.baseModelArtifacts.weightData=e.data.weightData,this.tfLoad||(importScripts(this.tfjsUrl),tf.setBackend("webgl"),tfLoad=!0),tf.loadGraphModel(this.baseIOHandle).then((function(e){t.baseModel=e,0==t.dualModelOKCount&&postMessage({cmd:"modelReady"});var r=new Float32Array(110592),n=tf.tensor4d(r,[1,144,256,3],"float32");t.baseModel.predict(n),t.dualModelOKCount++,2==t.dualModelOKCount&&(t.initTfSuccess=!0,t.checkVBThreadReady())}));break;case"vbBg":if(e.data.data){var o=e.data,s=o.length,d=o.width,u=o.height;Ha.sendBg(e.data.data,s,d,u)}break;case"vbBlur":Ha.sendBlur();break;case"vbYuv":if(e.data.data){var c=e.data,l=c.length,_=c.width,f=c.height,h=c.yDataLength,p=c.uDataLength,m=c.vDataLength,v=c.yStride,g=c.uStride,y=c.vStride,S=c.xOffset,E=c.yOffset,b=c.dataFormat,M=An(e.data.data);Ha.sendYuvData(M,l,_,f,h,p,m,v,g,y,S,E,b)}break;case"vbRgba":if(e.data.data){var A=e.data,w=A.length,T=A.width,R=A.height,F=A.rgbaStride,D=A.xOffset,k=A.yOffset,I=A.dataFormat,C=An(e.data.data);Ha.sendRgbaData(C,w,T,R,F,D,k,I)}break;default:console.warn("unknown message in single thread vb worker:",e.data.cmd)}}},{key:"checkVBThreadReady",value:function(){this.initWasmSuccess&&this.initTfSuccess&&(postMessage({cmd:"vbPredictDone"}),K())}},{key:"execute",value:function(e,t,r,n){if(this.model)try{var a=new Float32Array(Module.HEAPU8.buffer,e,t),i=tf.tensor4d(a,[1,144,256,3],"float32"),o=this.model.predict(i),s=Float32Array.from(o.as1D(36864).arraySync());return Module.HEAPF32.set(s,r>>2),i.dispose(),o.dispose(),0}catch(r){return Object(f.g)("Error in SingleThreadVBWorker.execute: ".concat(e,", ").concat(t,", ").concat(input_data),r),-1}}},{key:"execute_base",value:function(e,t,r,n){if(this.baseModel){try{var a,i,o=new Float32Array(wasmMemory.buffer,e,t),s=tf.tensor4d(o,[1,144,256,3],"float32"),d=this.baseModel.predict(s);1==d[0].size?(a=Float32Array.from(d[0].as1D(36864).arraySync()),i=Float32Array.from(d[1].as1D(1).arraySync())):(a=Float32Array.from(d[1].as1D(36864).arraySync()),i=Float32Array.from(d[0].as1D(1).arraySync()));var u=new Float32Array(wasmMemory.buffer);u.set(i,r>>2),u.set(a,n>>2),s.dispose(),d[1].dispose(),d[0].dispose()}catch(r){return Object(f.g)("Error in SingleThreadVBWorker.execute: ".concat(r,", ").concat(e,", ").concat(t,", ").concat(o)),-1}return 0}}},{key:"execute_afn",value:function(e,t,r,n,a){if(this.afnModel){try{var i=new Float32Array(Module.HEAPU8.buffer,e,n),o=new Float32Array(Module.HEAPU8.buffer,t,n),s=new Float32Array(Module.HEAPU8.buffer,r,n/3),d=tf.tensor4d(i,[1,144,256,3],"float32"),u=tf.tensor4d(o,[1,144,256,3],"float32"),c=tf.tensor4d(s,[1,144,256,1],"float32"),l=this.afnModel.predict([d,u,c]),_=Float32Array.from(l.as1D(36864).arraySync());Module.HEAPF32.set(_,a>>2),d.dispose(),u.dispose(),c.dispose(),l.dispose()}catch(e){return Object(f.g)("Error in SingleThreadVBWorker.execute: ".concat(e,", ").concat(input_buffer,", ").concat(n,", ").concat(input_data)),-1}return 0}}}]),e}(),Or=null;function xr(e,t){Dr.threadPoolBufferMGR.get(e)||Dr.threadPoolBufferMGR.set(e,{threadState:THREAD_STATE_IDLE,workerArray:[],threadnumb:t});var r=Dr.threadPoolBufferMGR.get(e);if(r.threadState==h.THREAD_STATE_IDLE){r.threadState=h.THREAD_STATE_CREATING,Dr.waitingThread.push(e);for(var n=0;n<t;n++)if(pr()){PThread.allocateUnusedWorker();var a=PThread.unusedWorkers.pop();PThread.loadWasmModuleToWorker(a,Lr)}else Ir&&Ir.createVBThread(Lr)}}function Pr(e){if(tr&&!rr){Dr.threadState=h.THREAD_STATE_CREATING;var t=Dr.videoencodethreadnumb;Dr.Signal_Encode_Thread.status=h.THREAD_STATE_CREATING,t+=h.ADDITIONNAL_MULTITHREAD_NUMBER_ENCODE_FOR_720P;for(var r=0;r<t;r++){PThread.allocateUnusedWorker();var n=PThread.unusedWorkers.pop();PThread.loadWasmModuleToWorker(n,(function(r){Dr.loadedThreadCount++,1==Dr.loadedThreadCount?(Dr.videoEncodeSmallVideoThread=r,Dr.threadarray.push(r)):Dr.isEnableVideoEncodeHardWareThread&&2==Dr.loadedThreadCount?(Dr.Signal_Encode_Thread.status=h.THREAD_STATE_CREATED,Re&&B(Re,Dr.Signal_Encode_Thread.latestflag),Dr.Signal_Encode_Thread.handle=r):Dr.threadarray.push(r),Dr.loadedThreadCount==t&&(Dr.threadState=h.THREAD_STATE_CREATED,rr=!0,Gn(e))}))}}}function Lr(e){var t=Dr.waitingThread[0];if(void 0!==t){var r=Dr.threadPoolBufferMGR.get(t);r&&(r.threadnumb=r.threadnumb-1,r.workerArray.push(e),r.threadnumb||(Dr.waitingThread.shift(),r.threadState=THREAD_STATE_CREATED,"VB"==t&&(postMessage({status:Video_Dec_Handle_OK}),Dr.vbThreadWorker=e,Va(0),Va(1),Va(2))))}}function Ur(){return tr?1:0}function Vr(){return navigator.hardwareConcurrency||1}function Nr(){return nr.videodecodethreadnumb>1&&nr.isEnableVideoDecodeHardWareThread?1:0}function Br(){return!!Ar}function Hr(){return!!or.isTeslaMode}function Wr(){return 1}function Gr(){return 8}function jr(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(t=e instanceof Uint8Array?e:new Uint8Array(e)).length>=1&&0==t[0]||0===t.length||(Re?Mr(t,Re,F,r):console.log("video handle is not ready!"))}function qr(e){Qr({data:e.buffer})}pr()||self.addEventListener("message",(function e(t){"load"===t.data.cmd&&t.data.isSingleThreadVBWorker&&(Or=new Cr,postMessage({cmd:"loaded"}),self.removeEventListener("message",e))}));var Yr,Kr=function(e){if(e&&(Yr=e),Re&&Yr){var t=new Uint8Array(44);t[0]=102,t[4]=2,t[8]=32,t.set(Yr,12,Yr.length),F(Re,t,t.length)}};function Qr(e){if(Re){var t=new Uint8Array(e.data);if(102==t[0])return;t.length>=1&&0==t[0]?De.send(t):t.length>=1&&(16==t[0]&&(He=t),Mr(t,Re,F))}}function Xr(e){if(Re){var t=new Uint8Array(e.data);t.length>=1&&0==t[0]?ke.send(t):Mr(t,Re,F)}}function zr(e){Fe.splice(Fe.indexOf(e),1)}function Zr(e,t){$e&&(et=!1),postMessage({status:h.CONNECT_WEBSOCKET_CLOSE}),b("video_websocket_on_close"),zr(t)}function Jr(e){}function $r(e){if(e==h.VIDEO_CAPTURER_RESOLUTION_720P&&Tr&&1280!==je){if(postMessage({status:h.VIDEO_CAPTURER_RESOLUTION_CHANGE,width:1280,height:720}),Fr==h.WCL_PLATFORM_TYPE.IPHONE){var t=h.VIDEO_CAPTURE_20FPS;Wt.start(Hn,1e3/t)}else if(Fr==h.WCL_PLATFORM_TYPE.ANDROID){var r=h.DOWN_VIDEO_CAPTURE_FPS;Wt.start(Hn,1e3/r)}}else e==h.VIDEO_CAPTURER_RESOLUTION_360P&&postMessage({status:h.VIDEO_CAPTURER_RESOLUTION_CHANGE,width:640,height:360})}function en(e,t,r){var n=Module.HEAP8.subarray(t+0,t+r),a=new Uint8Array(r);if(a.set(n,0,r),Fe.length>0){var i=Fe[Ce++%Fe.length];i&&1===i.socket.readyState&&i.send(a)}}var tn=0;function rn(){ze&&1!==tn?(tn=1,postMessage({status:h.CURRENT_MEDIA_DATA_TRANSPORT_TYPE,type:tn})):Xe&&!ze&&2!==tn?(tn=2,postMessage({status:h.CURRENT_MEDIA_DATA_TRANSPORT_TYPE,type:tn})):Xe||ze||3===tn||(tn=3,postMessage({status:h.CURRENT_MEDIA_DATA_TRANSPORT_TYPE,type:tn}))}function nn(e,t,r,n,a,i,o){if(!isPreviewMode){var s,d,u=null;if(o||(s=Module.HEAP8.subarray(t+0,t+r)),$e){if(o?d=t:et?((u=new Uint8Array(4))[0]=n,u[1]=a):((d=new Uint8Array(r+4))[0]=n,d[1]=a,d.set(s,4,r)),ze&&Ie&&Ie.transport_ready)return rn(),u&&((d=new Uint8Array(r+4))[0]=n,d[1]=a,d.set(s,4,r)),void Ie.send(d);if(!et)return tt||(tt=new M),void tt.enqueue({data:d,isDC:i});if(i&&Xe)if(rn(),self.videoRingBufferWriter)u&&self.videoRingBufferWriter.enqueueSafe([u,s],!1)||(d||((d=new Uint8Array(r+4))[0]=n,d[1]=a,d.set(s,4,r)),self.videoRingBufferWriter.enqueueSafe(d)),self.bVideoEncodeMainThreadConsumerIntervalEnable||postMessage(h.WORKER_MAIN_VIDEO_ENCODE_RINGBUFFER_TICK);else if(u){var c=new Uint8Array(r+4);c[0]=n,c[1]=a,c.set(s,4,r),self.postMessage({status:h.VIDEO_ENCODED_DATA,data:c},[c.buffer])}else self.postMessage({status:h.VIDEO_ENCODED_DATA,data:d},[d.buffer]);!(Fe.length>0)||i&&Je||(rn(),o?d=t:u&&((d=new Uint8Array(r+4))[0]=n,d[1]=a,d.set(s,4,r)),(l=Fe[Ce++%Fe.length])&&1===l.socket.readyState&&l.send(d))}else{if(ze&&Ie&&Ie.transport_ready)return o?d=t:((d=new Uint8Array(r+4))[0]=n,d[1]=a,d.set(s,4,r)),void Ie.send(d);var l;Xe?self.videoRingBufferWriter?(o?(d=t,self.videoRingBufferWriter.enqueue(d)):((u=new Uint8Array(4))[0]=n,u[1]=a,self.videoRingBufferWriter.enqueue([u,s])),self.bVideoEncodeMainThreadConsumerIntervalEnable||postMessage(h.WORKER_MAIN_VIDEO_ENCODE_RINGBUFFER_TICK)):(o?d=t:((d=new Uint8Array(r+4))[0]=n,d[1]=a,d.set(s,4,r)),self.postMessage({status:h.VIDEO_ENCODED_DATA,data:d},[d.buffer])):(o?d=t:((d=new Uint8Array(r+4))[0]=n,d[1]=a,d.set(s,4,r)),Fe.length>0&&(l=Fe[Ce++%Fe.length])&&1===l.socket.readyState&&l.send(d))}}}function an(e,t,r,n,a,i,o,s,d,u){if(t){if(Or){var c=Module.HEAPU8.subarray(t,t+r),l=new Uint8Array(r);return l.set(c,0,r),postMessage({cmd:"processed_capture_data_callback",ssrc:e,data:l,len_of_data:r,format_width:n,format_height:a,valid_x:i,valid_y:o,valid_width:s,valid_height:d,yuv_limited:u}),l=null,void(t&&Module._free(t))}var _="number"==typeof t;if(it||ia||It)if(Ot){var f;_?(Atomics.load(lt,0),Pn=Atomics.load(lt,1),xn=ut+4+(h.VIDEO_DATA_MAX_SIZE+4+8+2)*Pn+4+8,f=Module.HEAPU8.subarray(t+0,t+r),Module.HEAPU8.subarray(xn,xn+r).set(f,0,r),_t[2+(h.VIDEO_DATA_MAX_SIZE+4+8+2)*Pn/2]=n,_t[2+((h.VIDEO_DATA_MAX_SIZE+4+8+2)*Pn+2)/2]=a,_t[2+((h.VIDEO_DATA_MAX_SIZE+4+8+2)*Pn+4)/2]=o,_t[2+((h.VIDEO_DATA_MAX_SIZE+4+8+2)*Pn+6)/2]=i,_t[2+((h.VIDEO_DATA_MAX_SIZE+4+8+2)*Pn+8)/2]=s,_t[2+((h.VIDEO_DATA_MAX_SIZE+4+8+2)*Pn+10)/2]=d,_t[2+((h.VIDEO_DATA_MAX_SIZE+4+8+2)*Pn+12)/2]=1):(it&&Ir.render({width:n,height:a,croppingParams:{top:o,left:i,width:s,height:d},ptr:t,mode:1}),xn=An(f=t));var p=n*a,m=n*a/4,v=n*a/4,g=n,y=n/2,S=n/2,E=i,b=o;2==Tt&&je==s&&qe==d||(je=s,qe=d,Tt=2,Ya());var M=Cn();if(M){var A=new VideoFrame(f,{format:"I420",timestamp:0,duration:0,codedWidth:n,codedHeight:a,visibleRect:{left:i,top:o,width:s,height:d}});On(A),A.close()}R(Re,xn,p,xn+p,m,xn+p+m,v,g,y,S,E,b,Tt,M,0,Ln++),_&&(Atomics.store(lt,1,(Pn+1)%10),lt[2]=1),It&&Ka(n,a,f,{top:o,left:i,width:s,height:d},1),_?t&&Module._free(t):(f=null,wn(xn))}else _&&t&&Module._free(t);else _&&(t&&Module._free(t),_t&&Atomics.store(_t,0,0))}}var on=null;function sn(e){var t=e.data;if(Xe){var r=[h.MEDIA_VIDEO_DATA,h.MEDIA_VIDEO_RTCP];if(Ke&&-1!==r.indexOf(t[0]))return void postMessage({status:VIDEO_ENCODED_DATA,data:t},[t.buffer])}if(Fe.length>0){var n=Fe[Ce++%Fe.length];n&&1===n.socket.readyState&&n.send(t)}}var dn,un=(dn=!1,function(e,t,r){!dn&&e&&t&&r&&(dn=!0,postMessage({status:"FIRST_VIDEO_FRAME"}))});function cn(e,t,r,n,a,i,o,s,d,u,c,l){var _=Module.HEAPU8.subarray(e+0,e+t),p=Module.HEAP8.subarray(r,r+8),m=new Uint8Array(8);m.set(p,0,8);for(var g=0,y=0;y<8;y++)g+=m[y]*Math.pow(256,y);var S=n>>10<<10,E=a,b=i;if(un(S,je=E,qe=b),Rn&&Object(f.j)({ssrc:n,width:E,height:b}),Mt.ssrc&&gr(Mt.ssrc)==gr(S)&&!Mt.firstflag&&(postMessage({status:"NewActiveSpeakerFirstframeCallback",ssrc:Mt.ssrc}),Mt.firstflag=!0),St){if(!yt)return;if(ae){(R=new Uint8Array(_.length)).set(_,0,_.length);var M={cmd:"decoded",yuvdataptr:0,yuvdata:0,yuvlength:_.length,data:R,ntptime:g,ssrc:S,width:E,height:b,r_y:s,r_x:o,r_h:u,r_w:d,rotation:c,yuv_limited:l,enableMultiDecodeVideoWithoutSAB:ae};return void vt.Put_Video_Data_Queue(M)}on||(on=new f.a);var A=new f.c(on);if(A.storeSync(_)){var w={yuvdata:A,ntptime:g,ssrc:S,width:E,height:b,r_x:o,r_y:s,r_w:d,r_h:u,rotation:c,yuv_limited:l};vt&&vt.Put_Video_Data_Queue(w,8)}}else if(self.videoDecodeFrameBackSABRingBuffer){var T=new v.c;T.setOBJ({data:_,video_timestamp:g,video_ssrc:S,video_width:E,video_height:b,rendering_x:o,rendering_y:s,rendering_w:d,rendering_h:u,rotation:c,yuv_limited:l}),self.videoDecodeFrameBackSABRingBuffer.enqueue(T.obj2buffer()),postMessage({status:h.WORKER_MAIN_VIDEO_DECODE_RINGBUFFER_TICK})}else{var R;(R=new Uint8Array(t)).set(_,0,t),postMessage({status:0,data:R,video_timestamp:g,video_ssrc:S,video_width:E,video_height:b,rendering_x:o,rendering_y:s,rendering_w:d,rendering_h:u,rotation:c,yuv_limited:l},[R.buffer])}}function ln(e,t,r,n){postMessage({status:VIDEO_DATA_DROP_RATIO,current_lostrate:e,average_lostrate:t,max_lostrate:r,min_lostrate:n})}var _n=new Map;function fn(e,t){_n.set(e>>10<<10,t);var r=Array.from(_n.values()),n=Math.max.apply(null,r);Ye!==n&&(Ye=n,postMessage({status:DECODE_MESSAGE,ssrc:e,size:Ye}))}function hn(e,t){var r=new Uint8Array(t),n=Module.HEAP8.subarray(e+0,e+t);if(r.set(n,0,t),Fe.length>0){var a=Fe[Ce++%Fe.length];a&&1===a.socket.readyState&&Fe[Ce++%Fe.length].send(r),Ce++}}function pn(e,t){var r=new Uint8Array(t),n=Module.HEAP8.subarray(e+0,e+t);r.set(n,0,t),postMessage({status:APP_TROUBLESHOOTING_INFO,data:En(r)})}function mn(e,t,r,n){r}function vn(e,t,r,n){}function gn(e,t,r,n){}function yn(e,t){}function Sn(e,t){}function En(e){var t,r,n,a,i,o;for(t="",n=e.length,r=0;r<n;)switch((a=e[r++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(a);break;case 12:case 13:i=e[r++],t+=String.fromCharCode((31&a)<<6|63&i);break;case 14:i=e[r++],o=e[r++],t+=String.fromCharCode((15&a)<<12|(63&i)<<6|(63&o)<<0)}return t}function bn(e){try{var t=(new Date).getTime(),r=new URL(e);r.searchParams.set("filename","_"+t+"_video_log"),r.searchParams.set("type","d"),Open_Video_WebSocket_Connect_Debug(r.toString(),video_websocket_on_open_Debug,Zt,Jr,Zr)}catch(e){console.error(e)}}function Mn(e,t){we||(we=setInterval((function(){Re&&L(Re)}),6e4));var r=new Uint8Array(t),n=Module.HEAP8.subarray(e+0,e+t);r.set(n,0,t),Te=r,postMessage({status:h.AES_GCM_IV_CALLBACK_FROM_WASM,data:r})}function An(e){if(!e)return 0;var t=Module._malloc(e.length);return Module.HEAPU8.subarray(t,t+e.length).set(e,0,e.length),t}function wn(e){e&&Module._free(e)}new M;var Tn,Rn=!1;function Fn(e){if(!yt)return Module._free(e.yuvdataptr),void(e.yuvdataptr=null);vt&&(un(e.ssrc,e.width,e.height),Rn&&Object(f.j)(e),Mt.ssrc&&gr(Mt.ssrc)==gr(e.ssrc)&&!Mt.firstflag&&(postMessage({status:"NewActiveSpeakerFirstframeCallback",ssrc:Mt.ssrc}),Mt.firstflag=!0),vt.Update_RemoteVideo_Texture(e))}var Dn=null,kn=null;function In(e){e.bCopyData?jr(e.buffer):nr.isSupportMultiThread?jr(e.uint8s,e.begin):jr(e.uint8s,0)}function Cn(){var e=!1;return je>=ir&&(Dr.Signal_Encode_Thread.initwebcodecflag&&Dr.Signal_Encode_Thread.status==h.THREAD_STATE_IDLE?function(){if(tr&&!Dr.Signal_Encode_Thread.initwebcodecflag&&Dr.Signal_Encode_Thread.status==h.THREAD_STATE_IDLE){Dr.Signal_Encode_Thread.status=h.THREAD_STATE_CREATING,PThread.allocateUnusedWorker();var e=PThread.unusedWorkers.pop();PThread.loadWasmModuleToWorker(e,(function(){Dr.Signal_Encode_Thread.status=h.THREAD_STATE_CREATED,Re&&B(Re,Dr.Signal_Encode_Thread.latestflag),Dr.Signal_Encode_Thread.handle=e}))}}():Dr.Signal_Encode_Thread.status==h.THREAD_STATE_CREATED&&(e=!0)),e}function On(e){Dr.Signal_Encode_Thread.handle&&Dr.Signal_Encode_Thread.handle.postMessage({cmd:"videoframe",data:e})}var xn,Pn,Ln=0,Un=0,Vn=0;function Nn(e){return Bn.apply(this,arguments)}function Bn(){return(Bn=o()(_.a.mark((function e(t){var r,n,a,i,o,s,d,u,c,l,f,p,m,v,g,y,S,E,b,M,A,w,F,D,k,I,C,O,x,P,L,U,V,N,B,H,W,G,j,q,Y,K,Q,X;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ut||(nr.isSupportMultiThread?(ft=4+10*h.VIDEO_DATA_MAX_SIZE+120+20,ut=Module._malloc(ft),lt=Module.HEAPU8.subarray(ut,ut+ft),_t=Module.HEAPU16.subarray(ut/2,(ut+ft)/2),Atomics.store(_t,0,0),postMessage({status:WASMPTR,data:ut,wasmMemory:wasmMemory})):(ft=h.VIDEO_DATA_MAX_SIZE,ut=Module._malloc(ft))),wr?(Un++,wr=!1):Vn++,(200==Un&&Un>Vn||200==Vn&&Vn>Un)&&(Un=0,Vn=0),a=0,i=0,o=0,s=0,d=0,u=0,c=0,l=0,f=0,p=0,m=0,v=0,Ot?(E=h.VIDEO_DATA_MAX_SIZE,ct=Module._malloc(E),r=ct,Pt<8&&Lt>h.DOWN_VIDEO_CAPTURE_FPS&&(Lt=h.DOWN_VIDEO_CAPTURE_FPS,Wt.start(Hn,1e3/Lt))):(nr.isSupportMultiThread?(Atomics.load(lt,0),Pn=Atomics.load(lt,1),xn=ut+4+(h.VIDEO_DATA_MAX_SIZE+4+8+2)*Pn+4+8,n=0):xn=ut,r=xn),!t.frame||!t.format||2!=t.format&&4!=t.format){e.next=93;break}if(b=t.frame,l=b.visibleRect?b.visibleRect.width:b.cropWidth,f=b.visibleRect?b.visibleRect.height:b.cropHeight,p=b.visibleRect?b.visibleRect.left:b.cropLeft,m=b.visibleRect?b.visibleRect.top:b.cropTop,l===je&&f===qe){e.next=25;break}return"close"in b?b.close():b.destroy(),e.abrupt("return");case 25:if("copyTo"in b?(a=f,o=(i=l)/2,s=i/2,d=l*f,u=l*f/4,c=l*f/4,n=v=l*f*3/2,p=0,m=0):(g=b.planes[0],d=g.length,y=b.planes[1],u=y.length,S=b.planes[2],c=S.length,i=b.planes[0].stride,a=b.planes[0].rows,o=b.planes[1].stride,s=b.planes[2].stride,n=v=d+u+c),wt=2,Ct){e.next=52;break}if(!("copyTo"in b)){e.next=41;break}if(2!=t.format){e.next=35;break}return ge=Module.HEAPU8.subarray(r,r+v),e.next=33,b.copyTo(ge);case 33:e.next=39;break;case 35:return M=l*f*5/2,ge=Module.HEAPU8.subarray(r,r+M),e.next=39,b.copyTo(ge);case 39:e.next=47;break;case 41:ge=Module.HEAPU8.subarray(r,r+d),ye=Module.HEAPU8.subarray(r+d,r+d+u),Se=Module.HEAPU8.subarray(r+d+u,r+d+u+c),g.readInto(ge),y.readInto(ye),S.readInto(Se);case 47:Ot||2==Tt||(Tt=2,Ya()),Ot?Ha.sendYuvData(r,0,je,qe,d,u,u,i,o,o,p,m,2):((A=Cn())&&On(b),R(Re,r,d,r+d,u,r+d+u,c,i,o,s,p,m,Tt,A,0,Ln++)),Rr=!0,e.next=90;break;case 52:if(D=(w={top:m,left:p,width:l,height:f}).width>=ir&&Dr.Signal_Encode_Thread.status==h.THREAD_STATE_CREATED,!pe){e.next=58;break}F=Ma(b,w,xn,D),e.next=80;break;case 58:if(4==t.format?(k=l*f*5/2,Yn&&Ee&&Ee.length==k||(Yn&&Module._free(Yn),Yn=Module._malloc(k))):oa&&oa.length==v||(oa=new Uint8Array(v)),!("copyTo"in b)){e.next=73;break}if(4!=t.format){e.next=68;break}return I=l*f*5/2,Ee=Module.HEAPU8.subarray(Yn,Yn+I),e.next=65,b.copyTo(Ee);case 65:oa=new Uint8Array(Ee.buffer,Yn,v),e.next=70;break;case 68:return e.next=70,b.copyTo(oa);case 70:F=Ia(i,a,oa,xn,w,wt,D),e.next=80;break;case 73:ge=oa.subarray(0,0+d),ye=oa.subarray(d,d+u),Se=oa.subarray(d+u,d+u+c),g.readInto(ge),y.readInto(ye),S.readInto(Se),F=Ia(i,a,oa,xn,w,wt,D);case 80:Ot||1==Tt||(Tt=1,Ya()),it&&((C=Cn())&&On(F),T(Re,xn,ea,4*Vt.rgba_stride,Vt.rgba_x,Vt.rgba_y,Tt,C,0,Ln++)),F&&F.close(),Rr=!0,i=je,a=qe,l=je,f=qe,p=0,m=0;case 90:"close"in b?b.close():b.destroy(),e.next=199;break;case 93:if(!t.frame||!t.format||3!=t.format){e.next=136;break}if(O=t.frame,l=O.visibleRect?O.visibleRect.width:O.cropWidth,f=O.visibleRect?O.visibleRect.height:O.cropHeight,p=O.visibleRect?O.visibleRect.left:O.cropLeft,m=O.visibleRect?O.visibleRect.top:O.cropTop,l===je&&f===qe){e.next=102;break}return"close"in O?O.close():O.destroy(),e.abrupt("return");case 102:if("copyTo"in O?(a=f,o=i=l,d=l*f,u=l*f/2,n=v=l*f*3/2,p=0,m=0):(g=O.planes[0],d=g.length,y=O.planes[1],u=y.length,i=O.planes[0].stride,a=O.planes[0].rows,o=O.planes[1].stride,n=v=d+u),wt=3,Ct){e.next=120;break}if(!("copyTo"in O)){e.next=111;break}return ge=Module.HEAPU8.subarray(r,r+v),e.next=109,O.copyTo(ge);case 109:e.next=115;break;case 111:ge=Module.HEAPU8.subarray(r,r+d),ye=Module.HEAPU8.subarray(r+d,r+d+u),g.readInto(ge),y.readInto(ye);case 115:Ot||3==Tt||(Tt=3,Ya()),Ot?Ha.sendYuvData(r,0,je,qe,d,u,u,i,o,o,p,m,3):((x=Cn())&&On(O),R(Re,r,d,r+d,u,r+d,u,i,o,o,p,m,Tt,x,0,Ln++)),Rr=!0,e.next=133;break;case 120:U=(P={top:m,left:p,width:l,height:f}).width>=ir&&Dr.Signal_Encode_Thread.status==h.THREAD_STATE_CREATED,pe?L=Ma(O,P,xn,U):(oa&&oa.length==v||(oa=new Uint8Array(v)),"copyTo"in O?(O.copyTo(oa),L=Ia(i,a,oa,xn,P,wt,U)):(ge=oa.subarray(0,0+d),ye=oa.subarray(d,d+u),g.readInto(ge),y.readInto(ye),L=Ia(i,a,oa,xn,P,wt,U))),Ot||1==Tt||(Tt=1,Ya()),it&&((V=Cn())&&On(L),T(Re,xn,ea,4*Vt.rgba_stride,Vt.rgba_x,Vt.rgba_y,Tt,V,0,Ln++)),L&&L.close(),Rr=!0,i=je,a=qe,l=je,f=qe,p=0,m=0;case 133:"close"in O?O.close():O.destroy(),e.next=199;break;case 136:if(!t.frame||!t.format||5!=t.format){e.next=187;break}if(N=t.frame,l=N.visibleRect?N.visibleRect.width:N.cropWidth,f=N.visibleRect?N.visibleRect.height:N.cropHeight,p=N.visibleRect?N.visibleRect.left:N.cropLeft,m=N.visibleRect?N.visibleRect.top:N.cropTop,l===je&&f===qe){e.next=145;break}return"close"in N?N.close():N.destroy(),e.abrupt("return");case 145:if("copyTo"in N&&(n=v=l*f*4,i=l,a=f,p=0,m=0),wt=4,B=4,Ct){e.next=160;break}if(!("copyTo"in N)){e.next=155;break}return H=Module.HEAPU8.subarray(r,r+v),e.next=153,N.copyTo(H);case 153:e.next=155;break;case 155:Ot||Tt==B||(Tt=B,Ya()),Ot?Ha.sendRgbaData(r,v,je,qe,4*Vt.rgba_stride,Vt.rgba_x,Vt.rgba_y,B):((W=Cn())&&On(N),T(Re,r,v,4*Vt.rgba_stride,Vt.rgba_x,Vt.rgba_y,Tt,W,0,Ln++)),Rr=!0,e.next=184;break;case 160:if(q=(G={top:m,left:p,width:l,height:f}).width>=ir&&Dr.Signal_Encode_Thread.status==h.THREAD_STATE_CREATED,!pe){e.next=166;break}j=Ma(N,G,r,q),e.next=173;break;case 166:if(oa&&oa.length==v||(oa=new Uint8Array(v)),!("copyTo"in N)){e.next=173;break}return e.next=170,N.copyTo(oa);case 170:j=Ia(i,a,oa,r,G,wt,q),e.next=173;break;case 173:B=1,Ot||Tt==B||(Tt=B,Ya()),it&&((Y=Cn())&&On(j),T(Re,r,v,4*Vt.rgba_stride,Vt.rgba_x,Vt.rgba_y,Tt,Y,0,Ln++)),j&&j.close(),Rr=!0,i=je,a=qe,l=je,f=qe,p=0,m=0;case 184:"close"in N?N.close():N.destroy(),e.next=199;break;case 187:Ot||1==Tt||(wt=1,Tt=1,Ya()),i=je,a=qe,l=je,f=qe,p=0,m=0,K=Module.HEAPU8.subarray(r,r+t.length),n=t.length,ea=t.length,K.set(t,0,n),Ot?Ha.sendRgbaData(r,ea,i,a,4*Vt.rgba_stride,Vt.rgba_x,Vt.rgba_y,1):T(Re,r,ea,4*Vt.rgba_stride,Vt.rgba_x,Vt.rgba_y,1,!1,0,Ln++);case 199:Ot||(nr.isSupportMultiThread?(_t[2+(h.VIDEO_DATA_MAX_SIZE+4+8+2)*Pn/2]=i,_t[2+((h.VIDEO_DATA_MAX_SIZE+4+8+2)*Pn+2)/2]=a,_t[2+((h.VIDEO_DATA_MAX_SIZE+4+8+2)*Pn+4)/2]=m,_t[2+((h.VIDEO_DATA_MAX_SIZE+4+8+2)*Pn+6)/2]=p,_t[2+((h.VIDEO_DATA_MAX_SIZE+4+8+2)*Pn+8)/2]=l,_t[2+((h.VIDEO_DATA_MAX_SIZE+4+8+2)*Pn+10)/2]=f,_t[2+((h.VIDEO_DATA_MAX_SIZE+4+8+2)*Pn+12)/2]=Tt-1,Atomics.store(lt,1,(Pn+1)%10),lt[2]=Tt-1):Ir&&Ir.render({width:i,height:a,croppingParams:{top:m,left:p,width:l,height:f},ptr:r,mode:Tt-1}),It&&(Q={top:m,left:p,width:l,height:f},X=new Uint8Array(Module.HEAPU8.subarray(xn,xn+n)),Ka(i,a,X,Q,Tt-1)));case 200:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Hn(){for(++oe%1440==0&&postMessage({status:MONITOR_MESSAGE,data:"WCL_M,VCTN"+oe});ne.getLength()>2;){var e=ne.dequeue();e&&e.frame?"close"in e.frame?e.frame.close():e.frame.destroy():fe||_e||he||!Be&&e&&postMessage({data:e},[e.buffer])}if(tr&&(Dr.isSupportVirtualBackground&&Qn&&!Ct&&!Dr.vbThreadCreatedFlag||Dr.threadState==h.THREAD_STATE_IDLE)){var t=ne.dequeue();t&&t.frame?"close"in t.frame?t.frame.close():t.frame.destroy():!Be&&t?postMessage({status:Video_Capture_Tick,data:t},[t.buffer]):postMessage({status:Video_Capture_Tick})}else{if(he&&me&&Rr)me.read().then((function(e){var t=e.done,r=e.value;if(t)r&&r.close();else{var n,a=r;if("undefined"==a||null==a||null==a.format||"undefined"==a.format)return Object(f.g)("video frame reader read null frame"),void("close"in a&&a.close());if(a.format&&"I420"==a.format)n={frame:a,format:2};else if(a.format&&"NV12"==a.format)n={frame:a,format:3};else if(a.format&&"I420A"==a.format)n={frame:a,format:4};else if(a.format&&"BGRA"==a.format)n={frame:a,format:5};else if(a.format)return console.error("dataformat:",a.format,"is not supported"),kt||(kt=!0,postMessage({status:h.UNSUPPORTED_VIDEO_FORMAT,format:a.format})),void("close"in a?a.close():a.destroy());var i=a.visibleRect?a.visibleRect.width:a.cropWidth,o=a.visibleRect?a.visibleRect.height:a.cropHeight,s="BGRA"==a.format?4:"I420A"===a.format?2:n.format;je===i&&qe===o&&wt===s||(je=i,qe=o,Vt.rgba_stride=i,Vt.rgba_x=0,Vt.rgba_y=0,wt=s,Ya(),postMessage({status:h.CURRENT_CAPTURE_VIDEO_WIDTH_HEIGHT,width:je,height:qe})),3e3==Rt&&(postMessage({status:h.VIDEO_CAPTURE_FRAME_COUNT_STATISTIC}),Rt=0),Rt++,Nn(n)}}));else{var r=ne.dequeue();r&&Nn(r)}0!=ht.size||ce||fe||he||_e||(!Be&&r&&r.length?postMessage({status:Video_Capture_Tick,data:r},[r.buffer]):postMessage({status:Video_Capture_Tick}))}}var Wn=!1;function Gn(e){if(Re&&Ze&&(Ze=!1,w(Re),Re=null),!Re){var t,r,n=Te;if(t=n?n.length:0,r=An(n),(Re=A(e.ssid,e.mtu_size,de,ue,r,t,Dr.videoencodethreadmaxnumb,Dr.Signal_Encode_Thread.status==h.THREAD_STATE_CREATED&&Dr.Signal_Encode_Thread.latestflag,Ke,$e,Ut,!1,Nt))&&$e&&H(Re,Xe||ze?0:2),wn(r),!Re)return void postMessage({status:Video_Dec_Handle_FAILED});if(L(Re),Me){var a=Module._malloc(Me.length);Module.HEAPU8.subarray(a,a+Me.length).set(Me,0,Me.length),x(Re,Ae,a,Me.length),Module._free(a)}He&&F(Re,He,He.length),O(Re,Ne?1:0),je=e.width,qe=e.height,Wn=!0,k(Re,e.width,e.height,e.fps,wt),qa(),Xe?D(Re,16e5,1):D(Re,2e6,0)}Re&&(it=!0,rt&&clearInterval(rt),he||postMessage({status:Video_Capture_Tick}),Pt<4&&Lt>h.LOWER_VIDEO_CAPTURE_FPS?Lt=h.LOWER_VIDEO_CAPTURE_FPS:Fr!=h.WCL_PLATFORM_TYPE.IPHONE&&Fr!=h.WCL_PLATFORM_TYPE.ANDROID||(Lt=h.VIDEO_CAPTURE_FPS),Wt.start(Hn,1e3/Lt),$e&&(rt=setInterval((function(){W(Re)}),10)))}var jn,qn,Yn,Kn=null,Qn=null,Xn=null,zn=null,Zn={vcanvas:null,mcanvas:null},Jn=null,$n=null,ea=0,ta=0,ra=0,na=0,aa={dx:0,dy:0,dWidth:0,dHeight:0},ia=!1,oa=null,sa=new Uint8Array(4),da={sx:0,sy:0,sw:0,sh:0};function ua(e){"BgImage"==e.imagename?Qn=e.data:"MaskImage"==e.imagename&&(Kn=e.data,aa=Object.assign(aa,e.maskCoordinate),je=je||e.width,qe=qe||e.height),Sa(aa,je,qe)}var ca=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;d()(this,e),this.id=t,this.decodeInputIndex=1,this.context=null,this.decodeOutputIndex=0,this.videoFrameBuffer=[]}return c()(e,[{key:"destory",value:function(){this.videoFrameBuffer.forEach((function(e){return e.videoFrame.close()})),this.videoFrameBuffer=[]}},{key:"getFrameIdData",value:function(e){var t=this,r=0;return this.videoFrameBuffer.some((function(n,a){if(n.frameIndex<e)n.videoFrame.close();else if(n.frameIndex===e)return r=n.videoFrame,t.videoFrameBuffer.splice(0,a+1),!0;return!1})),r}},{key:"putFrameIdData",value:function(e,t){this.videoFrameBuffer.push({videoFrame:e,frameIndex:t})}},{key:"deleteOneFrame",value:function(){if(this.videoFrameBuffer.length){var e=this.videoFrameBuffer.shift();if(e)return e.videoFrame.close(),1}return 0}},{key:"getVideoFrameNumbers",value:function(){return this.videoFrameBuffer.length}}]),e}();function la(){return ya.get_videowebcodecencodestate()}function _a(e,t){return Dr.Signal_Encode_Thread.handle&&(ya.set_videowebcodecencodestate(1),Dr.Signal_Encode_Thread.handle.postMessage({cmd:"VideoEncodeInit",id:e,context:t})),0}function fa(e,t,r,n,a,i){Dr.Signal_Encode_Thread.handle&&Dr.Signal_Encode_Thread.handle.postMessage({cmd:"VideoEncodeConfigure",id:e,Bitrate:t,Framerate:r,Width:n,Height:a,buffer:i})}function ha(e,t,r,n,a){wr=!0,Dr.Signal_Encode_Thread.handle&&Dr.Signal_Encode_Thread.handle.postMessage({cmd:"VideoEncode",id:e,videoFrameId:t,NewIDR:r,rawData:n,dataLength:a})}function pa(){Dr.Signal_Encode_Thread.handle&&Dr.Signal_Encode_Thread.handle.postMessage({cmd:"CloseVideoEncode"})}var ma,va,ga,ya=new(function(){function e(){d()(this,e),this.decodeCodecHandles=new Map,this.ssrcToMap=new Map,this.totalVideoFrameNumbers=0,this.activeIds=[],this.usingVideoFrameList=[],this.videowebcodecencodestate=1}return c()(e,[{key:"_checkUnusefulId",value:function(e,t){if(this.ssrcToMap.has(e)&&this.ssrcToMap.get(e)!==t){var r=this.decodeCodecHandles.get(t);r&&(r.destory(),this._deleteActiveId(t)),this.ssrcToMap.delete(e)}this.ssrcToMap.has(e)||this.ssrcToMap.set(e,t)}},{key:"_getTotalVideoFrameNumbers",value:function(){var e,t=0,r=S(this.decodeCodecHandles.keys());try{for(r.s();!(e=r.n()).done;){var n=e.value,a=this.decodeCodecHandles.get(n);a&&(t+=a.getVideoFrameNumbers())}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"_setActiveIds",value:function(e){this._deleteActiveId(e),this.activeIds.unshift(e),this.activeIds.length>9&&this.activeIds.splice(9,this.activeIds.length-9)}},{key:"_deleteActiveId",value:function(e){var t=this;this.activeIds.some((function(r,n){if(r===e)return t.activeIds.splice(n,1),!0}))}},{key:"render",value:function(e){var t=e.id,r=e.iFrameNum,n=e.ssrc,a=e.rotation;this._checkUnusefulId(n>>10<<10,t);var i=this.decodeCodecHandles.get(t);if(i){this._setActiveIds(t);var o=i.getFrameIdData(r);if(o){if(Number.isNaN(a)||(o.rotation=a),this.totalVideoFrameNumbers=this._getTotalVideoFrameNumbers(),vt){var s=o.displayWidth,d=o.displayHeight;un(n,s,d),Rn&&Object(f.j)({ssrc:n,width:s,height:d}),Mt.ssrc&&gr(Mt.ssrc)==gr(n)&&!Mt.firstflag&&(postMessage({status:"NewActiveSpeakerFirstframeCallback",ssrc:Mt.ssrc}),Mt.firstflag=!0),vt.Update_RemoteVideo_Texture(o,!0,n)}o.close()}}}},{key:"closeFrame",value:function(e){try{var t=this.usingVideoFrameList.indexOf(e);-1!==t&&this.usingVideoFrameList.splice(t,1),e.close&&e.close()}catch(e){Object(f.g)("Error when closing a video frame",e)}}},{key:"_checkMaxVideoFrameNumbers",value:function(e){if(this.totalVideoFrameNumbers>9-this.usingVideoFrameList.length)for(var t=this.activeIds.length-1;t>=0;t--){var r=this.activeIds[t],n=this.decodeCodecHandles.get(r);if(n||this._deleteActiveId(),n.getVideoFrameNumbers()>1){n.deleteOneFrame(),this.totalVideoFrameNumbers=this._getTotalVideoFrameNumbers();break}}if(this.totalVideoFrameNumbers>9-this.usingVideoFrameList.length){var a=this.decodeCodecHandles.get(e);a&&(a.deleteOneFrame(),this.totalVideoFrameNumbers=this._getTotalVideoFrameNumbers())}}},{key:"put_data",value:function(e){var t=e.id,r=e.data,n=e.frameIndex,a=this.decodeCodecHandles.get(t);a||(a=new ca(t),this.decodeCodecHandles.set(t,a)),a.putFrameIdData(r,n),this.totalVideoFrameNumbers++,this._checkMaxVideoFrameNumbers(t)}},{key:"clearAll",value:function(){var e,t=S(this.decodeCodecHandles.keys());try{for(t.s();!(e=t.n()).done;){var r=e.value,n=this.decodeCodecHandles.get(r);n&&n.destory()}}catch(e){t.e(e)}finally{t.f()}this.decodeCodecHandles.clear(),this.ssrcToMap.clear(),this.activeIds=[]}},{key:"clear",value:function(e){var t=this.ssrcToMap.get(e);if(void 0!==t){var r=this.decodeCodecHandles.get(t);r&&(r.destory(),this.decodeCodecHandles.delete(t)),this.ssrcToMap.delete(e),this._deleteActiveId(t)}}},{key:"set_videowebcodecencodestate",value:function(e){this.videowebcodecencodestate=e}},{key:"get_videowebcodecencodestate",value:function(){return this.videowebcodecencodestate}}]),e}());function Sa(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(Xn&&zn||(Xn=new OffscreenCanvas(t,r),zn=Xn.getContext("2d")),Xn.width==t&&Xn.height==r||(Xn.width=t,Xn.height=r),zn.clearRect(0,0,t,r),jn=null,Kn&&Qn&&"blur"!==Qn){if(e.dWidth>0&&e.dHeight>0&&ra>0&&na>0&&t>0&&r>0){var a=e.dx/(ra/t),i=e.dy/(na/r),o=e.dWidth/(ra/t),s=e.dHeight/(na/r);zn.drawImage(Kn,a,i,o,s)}var d,u,c,l;if(zn.globalCompositeOperation="source-out",Ea(),d=da.sx,u=da.sy,c=da.sw,l=da.sh,zn.drawImage(Qn,d,u,c,l,0,0,t,r),n){var _=zn.getImageData(0,0,t,r);jn=new Uint8Array(_.data.buffer),n.updateSelfMaskImage(t,r,jn)}}else n&&(jn=sa,n.updateSelfMaskImage(1,1,jn))}function Ea(){var e,t,r,n=0,a=Qn.width,i=Qn.height;16/9*i>=a?(r=a,e=0,t=(i-(n=a/(16/9)))/2):(n=i,e=(a-(r=i*(16/9)))/2,t=0),da.sx=e,da.sy=t,da.sw=r,da.sh=n}function ba(e){if(xt.get(qn)&&xt.get(qn).canvas){xt.get(qn).display||(xt.get(qn).display=xt.get(qn).canvas.getContext("2d"));var t,r,n=ta?Object(p.b)(e.width,e.height,void 0,void 0,xt.get(qn).canvas.width/xt.get(qn).canvas.height):ja?Object(p.b)(e.width,e.height):null;Ft?(Dt||(xt.get(qn).display.scale(-1,1),Dt=!0),xt.get(qn).display.clearRect(0-xt.get(qn).canvas.width,0,xt.get(qn).canvas.width,xt.get(qn).canvas.height),(t=xt.get(qn).display).drawImage.apply(t,[e].concat(a()(n?[n.left,n.top,n.width,n.height]:[]),[0-xt.get(qn).canvas.width,0,xt.get(qn).canvas.width,xt.get(qn).canvas.height]))):(Dt&&(xt.get(qn).display.setTransform(1,0,0,1,0,0),Dt=!1),xt.get(qn).display.clearRect(0,0,xt.get(qn).canvas.width,xt.get(qn).canvas.height),(r=xt.get(qn).display).drawImage.apply(r,[e].concat(a()(n?[n.left,n.top,n.width,n.height]:[]),[0,0,xt.get(qn).canvas.width,xt.get(qn).canvas.height])))}}function Ma(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=t.width,i=t.height;Zn.mcanvas&&Jn||(Zn.mcanvas=new OffscreenCanvas(a,i),Jn=Zn.mcanvas.getContext("2d")),Zn.mcanvas.width==a&&Zn.mcanvas.height==i||(Zn.mcanvas.width=a,Zn.mcanvas.height=i),Jn.clearRect(0,0,a,i),Jn.drawImage(e,0,0,a,i),Xn?Jn.drawImage(Xn,0,0,a,i):Sa(aa,a,i),xt.get(qn)&&xt.get(qn).canvas&&ba(Zn.mcanvas);var o=Jn.getImageData(0,0,a,i),s=new Uint8Array(o.data.buffer);return Module.HEAPU8.subarray(r,r+s.length).set(s,0,s.length),ea=s.length,n?new VideoFrame(Zn.mcanvas,{timestamp:0}):null}function Aa(){Zn.vcanvas&&Qe&&(Zn.vcanvas.contextLostTimer&&(clearTimeout(Zn.vcanvas.contextLostTimer),Zn.vcanvas.contextLostTimer=null),Zn.vcanvas.contextLostTimer=setTimeout((function(){Zn.vcanvas.contextLostTimer=null,Zn.vcanvas=new OffscreenCanvas(Zn.vcanvas.width,Zn.vcanvas.height),wa()}),3e3))}function wa(){$n=new g.a(Zn.vcanvas,0,void 0,{webglcontextlostCallback:Aa,webglcontextrestoredCallback:Ta},void 0,!0)}function Ta(){Zn.vcanvas&&(Qe?Zn.vcanvas.contextLostTimer&&(clearTimeout(Zn.vcanvas.contextLostTimer),Zn.vcanvas.contextLostTimer=null,Zn.vcanvas=new OffscreenCanvas(Zn.vcanvas.width,Zn.vcanvas.height),wa()):wa())}function Ra(e,t){var r=t.canvas,n=t.rendercanvasID;Qe?(r.contextLostTimer&&(clearTimeout(r.contextLostTimer),r.contextLostTimer=null),r.contextLostTimer=setTimeout((function(){r.contextLostTimer=null,Object(f.i)(n)}),3e3)):Object(f.i)(n)}function Fa(e,t){xt.get(t).display||(xt.get(t).display=new g.a(e,0,void 0,{webglcontextlostCallback:Ra,webglcontextrestoredCallback:Da,params:{canvas:e,rendercanvasID:t}},void 0,!1)),xt.get(t).display.setFillMode(ta)}function Da(e,t){var r=t.canvas,n=t.rendercanvasID;Qe?r.contextLostTimer&&(clearTimeout(r.contextLostTimer),r.contextLostTimer=null,Object(f.i)(n)):(xt.get(n).display=null,Fa(r,n))}function ka(){return 1}function Ia(e,t,r,n,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=a.width,d=a.height;Zn.vcanvas&&$n||(Zn.vcanvas=new OffscreenCanvas(s,d),wa()),Zn.vcanvas.width==s&&Zn.vcanvas.height==d||(Zn.vcanvas.width=s,Zn.vcanvas.height=d),$n.SetVideoMode(i-1),jn?$n.updateSelfMaskImage(s,d,jn):Sa(aa,s,d,$n);var u={x:0,y:0,width:s,height:d};$n.UpdateRemoteVideoTextures(e,t,a,r,0,!0,u,!1),$n.DrawRemoteVideo(u);var c=$n.readPixelsSyncRequest(0,0,s,d);if(xt.get(qn)&&xt.get(qn).canvas){Fa(xt.get(qn).canvas,qn);var l={left:0,top:0,width:s,height:d},_={x:0,y:0,width:xt.get(qn).canvas.width,height:xt.get(qn).canvas.height};xt.get(qn).display.SetVideoMode(0),xt.get(qn).display.UpdateSelfVideoTextures(s,d,c,l),xt.get(qn).display.DrawSelfVideo(_,!1,Ft)}return Module.HEAPU8.subarray(n,n+c.length).set(c,0,c.length),ea=c.length,o?new VideoFrame(c,{format:"RGBA",timestamp:0,codedWidth:s,codedHeight:d}):null}var Ca,Oa,xa=!1,Pa=(new Object,[{dataReady:!1,configReady:!1,modelArtifacts:new Object,modelJSON:null},{dataReady:!1,configReady:!1,modelArtifacts:new Object,modelJSON:null},{dataReady:!1,configReady:!1,modelArtifacts:new Object,modelJSON:null}]);function La(e,t){return Ua.apply(this,arguments)}function Ua(){return(Ua=o()(_.a.mark((function e(t,r){var n,a,i;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Pa[r].dataReady||!Pa[r].configReady){e.next=2;break}return e.abrupt("return");case 2:if(Pa[r].dataReady=!0,Pa[r].modelJSON=JSON.parse(t.json),Pa[r].modelArtifacts.modelTopology=Pa[r].modelJSON.modelTopology,Pa[r].modelArtifacts.format=Pa[r].modelJSON.format,Pa[r].modelArtifacts.generatedBy=Pa[r].modelJSON.generatedBy,Pa[r].modelArtifacts.convertedBy=Pa[r].modelJSON.convertedBy,null!=Pa[r].modelJSON.weightsManifest){n=S(Pa[r].modelJSON.weightsManifest);try{for(n.s();!(a=n.n()).done;)i=a.value,Pa[r].modelArtifacts.weightSpecs=i.weights}catch(e){n.e(e)}finally{n.f()}}null!=Pa[r].modelJSON.trainingConfig&&(Pa[r].modelArtifacts.trainingConfig=Pa[r].modelJSON.trainingConfig),null!=Pa[r].modelJSON.userDefinedMetadata&&(Pa[r].modelArtifacts.userDefinedMetadata=Pa[r].modelJSON.userDefinedMetadata),Pa[r].configReady=!0,Pa[r].modelArtifacts.weightData=t.bin,va&&Va(r);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Va(e){Pa[e].dataReady&&Pa[e].configReady&&va&&Dr&&!Dr.vbThreadCreatedFlag&&Dr.vbThreadWorker&&(Dr.vbThreadWorker.postMessage({cmd:"vbObj"+e,tfjsUrl:ga,modelJSON:Pa[e].modelJSON,weightData:Pa[e].modelArtifacts.weightData}),Pa[e].modelArtifacts.weightData=null,Pa[e].modelJSON=null)}function Na(e){return Ba.apply(this,arguments)}function Ba(){return(Ba=o()(_.a.mark((function e(t){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!va){e.next=2;break}return e.abrupt("return");case 2:va=!0,ga=t,Va(0),Va(1),Va(2);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ha={sendBg:function(e,t,r,n){var a=new Uint8Array(e);if(pr()||Or){var i=An(a);Q(i,t,r,n)}else Ir&&Ir.canTransferVBData()?Ir.postMessage({cmd:"vbBg",data:a,length:t,width:r,height:n}):a=null},sendBlur:function(){pr()||Or?X(0,0):Ir&&Ir.canTransferVBData()&&Ir.postMessage({cmd:"vbBlur"})},sendYuvData:function(e,t,r,n,a,i,o,s,d,u,c,l,_){var f=3===_?a+i:a+i+o,h=e+a,p=3===_?h:h+i;if(pr()||Or)z(e,t,r,n,e,a,h,i,p,o,s,d,u,c,l,_);else{if(Ir&&Ir.canTransferVBData(!0)){var m=Module.HEAPU8.subarray(e,e+f),v=new Uint8Array(f);v.set(m,0,f),Ir.postMessage({cmd:"vbYuv",data:v,length:t,width:r,height:n,yDataLength:a,uDataLength:i,vDataLength:o,yStride:s,uStride:d,vStride:u,xOffset:c,yOffset:l,dataFormat:_}),v=null}wn(e)}},sendRgbaData:function(e,t,r,n,a,i,o,s){if(pr()||Or)Z(e,t,r,n,a,i,o,s);else{if(Ir&&Ir.canTransferVBData(!0)){var d=Module.HEAPU8.subarray(e,e+t),u=new Uint8Array(t);u.set(d,0,t),Ir.postMessage({cmd:"vbRgba",data:u,length:t,width:r,height:n,rgbaStride:a,xOffset:i,yOffset:o,dataFormat:s})}wn(e)}}};function Wa(e){if(e.data){if("blur"==(Qn=e.data))Ha.sendBlur();else{var t,r,n,a,i,o;Ea(),t=da.sx,r=da.sy,n=da.sw,a=da.sh,n>1280?(i=1280,o=720):(i=n,o=a),ma||(ma=new OffscreenCanvas(i,o)),ma.width=i,ma.height=o;var s=ma.getContext("2d");s.drawImage(Qn,t,r,n,a,0,0,ma.width,ma.height);var d=s.getImageData(0,0,ma.width,ma.height);Ha.sendBg(d.data,d.data.length,ma.width,ma.height)}Ot=!0}else Qn=null,Ot=!1}var Ga,ja=!1;function qa(){ja&&J(Re,3)}function Ya(){C(Re,je,qe,Lt,Tt),qa()}function Ka(e,t,r,n,a){if(xt.get(be)&&xt.get(be).canvas){xt.get(be).display||(xt.get(be).display=new g.a(xt.get(be).canvas,0,void 0,{preserveDrawingBuffer:!1},void 0,!1));var i={x:0,y:0,width:xt.get(be).canvas.width,height:xt.get(be).canvas.height};xt.get(be).display.SetVideoMode(a);var o=ja?Object(p.b)(n.width,n.height):null,s=xt.get(be).display;a===h.VIDEO_RGBA?s.UpdateSelfVideoTextures(e,t,r,n):s.UpdateRemoteVideoTextures(e,t,o||n,r,0,!0,i,!1),s.DrawRemoteVideo(i,Ft)}}function Qa(){if(ne)for(;ne.getLength()>0;){var e=ne.dequeue();e.frame&&("close"in e.frame?e.frame.close():e.frame.destroy())}ne=new M}function Xa(e,t,r,n,a,i,o){if(Bt.monitorPanelFlag){var s={width:e,height:t,fps:r,rtt:n,jitter:a,avg_loss:i,max_loss:o};postMessage({status:y.g,data:s})}if(!Ke&&Bt.renderFlag)if(Bt.messageIndex++%h.VIDEO_MONITOR_LOG_SECOENDS!=0){if((We>r||0==We)&&(We=r),Ge<r&&(Ge=r),Bt.monitorPanelFlag)return}else We=r,Ge=r}function za(){var e=function(){j(Re)};if(Bt.qosIntervalId&&clearInterval(Bt.qosIntervalId),Bt.monitorPanelFlag||Bt.renderFlag){if(Bt.monitorPanelFlag)return void(Bt.qosIntervalId=setInterval(e,Bt.panelpollingInterval||h.QOS_DEFAULT_POLLING_INTERVAL));if(Bt.renderFlag)return void(Bt.qosIntervalId=setInterval(e,h.VIDEO_MONITOR_LOG_SECOENDS*h.QOS_DEFAULT_POLLING_INTERVAL))}}function Za(e,t,r){postMessage({status:h.NETWORK_QUALITY_CHANGE,isUplink:0===e,networkLevel:t,bwLevel:r})}function Ja(e,t){var r=Module.HEAPU8.subarray(e+0,e+t);postMessage({status:MONITOR_MESSAGE,data:En(r)})}function $a(e){switch(ae&&(e.status=0),e.status){case 0:yt&&vt&&vt.Set_SSRC_Latest_Time_Stamp(e.data);break;case 1:if(Re){var t=Module._malloc(e.data.length);Module.HEAPU8.subarray(t,t+e.data.length).set(e.data),V(Re,t,e.data.length),Module._free(t);for(var r=new Uint32Array(e.data.buffer),n=null,a=0;a<e.data.length/16;a++)if(512&r[4*a]){n=r.subarray(4*a,4*a+4);break}if(!n)return;if(nr.isSupportOffscreenCanvas&&er){var i=232.8*n[1]/1e9+1e3*n[2];er.postMessage(i)}}}}function ei(){return!1}function ti(e){}self.addEventListener("message",(function(e){var t=e.data,r=e.data;switch(t.command){case"startMedia":try{ee||(ee=setInterval((function(){ie&&Re&&te(Re,!!Ke)}),1e3)),isPreviewMode&&!r.isPreviewMode&&(Re&&w(Re),Re=null,hr.inited&&(hr.clear(),hr.start()),Ct=!1),isPreviewMode=!!r.isPreviewMode,isPreviewMode&&postMessage({status:Video_Encode_Preview_OK});var n,a,i=r.iv;i&&(i=new Uint8Array(i)),i?(Te=i,a=i.length):a=0,n=An(i),Ke=t.sendvideo,$e=t.qoson,Ut=t.uplimit?t.uplimit:0,Qe=!!t.enableReplaceCanvasWhenContextLost,null===Re&&(de=t.meetingnumb+"",ue=t.meetingid,Module.wcl_trace_log=Sn,ae=!!t.enableMultiDecodeVideoWithoutSAB,nr.videodecodethreadnumb=ae?1:t.videodecodethreadnumb,nr.isSupportMultiThread=t.isSupportMultiThread,nr.isSupportVideoTrackReader=t.isSupportVideoTrackReader,nr.isSupportOffscreenCanvas=t.isSupportOffscreenCanvas,Module.codecMRG=ya,Nt=!!r.enableAudioBridge,Ke?(Ar=r.is360penablehw,Tr=r.enable720p,ir=Ar?640:1280,nr.videodecodethreadnumb=1,Dr.isSupportVirtualBackground=t.isSupportVirtualBackground,Fr=r.platformType,Module.js_info_from_wcl_video_data=nn,Module.change_capture_resolution=$r,Module.APP_Troubleshoting_Info=pn,Module.SAVE_IV=Mn,Module.processed_capture_data_callback=an,yr(!1),r.videoencodethreadnumb>1?(vr(!0),Dr.isSupportVirtualBackground&&xr("VB",1),tr="function"==typeof Worker):Dr.isSupportVirtualBackground&&xr("VB",1),Dr.videoencodethreadmaxnumb=r.videoencodethreadnumb,Ae=r.confId,ot=r.initWebCodecFlag,Dr.Signal_Encode_Thread.initwebcodecflag=ot,Dr.Signal_Encode_Thread.latestflag=ot,Dr.isEnableVideoEncodeHardWareThread=r.isSupportWebCodecEnocde,Dr.videoencodethreadnumb=r.isSupportWebCodecEnocde?2:1,Re=A(t.confId,t.mtu_size,de,ue,n,a,Dr.videoencodethreadmaxnumb,ot,Ke,$e,Ut,!1,Nt)):(Module.put_data=Fn,Module.js_info_from_wcl_thread=sn,Module.decode_callback=fn,Module.codecMRG=ya,or.isTeslaMode=r.isTeslaMode,nr.isSupportOffscreenCanvas&&(vt||((vt=new p.a({Notify_APPUI:null,isSupportOffscreenCanvas:!0,jsMediaEngine:null,videodecodethreadnumb:ae?4:nr.videodecodethreadnumb,enableReplaceCanvasWhenContextLost:Qe})).setMirrorMyVideoOption(Ft),Ga&&vt.Change_Current_SSRC(Ga),kn&&vt.Set_LocalVideo_Buffer(kn),Dn&&vt.Set_LocalVideo_Ptr(Dn))),vt&&vt.Set_VideoTrackReader(nr.isSupportVideoTrackReader),ar=nr.videodecodethreadnumb>1?nr.videodecodethreadnumb+3:1,nr.videodecodethreadnumb>1?yr(!0):yr(!1),Ae=t.confId,ot=!!(t.isenablehw&&nr.videodecodethreadnumb>1),nr.isEnableVideoDecodeHardWareThread=t.isEnableVideoDecodeHardWareThread,nr.isEnableVideoDecodeHardWareThread||(nr.totalNumbofParseThread=2,ot=!1),Re=A(t.confId,t.mtu_size,de,ue,n,a,nr.videodecodethreadnumb,ot,Ke,$e,Ut,!1),$e&&(nt&&(clearInterval(nt),nt=null),nt=setInterval((function(){G(Re)}),50))),Re&&$e&&H(Re,Xe||ze?0:2),wn(n),!Ke&&nr.videodecodethreadnumb>1&&U(Re,nr.videodecodethreadnumb),Ze=!0,Re?(Ke&&Dr.isSupportVirtualBackground||postMessage({status:Video_Dec_Handle_OK}),xe=t.logon,r.webtransportURL&&!jt&&qt({url:r.webtransportURL,label:"video",onmessage:qr,onopen:Qt,onclose:Xt}),De||(De=Gt(t.websocket_ip_address,zt,Qr,Jr,Zr)),t.isChromeOrEdge&&(Be=t.isChromeOrEdge),Oe=t.websocket_ip_address,xe&&bn(Oe)):postMessage({status:Video_Dec_Handle_FAILED})),Kr()}catch(e){console.log(e)}break;case"OPEN_MEDIA_WEBSOCKET":De&&1===De.socket.readyState&&(De.close(),De=null),De=Gt(t.websocket_ip_address,zt,Qr,Jr,Zr,!0);break;case"CLOSE_MEDIA_WEBSOCKET":De&&1===De.socket.readyState&&(De.close(),De=null);break;case"OPEN_MEDIA_WEBTRANSPORT":jt&&(jt.forceClose(),jt=null),qt({url:t.webtransportURL,label:"video",onmessage:qr,onopen:Qt,onclose:Xt},!0);break;case"CLOSE_MEDIA_WEBTRANSPORT":jt&&(jt.forceClose(),jt=null);break;case"EncodedVideoFrame":audio_websocket.send(t.data);break;case"failover":De&&1===De.socket.readyState&&De.close(),ke&&1===ke.socket.readyState&&ke.close(),De=Gt(t.websocket_ip_address,zt,Zt,Jr,Zr),ke=Gt(t.websocket_ip_address,zt,Zt,Jr,Zr);break;case"closeMedia":Ke&&re(),De&&1===De.socket.readyState&&De.close(),ke&&1===ke.socket.readyState&&ke.close(),nt&&(clearInterval(nt),nt=null),Re&&(I(Re),w(Re)),close();break;case"encodeVideoFrame":ne.enqueue(t.data),Vt.rgba_stride==t.stride&&Vt.rgba_x==t.x&&Vt.rgba_y==t.y||(Vt.rgba_stride=t.stride,Vt.rgba_x=t.x,Vt.rgba_y=t.y);break;case"startVideoEncode":if(void 0!==t.disableOriginalRatio&&(ja=!!t.disableOriginalRatio),!Ke)return void(vt&&(vt.Set_Capture_Video_Flag(!0),vt.Set_LocalVideo_SSRC(t.ssid),vt.Set_Cropping_Mode(!!ja)));Ir&&Ir.setCurrentUserSsrc(t.ssid),ie=!0,Rr=!0,_e=!!t.isSupportImageCapture,fe=!!t.isSupportVideoTrackReader,he=!!t.isSupportMediaStreamTrackProcessor,pe=!!t.isSupport2DCanvasDrawFrame,Lt=t.fps||Lt,tr&&Dr.threadState==h.THREAD_STATE_IDLE?Pr(t):Gn(t);break;case"releaseStream":try{me&&me.releaseLock&&me.releaseLock(),ve&&ve.cancel&&ve.cancel(),ve=null,me=null}catch(e){}break;case"frameStream":t.data&&(ve=t.data,me=ve.getReader());break;case"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK":if("js"==t.type){Na(t.data);break}La(t.data,t.index);break;case"updateVideoPara":Re&&(Qa(),je=t.width,qe=t.height,Vt.rgba_stride=t.width,Vt.rgba_x=0,Vt.rgba_y=0,Ya());break;case"stopVideoEncode":if(Ke)ie=!1,it=!1,ia||($n&&$n.clearDisplay(),Jn&&Jn.clearRect(0,0,Zn.mcanvas.width,Zn.mcanvas.height)),It||(xt.get(be)&&xt.get(be).display&&xt.get(be).display.clearDisplay(),be=null),ia||It||(clearInterval(we),we=null,Wt.stop(),rt&&(clearInterval(rt),rt=null),at&&(clearInterval(at),at=null),_t&&Atomics.store(_t,0,0),Qa());else if(vt)return void vt.Set_Capture_Video_Flag(!1);break;case"ENCRYPT":Re&&(Ne=t.encrypt,O(Re,Ne?1:0));break;case"SOCKET_RECONNECT":self.IS_DISABLE_SOCKET_RECONNECT=!0===r.disable;break;case"PUSH_MESSAGE_FROM_MAIN_TO_WORKER":jr(t.data);break;case"UPDATE_DATACHANNEL_STATUS":Xe=t.data.isDataChannelOpen,Kt();break;case"OfflineCanvas":t.canvasname&&t.canvas.getContext("2d")&&ht.set(t.canvasname,t.canvas.getContext("2d"));break;case"mirrorMyVideo":Ft=t.isMirrorMyVideo,!Ke&&t.isSupportOffscreenCanvas?vt&&vt.setMirrorMyVideoOption(Ft):Ir&&Ir.setMirrorMyVideoOption(Ft);break;case"imagebitmap":if(postMessage({status:Video_Capture_Tick}),t.data){if(isPreviewMode){if(!t.data.width||!t.data.height)return;je=t.data.width,qe=t.data.height}if(nr.offScreenCanvasHandle.donotrenderoffscreencanvas||(nr.offScreenCanvasHandle.donotrenderoffscreencanvas=new OffscreenCanvas(640,360),nr.offScreenCanvasHandle.donotrenderoffscreencanvasctx=nr.offScreenCanvasHandle.donotrenderoffscreencanvas.getContext("2d")),nr.offScreenCanvasHandle.donotrenderoffscreencanvas){nr.offScreenCanvasHandle.donotrenderoffscreencanvas.width==je&&nr.offScreenCanvasHandle.donotrenderoffscreencanvas.height==qe||(nr.offScreenCanvasHandle.donotrenderoffscreencanvas.width=je,nr.offScreenCanvasHandle.donotrenderoffscreencanvas.height=qe),nr.offScreenCanvasHandle.donotrenderoffscreencanvasctx.clearRect(0,0,je,qe),nr.offScreenCanvasHandle.donotrenderoffscreencanvasctx.drawImage(t.data,0,0,je,qe),Xn?nr.offScreenCanvasHandle.donotrenderoffscreencanvasctx.drawImage(Xn,0,0,je,qe):Sa(aa,je,qe,null),xt.get(qn)&&xt.get(qn).canvas&&ba(nr.offScreenCanvasHandle.donotrenderoffscreencanvas);var o=nr.offScreenCanvasHandle.donotrenderoffscreencanvasctx.getImageData(0,0,je,qe);t.data.close();var s=new Uint8Array(o.data);ne.enqueue(s)}}break;case"ImageBitmapFromVideoFrame":if(ce||(ce=new OffscreenCanvas(640,360),le=nr.offScreenCanvasHandle.donotrenderoffscreencanvas.getContext("2d")),t.data&&t.data.width&&t.data.height){isPreviewMode&&(je=t.data.width,qe=t.data.height),ce.width==je&&ce.height==qe||(ce.width=je,ce.height=qe),le.clearRect(0,0,je,qe),le.drawImage(t.data,0,0,je,qe),Xn?le.drawImage(Xn,0,0,je,qe):Sa(aa,je,qe,null),xt.get(qn)&&xt.get(qn).canvas&&ba(le);var d=le.getImageData(0,0,je,qe);t.data.close();var u=new Uint8Array(d.data);ne.enqueue(u)}break;case"yuvVideoFrame":var c=t.data;if(c.format&&"I420"==c.format)ne.enqueue({frame:c,format:2});else if(c.format&&"NV12"==c.format)ne.enqueue({frame:c,format:3});else if(c.format&&"I420A"==c.format)ne.enqueue({frame:c,format:4});else if(c.format)return console.error("dataformat:",c.format,"is not supported"),kt||(kt=!0,postMessage({status:h.UNSUPPORTED_VIDEO_FORMAT,format:c.format})),void("close"in c?c.close():c.destroy());for(;ne.getLength()>2;){var l=ne.dequeue();"close"in l.frame?l.frame.close():l.frame.destroy()}break;case"VideoPlayStatus":yt=t.data.isVideoPlayWork;break;case"startvideointerval":_e=!!t.isSupportImageCapture,fe=!!t.isSupportVideoTrackReader,he=!!t.isSupportMediaStreamTrackProcessor,pe=!!t.isSupport2DCanvasDrawFrame,It=!!t.isVBSettingOn,ia=!!t.isMaskSettingOn,Rr=!0,Lt=t.fps||Lt,tr&&Dr.threadState==h.THREAD_STATE_IDLE?Pr(t):Gn(t);break;case"StartVBSetting":It=!0,ia=!1,Ct=!1,Qa(),t.isSwitch&&_t&&Atomics.store(_t,0,0),Pt<4&&Lt>h.LOWER_VIDEO_CAPTURE_FP&&(Lt=h.LOWER_VIDEO_CAPTURE_FPS),Wt.start(Hn,1e3/Lt);break;case"VBOfflineCanvas":t.canvas&&xt.set(t.rendercanvasID,{canvas:t.canvas,id:t.rendercanvasID,display:new g.a(t.canvas,0,void 0,{preserveDrawingBuffer:!1},void 0,!1)}),be=t.rendercanvasID;break;case"MaskOfflineCanvas":t.canvas&&xt.set(t.rendercanvasID,{canvas:t.canvas,id:t.rendercanvasID,display:null}),qn=t.rendercanvasID,ra=xt.get(t.rendercanvasID).canvas.width,na=xt.get(t.rendercanvasID).canvas.height;break;case"vbbgimagebitmap":Wa(t);break;case"finishVBSetting":_t&&Atomics.store(_t,0,0),xt.get(be)&&xt.get(be).display&&xt.get(be).display.clearDisplay(),be=null,It=!1,it||ia||(clearInterval(we),we=null,rt&&(clearInterval(rt),rt=null),at&&(clearInterval(at),at=null),$n&&$n.clearDisplay(),Jn&&Jn.clearRect(0,0,Zn.mcanvas.width,Zn.mcanvas.height),self.resizeCanvas&&self.resizeCanvas());break;case"WORKER_BOLB_URL":t.blobUrl&&!pr()&&(Ir=new kr(t.blobUrl));break;case"StartMaskSetting":ia=!0,It=!1,Ot=!1,Ct=!0,ta=t.fillMode?1:0,xt.get(qn)&&xt.get(qn).display&&xt.get(qn).display.setFillMode&&xt.get(qn).display.setFillMode(ta),t.isSwitch&&(Sa(aa,je,qe),_t&&Atomics.store(_t,0,0));break;case"update_mask_canvas_size":xt.get(t.rendercanvasID)&&xt.get(t.rendercanvasID).canvas&&t.rendercanvasID===qn&&(xt.get(t.rendercanvasID).canvas.width=t.width,xt.get(t.rendercanvasID).canvas.height=t.height);break;case"maskandbgimagebitmap":ia=!0,ua(t);break;case"finishMaskSetting":_t&&Atomics.store(_t,0,0),xt.get(qn)&&xt.get(qn).display&&xt.get(qn).canvas&&(pe?(xt.get(qn).display.setTransform(1,0,0,1,0,0),xt.get(qn).display.clearRect(0,0,xt.get(qn).canvas.width,xt.get(qn).canvas.height)):xt.get(qn).display.clearDisplay()),qn=null,ia=!1,Dt=!1,it||It||($n&&$n.clearDisplay(),Jn&&Jn.clearRect(0,0,Zn.mcanvas.width,Zn.mcanvas.height),Wt.stop(),Qa());break;case"renderOfflineCanvas":var _=Ke?Ir.videoRenderObj:vt;if(t.canvas){var y=mt.get(t.rendercanvasID);y&&_&&_.Clear_OffScreenCavas(y.canvas),mt.set(t.rendercanvasID,{canvas:t.canvas})}else{var S=mt.get(t.rendercanvasID);S&&(t.canvas=S.canvas)}if(yt=!0,St=!0,Et=t.waterMarkText,bt=t.isCreateVideoWaterMark,_.Set_WaterMark_Info({waterMarkCanvas:!1,isCreateVideoWaterMark:bt,videoWaterMarkName:Et,watermarkOpacity:t.watermarkOpacity,watermarkRepeated:t.watermarkRepeated,watermarkPosition:t.watermarkPosition}),!Tn){Tn=!0;var E=_.Start_Draw.bind(_);pt=ae||nr.videodecodethreadnumb>1?E(h.RQUEST_ANIMATION_MODE):E(h.SET_INTERVAL_MODE,10)}if(gt.length)for(var b=0;b<gt.length;b++)if(gt[b].ssrc==t.ssrc&&gt[b].zone==t.zone)return;(ae||nr.videodecodethreadnumb>1)&&(t.display=_.Get_Display(t.canvas,t.rendercanvasID),t.display&&t.display.setFillMode(t.fillMode,t.fillModeForResolution)),gt.push(t),1==gt.length&&_.Get_Capture_Video_Flag()||(ie=!0),gt.length>0&&_.Set_Render_Array(gt),Bt.renderFlag||Ke||1==gt.length&&_.Get_Capture_Video_Flag()||(Bt.renderFlag=!0,za());break;case"newActiveSpeakerSsrc":Mt.ssrc=t.ssrc,Mt.created=0,Mt.firstflag=!1,yt=!0,At&&(clearInterval(At),At=null);break;case"cancelNewActiveSpeakerSsrcBefreCallback":At&&(clearInterval(At),At=null),Mt.ssrc==t.ssrc&&(Mt.created&&!t.haddata?1==Mt.created?At=setInterval((function(){2==Mt.created&&(N(Re,t.ssrc),dr(t.ssrc),clearInterval(At),At=null,Mt.ssrc=null,Mt.created=0,Mt.firstflag=!1)}),50):2==Mt.created&&(N(Re,t.ssrc),dr(t.ssrc),Mt.ssrc=null,Mt.created=0,Mt.firstflag=!1):(Mt.ssrc=null,Mt.created=0,Mt.firstflag=!1)),0==gt.length&&(yt=!1);break;case"CHANGE_CURRENT_ACTIVE_SSRC":Ga=t.ssrc,vt&&vt.Change_Current_SSRC(t.ssrc);break;case"stopVideoRender":if(t.MFlag)return void(ie=!1);bt=!1,Et="";var M=Ke?Ir.videoRenderObj:vt;if(gt.length)for(var T=mt.get(t.canvas),R=0;T&&R<gt.length;R++)if(gt[R].ssrc==t.ssrc&&gt[R].zone==t.zone){var F=gt.splice(R,1);M.clearUseridRender(F,t.RGBA),M.GiveBack_Display(F),M.Set_Render_Array(gt),vt&&!vt.Decode_Ssrc(t.ssrc)&&(N(Re,t.ssrc),dr(t.ssrc)),ya&&!gt.find((function(e){return e.ssrc===t.ssrc}))&&(ya.clear(t.ssrc),_n.get(t.ssrc>>10<<10)&&_n.delete(t.ssrc>>10<<10)),(!gt.length||1==gt.length&&vt.Get_Capture_Video_Flag())&&(ie=!1),0==gt.length&&(ya&&ya.clearAll(),Tn&&(Tn=!1,M.Stop_Draw.bind(M)(),pt=null,M.ClearQueue(),M.Set_WaterMark_Info({waterMarkCanvas:!1,isCreateVideoWaterMark:bt,videoWaterMarkName:Et}),yt=!1)),Bt.renderFlag&&!Ke&&(1==gt.length&&vt.Get_Capture_Video_Flag()||0==gt.length)&&(Bt.renderFlag=!1,za())}break;case"removeVideoPlay":pt&&(cancelAnimationFrame(null),pt=null,yt=!1);break;case"decodeVideoPortWithAudio":t.port.onmessage=function(e){$a(e.data)};break;case"audioDecodeTime":$a(t);break;case m.a.SET_USER_NODE_LIST:var D=r.data.userNodeList;D&&D.forEach((function(e){var t=parseInt(e.userid);if(e.bremove)Re&&P(Re,t);else{var r=e.sn;if(16==r.length||32==r.length){var n=An(r);if(Re){var a=!1;Ke&&Ae!=t||(a=!0),a&&x(Re,t,n,r.length)}Ke&&Ae==t&&(Me=r),wn(n)}}}));break;case"VIDEO_ENCODE_SAB":if(nr.isSupportMultiThread){var k=8+1500*(VIDEO_RINGBUF_PKG_NUM+1);if(null==st){if(null==(st=Module._malloc(k)))return void console.log("malloc failed");Atomics.store(GROWABLE_HEAP_U32().subarray(st/4,st/4+k),0,0),Atomics.store(GROWABLE_HEAP_U32().subarray(st/4,st/4+k),1,0)}self.postMessage({status:"VIDEO_ENCODE_PTR",data:wasmMemory,offset:st,length:k}),self.videoRingBufferWriter=new v.b(wasmMemory.buffer,void 0,void 0,void 0,st,k,wasmMemory)}else{var C=r.data.buffer;self.videoRingBufferWriter=new v.b(C)}self.bVideoEncodeMainThreadConsumerIntervalEnable=r.data.bVideoEncodeMainThreadConsumerIntervalEnable;break;case h.QOS_MONITORING:Bt.monitorPanelFlag=r.data.enable,Bt.panelpollingInterval=r.data.pollingInterval,za();break;case"VIDEO_DECODE_SAB_FROM_DATACHANNEL":if(nr.isSupportMultiThread){var L=8+1500*(VIDEO_RINGBUF_PKG_NUM+1);if(null==dt){if(null==(dt=Module._malloc(L)))return void console.log("malloc failed");Atomics.store(GROWABLE_HEAP_U32().subarray(dt/4,dt/4+L),0,0),Atomics.store(GROWABLE_HEAP_U32().subarray(dt/4,dt/4+L),1,0)}self.videoRingBufferWriterDecode=new v.b(wasmMemory.buffer,void 0,"vddfd",void 0,dt,L,wasmMemory),self.videoRingBufferConsumer=new v.a(self.videoRingBufferWriterDecode,In),self.postMessage({status:"VIDEO_DECODE_PTR",data:wasmMemory,offset:dt,length:L})}else{var V=r.data;self.videoRingBufferWriterDecode=new v.b(V,void 0,"vddfd"),self.videoRingBufferConsumer=new v.a(self.videoRingBufferWriterDecode,In)}self.videoRingBufferConsumer.consume(10,!1);break;case"VIDEO_DECODE_FRAME_BACK_SAB":var W=r.data.buffer,j=r.data.bytesPerEle;self.videoDecodeFrameBackSABRingBuffer=new v.b(W,j);break;case"decodeVideoPort":Jt&&Jt.close(),(Jt=e.ports[0]).onmessage=function(e){vt.Update_LocalVideo(e.data.data),void 0!==e.data.data.close?e.data.data.close():e.data.data.destory()};break;case"encodeVideoPort":$t&&($t.close(),$t=null),$t=e.ports[0];break;case"vsport":er&&(er.close(),er=null),er=e.ports[0];break;case"videopreview":vt&&vt.Draw_Send_Video_Img(r.data,640,360,Ae);break;case"update_canvas_size":var Y=mt.get(r.rendercanvasID);Y&&(Y.canvas.width=r.width,Y.canvas.height=r.height);break;case"encodedbuffer":kn=r.wasmMemory,vt&&vt.Set_LocalVideo_Buffer(kn);break;case"encodedimagebitmapwasmptr":Dn=r.data,kn=r.wasmMemory,vt&&(vt.Set_LocalVideo_Buffer(kn),vt.Set_LocalVideo_Ptr(Dn));break;case"zoomrender":if(gt.length)for(var K=mt.get(t.canvas),Q=0;K&&Q<gt.length;Q++)if(gt[Q].ssrc==t.ssrc&&gt[Q].zone==t.zone){var X=[gt[Q]];vt&&vt.clearUseridRender(X,t.RGBA),gt[Q].x=t.x,gt[Q].y=t.y,gt[Q].width=t.width,gt[Q].height=t.height,vt&&vt.Zoom_Render(gt[Q])}break;case"hwstatus":Re&&(Ke&&Dr.isEnableVideoEncodeHardWareThread||nr.videodecodethreadnumb>1&&nr.isEnableVideoDecodeHardWareThread)&&ot!=t.enable&&(ot=t.enable,Dr.Signal_Encode_Thread.latestflag=ot,Ke&&Dr.Signal_Encode_Thread.status==h.THREAD_STATE_CREATED?B(Re,ot):Ke||B(Re,ot));break;case"videohd":Tr=t.videohd,ot=t.videohd,Dr.Signal_Encode_Thread.latestflag=ot,B(Re,ot);break;case"SWITCH_WATER_MARK_FLAG":vt&&(bt=r.isCreateVideoWaterMark,Et=r.videoWaterMarkName||"",bt||vt.Set_WaterMark_Flag(!1),vt.Set_WaterMark_Info({waterMarkCanvas:!1,isCreateVideoWaterMark:bt,videoWaterMarkName:Et,watermarkOpacity:r.watermarkOpacity,watermarkRepeated:r.watermarkRepeated,watermarkPosition:r.watermarkPosition}));break;case"startsharingencode":Ut/=2,Re&&q(Re,Ut);break;case"stopsharingencode":Ut*=2,Re&&q(Re,Ut);break;case"WEBGL_LOST_REPLACE_CANVAS":var z=r.data||{},Z=z.canvas,J=z.canvasId;if(Z)J&&J===qn?(xt.set(qn,{canvas:Z,id:qn,display:null}),qn=J,ra=xt.get(qn).canvas.width,na=xt.get(qn).canvas.height):Ke?Ir&&(Ir.replace_Canvas(Z,J),mt.get(J)&&mt.set(J,{canvas:Z})):gt.length>0&&(vt.Replace_Canvas(Z,J),mt.get(J)&&mt.set(J,{canvas:Z}));else if(Ke){if(nr.offScreenCanvasHandle.donotrenderoffscreencanvas){var $=nr.offScreenCanvasHandle.donotrenderoffscreencanvas,oe=$.width,se=$.height;nr.offScreenCanvasHandle.donotrenderoffscreencanvas=new OffscreenCanvas(oe,se),nr.offScreenCanvasHandle.donotrenderoffscreencanvasctx=nr.offScreenCanvasHandle.donotrenderoffscreencanvas.getContext("2d")}if(ce){var ge=ce,ye=ge.width,Se=ge.height;ce=new OffscreenCanvas(ye,Se),le=nr.offScreenCanvasHandle.donotrenderoffscreencanvas.getContext("2d")}if(Zn.mcanvas&&Jn){var Ee=Zn.mcanvas,Fe=Ee.width,Ie=Ee.height;Zn.mcanvas=new OffscreenCanvas(Fe,Ie),Jn=Zn.mcanvas.getContext("2d")}if(Xn){var Ce=Xn,Pe=Ce.width,Le=Ce.height;Xn=new OffscreenCanvas(Pe,Le),zn=Xn.getContext("2d"),Sa(aa,je,qe)}if(ma){var Ue=ma,Ve=Ue.width,He=Ue.height;ma=new OffscreenCanvas(Ve,He)}xt.get(qn)&&xt.get(qn).canvas&&Object(f.i)(qn,!0)}break;case"ENABLE_VIDEO_OBSERVER":Rn=!!r.data;break;case"MAIN_KK":Kr(r.data.KK);break;case"RenderInMain":ie=!0}}))},,function(e,t,r){var n=r(20);e.exports=function(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports},,,function(e,t,r){"use strict";r.r(t);var n=r(30);self.databaseDataType="video",Object.keys(n).forEach((function(e){return self[e]=n[e]}))}]),self.__wasmCodeDataEndFlag=1,(Module="undefined"!==typeof Module?Module:{}).onRuntimeInitialized=function(){self.onWasmModuleReady()};var read_,readAsync,readBinary,setWindowTitle,Module="undefined"!=typeof Module?Module:{},moduleOverrides=Object.assign({},Module),arguments_=[],thisProgram="./this.program",quit_=(e,t)=>{throw t},ENVIRONMENT_IS_WEB="object"==typeof window,ENVIRONMENT_IS_WORKER="function"==typeof importScripts,ENVIRONMENT_IS_NODE="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,scriptDirectory="";function locateFile(e){return Module.locateFile?Module.locateFile(e,scriptDirectory):scriptDirectory+e}(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)&&(ENVIRONMENT_IS_WORKER?scriptDirectory=self.location.href:"undefined"!=typeof document&&document.currentScript&&(scriptDirectory=document.currentScript.src),scriptDirectory=0!==scriptDirectory.indexOf("blob:")?scriptDirectory.substr(0,scriptDirectory.replace(/[?#].*/,"").lastIndexOf("/")+1):"",read_=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},ENVIRONMENT_IS_WORKER&&(readBinary=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),readAsync=(e,t,r)=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=()=>{200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)},setWindowTitle=e=>document.title=e);var out=Module.print||console.log.bind(console),err=Module.printErr||console.warn.bind(console);Object.assign(Module,moduleOverrides),moduleOverrides=null,Module.arguments&&(arguments_=Module.arguments),Module.thisProgram&&(thisProgram=Module.thisProgram),Module.quit&&(quit_=Module.quit);var wasmBinary,POINTER_SIZE=4;Module.wasmBinary&&(wasmBinary=Module.wasmBinary);var wasmMemory,noExitRuntime=Module.noExitRuntime||!0;"object"!=typeof WebAssembly&&abort("no native wasm support detected");var EXITSTATUS,ABORT=!1;function assert(e,t){e||abort(t)}var buffer,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64,UTF8Decoder="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function UTF8ArrayToString(e,t,r){for(var n=t+r,a=t;e[a]&&!(a>=n);)++a;if(a-t>16&&e.buffer&&UTF8Decoder)return UTF8Decoder.decode(e.subarray(t,a));for(var i="";t<a;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var d=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|d:(7&o)<<18|s<<12|d<<6|63&e[t++])<65536)i+=String.fromCharCode(o);else{var u=o-65536;i+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else i+=String.fromCharCode((31&o)<<6|s)}else i+=String.fromCharCode(o)}return i}function UTF8ToString(e,t){return e?UTF8ArrayToString(HEAPU8,e,t):""}function stringToUTF8Array(e,t,r,n){if(!(n>0))return 0;for(var a=r,i=r+n-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343)s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o);if(s<=127){if(r>=i)break;t[r++]=s}else if(s<=2047){if(r+1>=i)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=i)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+3>=i)break;t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-a}function stringToUTF8(e,t,r){return stringToUTF8Array(e,HEAPU8,t,r)}function lengthBytesUTF8(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n<=127?t++:n<=2047?t+=2:n>=55296&&n<=57343?(t+=4,++r):t+=3}return t}function updateGlobalBufferAndViews(e){buffer=e,Module.HEAP8=HEAP8=new Int8Array(e),Module.HEAP16=HEAP16=new Int16Array(e),Module.HEAP32=HEAP32=new Int32Array(e),Module.HEAPU8=HEAPU8=new Uint8Array(e),Module.HEAPU16=HEAPU16=new Uint16Array(e),Module.HEAPU32=HEAPU32=new Uint32Array(e),Module.HEAPF32=HEAPF32=new Float32Array(e),Module.HEAPF64=HEAPF64=new Float64Array(e)}var wasmTable,INITIAL_MEMORY=Module.INITIAL_MEMORY||16777216,__ATPRERUN__=[],__ATINIT__=[],__ATPOSTRUN__=[],runtimeInitialized=!1;function preRun(){if(Module.preRun)for("function"==typeof Module.preRun&&(Module.preRun=[Module.preRun]);Module.preRun.length;)addOnPreRun(Module.preRun.shift());callRuntimeCallbacks(__ATPRERUN__)}function initRuntime(){runtimeInitialized=!0,Module.noFSInit||FS.init.initialized||FS.init(),FS.ignorePermissions=!1,TTY.init(),SOCKFS.root=FS.mount(SOCKFS,{},null),PIPEFS.root=FS.mount(PIPEFS,{},null),callRuntimeCallbacks(__ATINIT__)}function postRun(){if(Module.postRun)for("function"==typeof Module.postRun&&(Module.postRun=[Module.postRun]);Module.postRun.length;)addOnPostRun(Module.postRun.shift());callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(e){__ATPRERUN__.unshift(e)}function addOnInit(e){__ATINIT__.unshift(e)}function addOnPostRun(e){__ATPOSTRUN__.unshift(e)}var runDependencies=0,runDependencyWatcher=null,dependenciesFulfilled=null;function getUniqueRunDependency(e){return e}function addRunDependency(e){runDependencies++,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies)}function removeRunDependency(e){if(runDependencies--,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),0==runDependencies&&(null!==runDependencyWatcher&&(clearInterval(runDependencyWatcher),runDependencyWatcher=null),dependenciesFulfilled)){var t=dependenciesFulfilled;dependenciesFulfilled=null,t()}}function abort(e){throw Module.onAbort&&Module.onAbort(e),err(e="Aborted("+e+")"),ABORT=!0,EXITSTATUS=1,e+=". Build with -sASSERTIONS for more info.",new WebAssembly.RuntimeError(e)}var wasmBinaryFile,tempDouble,tempI64,dataURIPrefix="data:application/octet-stream;base64,";function isDataURI(e){return e.startsWith(dataURIPrefix)}function isFileURI(e){return e.startsWith("file://")}function getBinary(e){try{if(e==wasmBinaryFile&&wasmBinary)return new Uint8Array(wasmBinary);if(readBinary)return readBinary(e);throw"both async and sync fetching of the wasm failed"}catch(err){abort(err)}}function getBinaryPromise(){if(!wasmBinary&&(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)){if("function"==typeof fetch&&!isFileURI(wasmBinaryFile))return fetch(wasmBinaryFile,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+wasmBinaryFile+"'";return e.arrayBuffer()})).catch((function(){return getBinary(wasmBinaryFile)}));if(readAsync)return new Promise((function(e,t){readAsync(wasmBinaryFile,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return getBinary(wasmBinaryFile)}))}function createWasm(){var e={env:asmLibraryArg,wasi_snapshot_preview1:asmLibraryArg};function t(e,t){var r=e.exports;Module.asm=r,updateGlobalBufferAndViews((wasmMemory=Module.asm.memory).buffer),wasmTable=Module.asm.__indirect_function_table,addOnInit(Module.asm.__wasm_call_ctors),removeRunDependency("wasm-instantiate")}function r(e){t(e.instance)}function n(t){return instantiateCachedURL(648,wasmUrl,e)}if(addRunDependency("wasm-instantiate"),Module.instantiateWasm)try{return Module.instantiateWasm(e,t)}catch(a){return err("Module.instantiateWasm callback failed with error: "+a),!1}return wasmBinary||"function"!=typeof WebAssembly.instantiateStreaming||isDataURI(wasmBinaryFile)||isFileURI(wasmBinaryFile)||"function"!=typeof fetch?n():fetch(wasmBinaryFile,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){return err("wasm streaming compile failed: "+e),err("falling back to ArrayBuffer instantiation"),n()}))})),{}}isDataURI(wasmBinaryFile="video.decode.wasm")||(wasmBinaryFile=locateFile(wasmBinaryFile));var ASM_CONSTS={349196:(e,t,r)=>{js_info_from_wcl(e,t,r)},349230:e=>{change_capture_resolution(e)},349265:(e,t,r,n,a,i,o,s,d,u)=>{processed_capture_data_callback(e,t,r,n,a,i,o,s,d,u)},349342:(e,t,r,n,a,i,o,s,d,u,c,l)=>{frame_callback(e,t,r,n,a,i,o,s,d,u,c,l)},349412:(e,t,r,n,a,i,o,s,d,u,c,l)=>{frame_callback_webcodec(e,t,r,n,a,i,o,s,d,u,c,l)},349491:(e,t)=>{decode_callback(e,t)},349520:(e,t,r)=>{js_info_from_wcl(e,t,r)},349554:(e,t,r,n)=>{Video_Controller_Encode_Data2(e,t,r,n)},349602:(e,t)=>{SAVE_IV(e,t)},349620:(e,t,r,n)=>{Video_Controller_Encode_Data(e,t,r,n)},349667:(e,t,r,n,a,i)=>{js_info_from_wcl_video_data(e,t,r,n,a,i)},349724:e=>{Exit_Thread(e)},349742:e=>{Before_Create_Thread(e)},349772:(e,t)=>{APP_Troubleshoting_Info(e,t)},349806:(e,t,r)=>{network_quality_callback(e,t,r)},349846:(e,t)=>{MCMMonitor_Video_LOG(e,t)},349876:()=>Date.now()/1e3,349903:()=>Date.now()%1e3,349930:(e,t)=>{send_data(e,t)},349953:(e,t,r,n,a,i,o,s)=>{responseVideoQosData(e,t,r,n,a,i,o,s)},350008:(e,t,r,n)=>{Monitor_Callback(e,t,r,n)},350046:(e,t,r,n)=>{Monitor_CallbackE(e,t,r,n)},350085:(e,t,r,n)=>{Monitor_CallbackD(e,t,r,n)},350124:(e,t)=>{SAVE_IV(e,t)},350142:()=>Date.now(),350165:(e,t)=>{Update_Required_Bandwidth(e,t)},350201:e=>{Update_Video_Hd_Info(e)},350231:(e,t,r,n)=>{Send_Multi_Data(e,t,r,n)},350265:(e,t,r)=>{SAVE_IV(e,t,r)},350287:(e,t,r)=>{Send_Data(e,t,r)},350311:(e,t,r,n)=>{Send_Data(e,t,r,n)},350339:(e,t,r)=>{Send_Data(e,t,r)},350363:(e,t,r)=>{APP_Troubleshoting_Info(e,t,r)},350401:(e,t,r,n)=>{decode_callback(e,t,r,n)},350438:(e,t,r,n)=>{Send_Data(e,t,r,n)},350469:(e,t,r)=>{Send_Data(e,t,r)},350496:(e,t,r,n)=>{Send_Data(e,t,r,n)},350526:(e,t,r)=>{Send_Data(e,t,r)},350553:(e,t,r,n,a,i,o,s,d,u,c,l,_,f)=>{frame_callback_video_mode(e,t,r,n,a,i,o,s,d,u,c,l,_,f)},350644:(e,t,r,n,a,i,o,s,d,u,c,l)=>{frame_callback_mouse_video_mode(e,t,r,n,a,i,o,s,d,u,c,l)},350731:(e,t)=>{MCMMonitor_Sharing_LOG(e,t)},350763:(e,t,r,n,a,i,o)=>{Send_Out_Qos(e,t,r,n,a,i,o)},350808:(e,t)=>{Send_Data(e,t)},350831:e=>{Update_WebSokcet_Speed(e)},350863:(e,t,r,n,a,i,o,s)=>{responseSharingQosData(e,t,r,n,a,i,o,s)},350920:(e,t,r,n,a)=>{Sharing_Encode_Sending_Status(e,t,r,n,a)},350972:(e,t,r,n)=>{Sharing_Encode_Codec_Info(e,t,r,n)},351016:(e,t)=>{SAVE_IV(e,t)},351034:(e,t,r,n)=>{Sharing_Decode_Channel_Change(e,t,r,n)},351081:(e,t)=>{Update_Required_Bandwidth(e,t)},351117:(e,t,r)=>{Send_Wb_Rtp_Packet(e,t,r)},351148:(e,t)=>{Recieve_Wb_Packet(e,t)},351175:()=>{videoencode_create_helpthread()},351210:()=>{videocodec_create_helpthread()},351244:(e,t)=>{console.error(e,t)},351268:(e,t)=>{LOG_OUT(e,t)},351289:(e,t)=>{wcl_trace_log(e,t)}};function callRuntimeCallbacks(e){for(;e.length>0;)e.shift()(Module)}function withStackSave(e){var t=stackSave(),r=e();return stackRestore(t),r}function demangle(e){return demangle.recursionGuard=1+(0|demangle.recursionGuard),demangle.recursionGuard>1?e:withStackSave((function(){try{var t=e;t.startsWith("__Z")&&(t=t.substr(1));var r=lengthBytesUTF8(t)+1,n=stackAlloc(r);stringToUTF8(t,n,r);var a=stackAlloc(4),i=___cxa_demangle(n,0,0,a);if(0===HEAP32[a>>2]&&i)return UTF8ToString(i)}catch(o){}finally{_free(i),demangle.recursionGuard<2&&--demangle.recursionGuard}return e}))}function jsStackTrace(){var e=new Error;if(!e.stack){try{throw new Error}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function demangleAll(e){return e.replace(/\b_Z[\w\d_]+/g,(function(e){var t=demangle(e);return e===t?e:t+" ["+e+"]"}))}function _AdapterWhiteListCheck(){if(UserAgentIsTesla_js())return 0;if(!IsSupportMultiThreadForWebcodec())return-1;if("function"!=typeof OffscreenCanvas)return-1;var e=new OffscreenCanvas(1,1).getContext("webgl");if(!e)return-1;var t=e.getExtension("WEBGL_debug_renderer_info"),r=e.getParameter(t.UNMASKED_VENDOR_WEBGL),n=e.getParameter(t.UNMASKED_RENDERER_WEBGL).toLowerCase(),a=r.includes("ARM"),i=n.includes("amd"),o=n.includes("intel"),s=n.includes("hd graphics"),d=(n.includes("uhd graphics"),n.includes("nvidia")),u=n.includes("geforce"),c=0;if(o&&s){const e=n.indexOf("hd graphics ");var l=n.slice(e+12);c=parseInt(l)}var _=0;if(d&&u){const e=n.indexOf("geforce gt ");l=n.slice(e+11);_=parseInt(l)}return a?-1:i?0:d&&u&&_<600||o&&s&&(0==c||c>1e3&&c<4e3)?-1:0}function _CloseVideoEncoder(e){CloseVideoEncoder_js(e)}function _CreateGltPlatform(){err("missing function: CreateGltPlatform"),abort(-1)}function _DestroyGltPlatform(){err("missing function: DestroyGltPlatform"),abort(-1)}function _GetEncoderState(e){return GetEncoderState_js(e)}function _GetLogLevel(){return GetLogLevel_js()}function _InitVideoDecoder(e,t){return InitVideoDecoder_js(e,t)}function _InitVideoEncoder(e,t){return InitVideoEncoder_js(e,t)}function _LimitWebCodecsEncoderTo360(){return LimitWebCodecsEncoderTo360_js()}function _Set_Share_Mode(e){return Set_Share_Mode_js(e)}function _UserAgentIsTesla(){return UserAgentIsTesla_js()}function _VideoDecoder(e,t,r,n,a){return VideoDecoder_js(e,t,r,n,a)}function _VideoDecoderConfigure(e,t,r,n,a){return VideoDecoderConfigure_js(e,t,r,n,a)}function _VideoEncoderConfigure(e,t,r,n,a,i){return VideoEncoderConfigure_js(e,t,r,n,a,i)}function _WebCodecsVideoEncoder(e,t,r,n,a){return VideoEncoder_js(e,t,r,n,a)}function __ZN11cpt_generic6thread4joinEv(){err("missing function: _ZN11cpt_generic6thread4joinEv"),abort(-1)}function __ZN11cpt_generic6threadD1Ev(){err("missing function: _ZN11cpt_generic6threadD1Ev"),abort(-1)}function __ZN5Nydus16CWCLWallRenderer14CreateInstanceEPvRKNS_9NydusRectEPPNS_13IWallRendererE(){err("missing function: _ZN5Nydus16CWCLWallRenderer14CreateInstanceEPvRKNS_9NydusRectEPPNS_13IWallRendererE"),abort(-1)}function ___assert_fail(e,t,r,n){abort("Assertion failed: "+UTF8ToString(e)+", at: "+[t?UTF8ToString(t):"unknown filename",r,n?UTF8ToString(n):"unknown function"])}function ___cxa_allocate_exception(e){return _malloc(e+24)+24}function ExceptionInfo(e){this.excPtr=e,this.ptr=e-24,this.set_type=function(e){HEAPU32[this.ptr+4>>2]=e},this.get_type=function(){return HEAPU32[this.ptr+4>>2]},this.set_destructor=function(e){HEAPU32[this.ptr+8>>2]=e},this.get_destructor=function(){return HEAPU32[this.ptr+8>>2]},this.set_refcount=function(e){HEAP32[this.ptr>>2]=e},this.set_caught=function(e){e=e?1:0,HEAP8[this.ptr+12>>0]=e},this.get_caught=function(){return 0!=HEAP8[this.ptr+12>>0]},this.set_rethrown=function(e){e=e?1:0,HEAP8[this.ptr+13>>0]=e},this.get_rethrown=function(){return 0!=HEAP8[this.ptr+13>>0]},this.init=function(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=HEAP32[this.ptr>>2];HEAP32[this.ptr>>2]=e+1},this.release_ref=function(){var e=HEAP32[this.ptr>>2];return HEAP32[this.ptr>>2]=e-1,1===e},this.set_adjusted_ptr=function(e){HEAPU32[this.ptr+16>>2]=e},this.get_adjusted_ptr=function(){return HEAPU32[this.ptr+16>>2]},this.get_exception_ptr=function(){if(___cxa_is_pointer_type(this.get_type()))return HEAPU32[this.excPtr>>2];var e=this.get_adjusted_ptr();return 0!==e?e:this.excPtr}}var exceptionLast=0,uncaughtExceptionCount=0;function ___cxa_throw(e,t,r){throw new ExceptionInfo(e).init(t,r),exceptionLast=e,uncaughtExceptionCount++,e}var PATH={isAbs:e=>"/"===e.charAt(0),splitPath:e=>/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1),normalizeArray:(e,t)=>{for(var r=0,n=e.length-1;n>=0;n--){var a=e[n];"."===a?e.splice(n,1):".."===a?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r;r--)e.unshift("..");return e},normalize:e=>{var t=PATH.isAbs(e),r="/"===e.substr(-1);return(e=PATH.normalizeArray(e.split("/").filter((e=>!!e)),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e},dirname:e=>{var t=PATH.splitPath(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},basename:e=>{if("/"===e)return"/";var t=(e=(e=PATH.normalize(e)).replace(/\/$/,"")).lastIndexOf("/");return-1===t?e:e.substr(t+1)},join:function(){var e=Array.prototype.slice.call(arguments);return PATH.normalize(e.join("/"))},join2:(e,t)=>PATH.normalize(e+"/"+t)};function getRandomDevice(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return()=>(crypto.getRandomValues(e),e[0])}return()=>abort("randomDevice")}var PATH_FS={resolve:function(){for(var e="",t=!1,r=arguments.length-1;r>=-1&&!t;r--){var n=r>=0?arguments[r]:FS.cwd();if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";e=n+"/"+e,t=PATH.isAbs(n)}return(t?"/":"")+(e=PATH.normalizeArray(e.split("/").filter((e=>!!e)),!t).join("/"))||"."},relative:(e,t)=>{function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=PATH_FS.resolve(e).substr(1),t=PATH_FS.resolve(t).substr(1);for(var n=r(e.split("/")),a=r(t.split("/")),i=Math.min(n.length,a.length),o=i,s=0;s<i;s++)if(n[s]!==a[s]){o=s;break}var d=[];for(s=o;s<n.length;s++)d.push("..");return(d=d.concat(a.slice(o))).join("/")}};function intArrayFromString(e,t,r){var n=r>0?r:lengthBytesUTF8(e)+1,a=new Array(n),i=stringToUTF8Array(e,a,0,a.length);return t&&(a.length=i),a}var TTY={ttys:[],init:function(){},shutdown:function(){},register:function(e,t){TTY.ttys[e]={input:[],output:[],ops:t},FS.registerDevice(e,TTY.stream_ops)},stream_ops:{open:function(e){var t=TTY.ttys[e.node.rdev];if(!t)throw new FS.ErrnoError(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.ops.fsync(e.tty)},fsync:function(e){e.tty.ops.fsync(e.tty)},read:function(e,t,r,n,a){if(!e.tty||!e.tty.ops.get_char)throw new FS.ErrnoError(60);for(var i=0,o=0;o<n;o++){var s;try{s=e.tty.ops.get_char(e.tty)}catch(d){throw new FS.ErrnoError(29)}if(void 0===s&&0===i)throw new FS.ErrnoError(6);if(null===s||void 0===s)break;i++,t[r+o]=s}return i&&(e.node.timestamp=Date.now()),i},write:function(e,t,r,n,a){if(!e.tty||!e.tty.ops.put_char)throw new FS.ErrnoError(60);try{for(var i=0;i<n;i++)e.tty.ops.put_char(e.tty,t[r+i])}catch(o){throw new FS.ErrnoError(29)}return n&&(e.node.timestamp=Date.now()),i}},default_tty_ops:{get_char:function(e){if(!e.input.length){var t=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n"),!t)return null;e.input=intArrayFromString(t,!0)}return e.input.shift()},put_char:function(e,t){null===t||10===t?(out(UTF8ArrayToString(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},fsync:function(e){e.output&&e.output.length>0&&(out(UTF8ArrayToString(e.output,0)),e.output=[])}},default_tty1_ops:{put_char:function(e,t){null===t||10===t?(err(UTF8ArrayToString(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},fsync:function(e){e.output&&e.output.length>0&&(err(UTF8ArrayToString(e.output,0)),e.output=[])}}};function mmapAlloc(e){abort()}var MEMFS={ops_table:null,mount:function(e){return MEMFS.createNode(null,"/",16895,0)},createNode:function(e,t,r,n){if(FS.isBlkdev(r)||FS.isFIFO(r))throw new FS.ErrnoError(63);MEMFS.ops_table||(MEMFS.ops_table={dir:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,lookup:MEMFS.node_ops.lookup,mknod:MEMFS.node_ops.mknod,rename:MEMFS.node_ops.rename,unlink:MEMFS.node_ops.unlink,rmdir:MEMFS.node_ops.rmdir,readdir:MEMFS.node_ops.readdir,symlink:MEMFS.node_ops.symlink},stream:{llseek:MEMFS.stream_ops.llseek}},file:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:{llseek:MEMFS.stream_ops.llseek,read:MEMFS.stream_ops.read,write:MEMFS.stream_ops.write,allocate:MEMFS.stream_ops.allocate,mmap:MEMFS.stream_ops.mmap,msync:MEMFS.stream_ops.msync}},link:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,readlink:MEMFS.node_ops.readlink},stream:{}},chrdev:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:FS.chrdev_stream_ops}});var a=FS.createNode(e,t,r,n);return FS.isDir(a.mode)?(a.node_ops=MEMFS.ops_table.dir.node,a.stream_ops=MEMFS.ops_table.dir.stream,a.contents={}):FS.isFile(a.mode)?(a.node_ops=MEMFS.ops_table.file.node,a.stream_ops=MEMFS.ops_table.file.stream,a.usedBytes=0,a.contents=null):FS.isLink(a.mode)?(a.node_ops=MEMFS.ops_table.link.node,a.stream_ops=MEMFS.ops_table.link.stream):FS.isChrdev(a.mode)&&(a.node_ops=MEMFS.ops_table.chrdev.node,a.stream_ops=MEMFS.ops_table.chrdev.stream),a.timestamp=Date.now(),e&&(e.contents[t]=a,e.timestamp=a.timestamp),a},getFileDataAsTypedArray:function(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage:function(e,t){var r=e.contents?e.contents.length:0;if(!(r>=t)){t=Math.max(t,r*(r<1048576?2:1.125)>>>0),0!=r&&(t=Math.max(t,256));var n=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(n.subarray(0,e.usedBytes),0)}},resizeFileStorage:function(e,t){if(e.usedBytes!=t)if(0==t)e.contents=null,e.usedBytes=0;else{var r=e.contents;e.contents=new Uint8Array(t),r&&e.contents.set(r.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}},node_ops:{getattr:function(e){var t={};return t.dev=FS.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,FS.isDir(e.mode)?t.size=4096:FS.isFile(e.mode)?t.size=e.usedBytes:FS.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&MEMFS.resizeFileStorage(e,t.size)},lookup:function(e,t){throw FS.genericErrors[44]},mknod:function(e,t,r,n){return MEMFS.createNode(e,t,r,n)},rename:function(e,t,r){if(FS.isDir(e.mode)){var n;try{n=FS.lookupNode(t,r)}catch(i){}if(n)for(var a in n.contents)throw new FS.ErrnoError(55)}delete e.parent.contents[e.name],e.parent.timestamp=Date.now(),e.name=r,t.contents[r]=e,t.timestamp=e.parent.timestamp,e.parent=t},unlink:function(e,t){delete e.contents[t],e.timestamp=Date.now()},rmdir:function(e,t){var r=FS.lookupNode(e,t);for(var n in r.contents)throw new FS.ErrnoError(55);delete e.contents[t],e.timestamp=Date.now()},readdir:function(e){var t=[".",".."];for(var r in e.contents)e.contents.hasOwnProperty(r)&&t.push(r);return t},symlink:function(e,t,r){var n=MEMFS.createNode(e,t,41471,0);return n.link=r,n},readlink:function(e){if(!FS.isLink(e.mode))throw new FS.ErrnoError(28);return e.link}},stream_ops:{read:function(e,t,r,n,a){var i=e.node.contents;if(a>=e.node.usedBytes)return 0;var o=Math.min(e.node.usedBytes-a,n);if(o>8&&i.subarray)t.set(i.subarray(a,a+o),r);else for(var s=0;s<o;s++)t[r+s]=i[a+s];return o},write:function(e,t,r,n,a,i){if(t.buffer===HEAP8.buffer&&(i=!1),!n)return 0;var o=e.node;if(o.timestamp=Date.now(),t.subarray&&(!o.contents||o.contents.subarray)){if(i)return o.contents=t.subarray(r,r+n),o.usedBytes=n,n;if(0===o.usedBytes&&0===a)return o.contents=t.slice(r,r+n),o.usedBytes=n,n;if(a+n<=o.usedBytes)return o.contents.set(t.subarray(r,r+n),a),n}if(MEMFS.expandFileStorage(o,a+n),o.contents.subarray&&t.subarray)o.contents.set(t.subarray(r,r+n),a);else for(var s=0;s<n;s++)o.contents[a+s]=t[r+s];return o.usedBytes=Math.max(o.usedBytes,a+n),n},llseek:function(e,t,r){var n=t;if(1===r?n+=e.position:2===r&&FS.isFile(e.node.mode)&&(n+=e.node.usedBytes),n<0)throw new FS.ErrnoError(28);return n},allocate:function(e,t,r){MEMFS.expandFileStorage(e.node,t+r),e.node.usedBytes=Math.max(e.node.usedBytes,t+r)},mmap:function(e,t,r,n,a){if(!FS.isFile(e.node.mode))throw new FS.ErrnoError(43);var i,o,s=e.node.contents;if(2&a||s.buffer!==buffer){if((r>0||r+t<s.length)&&(s=s.subarray?s.subarray(r,r+t):Array.prototype.slice.call(s,r,r+t)),o=!0,!(i=mmapAlloc(t)))throw new FS.ErrnoError(48);HEAP8.set(s,i)}else o=!1,i=s.byteOffset;return{ptr:i,allocated:o}},msync:function(e,t,r,n,a){return MEMFS.stream_ops.write(e,t,0,n,r,!1),0}}};function asyncLoad(e,t,r,n){var a=n?"":getUniqueRunDependency("al "+e);readAsync(e,(r=>{assert(r,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(r)),a&&removeRunDependency(a)}),(t=>{if(!r)throw'Loading data file "'+e+'" failed.';r()})),a&&addRunDependency(a)}var FS={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(e,t={})=>{if(!(e=PATH_FS.resolve(e)))return{path:"",node:null};if((t=Object.assign({follow_mount:!0,recurse_count:0},t)).recurse_count>8)throw new FS.ErrnoError(32);for(var r=e.split("/").filter((e=>!!e)),n=FS.root,a="/",i=0;i<r.length;i++){var o=i===r.length-1;if(o&&t.parent)break;if(n=FS.lookupNode(n,r[i]),a=PATH.join2(a,r[i]),FS.isMountpoint(n)&&(!o||o&&t.follow_mount)&&(n=n.mounted.root),!o||t.follow)for(var s=0;FS.isLink(n.mode);){var d=FS.readlink(a);if(a=PATH_FS.resolve(PATH.dirname(a),d),n=FS.lookupPath(a,{recurse_count:t.recurse_count+1}).node,s++>40)throw new FS.ErrnoError(32)}}return{path:a,node:n}},getPath:e=>{for(var t;;){if(FS.isRoot(e)){var r=e.mount.mountpoint;return t?"/"!==r[r.length-1]?r+"/"+t:r+t:r}t=t?e.name+"/"+t:e.name,e=e.parent}},hashName:(e,t)=>{for(var r=0,n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n)|0;return(e+r>>>0)%FS.nameTable.length},hashAddNode:e=>{var t=FS.hashName(e.parent.id,e.name);e.name_next=FS.nameTable[t],FS.nameTable[t]=e},hashRemoveNode:e=>{var t=FS.hashName(e.parent.id,e.name);if(FS.nameTable[t]===e)FS.nameTable[t]=e.name_next;else for(var r=FS.nameTable[t];r;){if(r.name_next===e){r.name_next=e.name_next;break}r=r.name_next}},lookupNode:(e,t)=>{var r=FS.mayLookup(e);if(r)throw new FS.ErrnoError(r,e);for(var n=FS.hashName(e.id,t),a=FS.nameTable[n];a;a=a.name_next){var i=a.name;if(a.parent.id===e.id&&i===t)return a}return FS.lookup(e,t)},createNode:(e,t,r,n)=>{var a=new FS.FSNode(e,t,r,n);return FS.hashAddNode(a),a},destroyNode:e=>{FS.hashRemoveNode(e)},isRoot:e=>e===e.parent,isMountpoint:e=>!!e.mounted,isFile:e=>32768===(61440&e),isDir:e=>16384===(61440&e),isLink:e=>40960===(61440&e),isChrdev:e=>8192===(61440&e),isBlkdev:e=>24576===(61440&e),isFIFO:e=>4096===(61440&e),isSocket:e=>49152===(49152&e),flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:e=>{var t=FS.flagModes[e];if("undefined"==typeof t)throw new Error("Unknown file open mode: "+e);return t},flagsToPermissionString:e=>{var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:(e,t)=>FS.ignorePermissions||(!t.includes("r")||292&e.mode)&&(!t.includes("w")||146&e.mode)&&(!t.includes("x")||73&e.mode)?0:2,mayLookup:e=>{var t=FS.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate:(e,t)=>{try{FS.lookupNode(e,t);return 20}catch(r){}return FS.nodePermissions(e,"wx")},mayDelete:(e,t,r)=>{var n;try{n=FS.lookupNode(e,t)}catch(i){return i.errno}var a=FS.nodePermissions(e,"wx");if(a)return a;if(r){if(!FS.isDir(n.mode))return 54;if(FS.isRoot(n)||FS.getPath(n)===FS.cwd())return 10}else if(FS.isDir(n.mode))return 31;return 0},mayOpen:(e,t)=>e?FS.isLink(e.mode)?32:FS.isDir(e.mode)&&("r"!==FS.flagsToPermissionString(t)||512&t)?31:FS.nodePermissions(e,FS.flagsToPermissionString(t)):44,MAX_OPEN_FDS:4096,nextfd:(e=0,t=FS.MAX_OPEN_FDS)=>{for(var r=e;r<=t;r++)if(!FS.streams[r])return r;throw new FS.ErrnoError(33)},getStream:e=>FS.streams[e],createStream:(e,t,r)=>{FS.FSStream||(FS.FSStream=function(){this.shared={}},FS.FSStream.prototype={},Object.defineProperties(FS.FSStream.prototype,{object:{get:function(){return this.node},set:function(e){this.node=e}},isRead:{get:function(){return 1!==(2097155&this.flags)}},isWrite:{get:function(){return 0!==(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}},flags:{get:function(){return this.shared.flags},set:function(e){this.shared.flags=e}},position:{get:function(){return this.shared.position},set:function(e){this.shared.position=e}}})),e=Object.assign(new FS.FSStream,e);var n=FS.nextfd(t,r);return e.fd=n,FS.streams[n]=e,e},closeStream:e=>{FS.streams[e]=null},chrdev_stream_ops:{open:e=>{var t=FS.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open&&e.stream_ops.open(e)},llseek:()=>{throw new FS.ErrnoError(70)}},major:e=>e>>8,minor:e=>255&e,makedev:(e,t)=>e<<8|t,registerDevice:(e,t)=>{FS.devices[e]={stream_ops:t}},getDevice:e=>FS.devices[e],getMounts:e=>{for(var t=[],r=[e];r.length;){var n=r.pop();t.push(n),r.push.apply(r,n.mounts)}return t},syncfs:(e,t)=>{"function"==typeof e&&(t=e,e=!1),FS.syncFSRequests++,FS.syncFSRequests>1&&err("warning: "+FS.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var r=FS.getMounts(FS.root.mount),n=0;function a(e){return FS.syncFSRequests--,t(e)}function i(e){if(e)return i.errored?void 0:(i.errored=!0,a(e));++n>=r.length&&a(null)}r.forEach((t=>{if(!t.type.syncfs)return i(null);t.type.syncfs(t,e,i)}))},mount:(e,t,r)=>{var n,a="/"===r,i=!r;if(a&&FS.root)throw new FS.ErrnoError(10);if(!a&&!i){var o=FS.lookupPath(r,{follow_mount:!1});if(r=o.path,n=o.node,FS.isMountpoint(n))throw new FS.ErrnoError(10);if(!FS.isDir(n.mode))throw new FS.ErrnoError(54)}var s={type:e,opts:t,mountpoint:r,mounts:[]},d=e.mount(s);return d.mount=s,s.root=d,a?FS.root=d:n&&(n.mounted=s,n.mount&&n.mount.mounts.push(s)),d},unmount:e=>{var t=FS.lookupPath(e,{follow_mount:!1});if(!FS.isMountpoint(t.node))throw new FS.ErrnoError(28);var r=t.node,n=r.mounted,a=FS.getMounts(n);Object.keys(FS.nameTable).forEach((e=>{for(var t=FS.nameTable[e];t;){var r=t.name_next;a.includes(t.mount)&&FS.destroyNode(t),t=r}})),r.mounted=null;var i=r.mount.mounts.indexOf(n);r.mount.mounts.splice(i,1)},lookup:(e,t)=>e.node_ops.lookup(e,t),mknod:(e,t,r)=>{var n=FS.lookupPath(e,{parent:!0}).node,a=PATH.basename(e);if(!a||"."===a||".."===a)throw new FS.ErrnoError(28);var i=FS.mayCreate(n,a);if(i)throw new FS.ErrnoError(i);if(!n.node_ops.mknod)throw new FS.ErrnoError(63);return n.node_ops.mknod(n,a,t,r)},create:(e,t)=>(t=void 0!==t?t:438,t&=4095,t|=32768,FS.mknod(e,t,0)),mkdir:(e,t)=>(t=void 0!==t?t:511,t&=1023,t|=16384,FS.mknod(e,t,0)),mkdirTree:(e,t)=>{for(var r=e.split("/"),n="",a=0;a<r.length;++a)if(r[a]){n+="/"+r[a];try{FS.mkdir(n,t)}catch(i){if(20!=i.errno)throw i}}},mkdev:(e,t,r)=>("undefined"==typeof r&&(r=t,t=438),t|=8192,FS.mknod(e,t,r)),symlink:(e,t)=>{if(!PATH_FS.resolve(e))throw new FS.ErrnoError(44);var r=FS.lookupPath(t,{parent:!0}).node;if(!r)throw new FS.ErrnoError(44);var n=PATH.basename(t),a=FS.mayCreate(r,n);if(a)throw new FS.ErrnoError(a);if(!r.node_ops.symlink)throw new FS.ErrnoError(63);return r.node_ops.symlink(r,n,e)},rename:(e,t)=>{var r,n,a=PATH.dirname(e),i=PATH.dirname(t),o=PATH.basename(e),s=PATH.basename(t);if(r=FS.lookupPath(e,{parent:!0}).node,n=FS.lookupPath(t,{parent:!0}).node,!r||!n)throw new FS.ErrnoError(44);if(r.mount!==n.mount)throw new FS.ErrnoError(75);var d,u=FS.lookupNode(r,o),c=PATH_FS.relative(e,i);if("."!==c.charAt(0))throw new FS.ErrnoError(28);if("."!==(c=PATH_FS.relative(t,a)).charAt(0))throw new FS.ErrnoError(55);try{d=FS.lookupNode(n,s)}catch(f){}if(u!==d){var l=FS.isDir(u.mode),_=FS.mayDelete(r,o,l);if(_)throw new FS.ErrnoError(_);if(_=d?FS.mayDelete(n,s,l):FS.mayCreate(n,s))throw new FS.ErrnoError(_);if(!r.node_ops.rename)throw new FS.ErrnoError(63);if(FS.isMountpoint(u)||d&&FS.isMountpoint(d))throw new FS.ErrnoError(10);if(n!==r&&(_=FS.nodePermissions(r,"w")))throw new FS.ErrnoError(_);FS.hashRemoveNode(u);try{r.node_ops.rename(u,n,s)}catch(f){throw f}finally{FS.hashAddNode(u)}}},rmdir:e=>{var t=FS.lookupPath(e,{parent:!0}).node,r=PATH.basename(e),n=FS.lookupNode(t,r),a=FS.mayDelete(t,r,!0);if(a)throw new FS.ErrnoError(a);if(!t.node_ops.rmdir)throw new FS.ErrnoError(63);if(FS.isMountpoint(n))throw new FS.ErrnoError(10);t.node_ops.rmdir(t,r),FS.destroyNode(n)},readdir:e=>{var t=FS.lookupPath(e,{follow:!0}).node;if(!t.node_ops.readdir)throw new FS.ErrnoError(54);return t.node_ops.readdir(t)},unlink:e=>{var t=FS.lookupPath(e,{parent:!0}).node;if(!t)throw new FS.ErrnoError(44);var r=PATH.basename(e),n=FS.lookupNode(t,r),a=FS.mayDelete(t,r,!1);if(a)throw new FS.ErrnoError(a);if(!t.node_ops.unlink)throw new FS.ErrnoError(63);if(FS.isMountpoint(n))throw new FS.ErrnoError(10);t.node_ops.unlink(t,r),FS.destroyNode(n)},readlink:e=>{var t=FS.lookupPath(e).node;if(!t)throw new FS.ErrnoError(44);if(!t.node_ops.readlink)throw new FS.ErrnoError(28);return PATH_FS.resolve(FS.getPath(t.parent),t.node_ops.readlink(t))},stat:(e,t)=>{var r=FS.lookupPath(e,{follow:!t}).node;if(!r)throw new FS.ErrnoError(44);if(!r.node_ops.getattr)throw new FS.ErrnoError(63);return r.node_ops.getattr(r)},lstat:e=>FS.stat(e,!0),chmod:(e,t,r)=>{var n;"string"==typeof e?n=FS.lookupPath(e,{follow:!r}).node:n=e;if(!n.node_ops.setattr)throw new FS.ErrnoError(63);n.node_ops.setattr(n,{mode:4095&t|-4096&n.mode,timestamp:Date.now()})},lchmod:(e,t)=>{FS.chmod(e,t,!0)},fchmod:(e,t)=>{var r=FS.getStream(e);if(!r)throw new FS.ErrnoError(8);FS.chmod(r.node,t)},chown:(e,t,r,n)=>{var a;"string"==typeof e?a=FS.lookupPath(e,{follow:!n}).node:a=e;if(!a.node_ops.setattr)throw new FS.ErrnoError(63);a.node_ops.setattr(a,{timestamp:Date.now()})},lchown:(e,t,r)=>{FS.chown(e,t,r,!0)},fchown:(e,t,r)=>{var n=FS.getStream(e);if(!n)throw new FS.ErrnoError(8);FS.chown(n.node,t,r)},truncate:(e,t)=>{if(t<0)throw new FS.ErrnoError(28);var r;"string"==typeof e?r=FS.lookupPath(e,{follow:!0}).node:r=e;if(!r.node_ops.setattr)throw new FS.ErrnoError(63);if(FS.isDir(r.mode))throw new FS.ErrnoError(31);if(!FS.isFile(r.mode))throw new FS.ErrnoError(28);var n=FS.nodePermissions(r,"w");if(n)throw new FS.ErrnoError(n);r.node_ops.setattr(r,{size:t,timestamp:Date.now()})},ftruncate:(e,t)=>{var r=FS.getStream(e);if(!r)throw new FS.ErrnoError(8);if(0===(2097155&r.flags))throw new FS.ErrnoError(28);FS.truncate(r.node,t)},utime:(e,t,r)=>{var n=FS.lookupPath(e,{follow:!0}).node;n.node_ops.setattr(n,{timestamp:Math.max(t,r)})},open:(e,t,r)=>{if(""===e)throw new FS.ErrnoError(44);var n;if(r="undefined"==typeof r?438:r,r=64&(t="string"==typeof t?FS.modeStringToFlags(t):t)?4095&r|32768:0,"object"==typeof e)n=e;else{e=PATH.normalize(e);try{n=FS.lookupPath(e,{follow:!(131072&t)}).node}catch(s){}}var a=!1;if(64&t)if(n){if(128&t)throw new FS.ErrnoError(20)}else n=FS.mknod(e,r,0),a=!0;if(!n)throw new FS.ErrnoError(44);if(FS.isChrdev(n.mode)&&(t&=-513),65536&t&&!FS.isDir(n.mode))throw new FS.ErrnoError(54);if(!a){var i=FS.mayOpen(n,t);if(i)throw new FS.ErrnoError(i)}512&t&&!a&&FS.truncate(n,0),t&=-131713;var o=FS.createStream({node:n,path:FS.getPath(n),flags:t,seekable:!0,position:0,stream_ops:n.stream_ops,ungotten:[],error:!1});return o.stream_ops.open&&o.stream_ops.open(o),!Module.logReadFiles||1&t||(FS.readFiles||(FS.readFiles={}),e in FS.readFiles||(FS.readFiles[e]=1)),o},close:e=>{if(FS.isClosed(e))throw new FS.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(t){throw t}finally{FS.closeStream(e.fd)}e.fd=null},isClosed:e=>null===e.fd,llseek:(e,t,r)=>{if(FS.isClosed(e))throw new FS.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new FS.ErrnoError(70);if(0!=r&&1!=r&&2!=r)throw new FS.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,r),e.ungotten=[],e.position},read:(e,t,r,n,a)=>{if(n<0||a<0)throw new FS.ErrnoError(28);if(FS.isClosed(e))throw new FS.ErrnoError(8);if(1===(2097155&e.flags))throw new FS.ErrnoError(8);if(FS.isDir(e.node.mode))throw new FS.ErrnoError(31);if(!e.stream_ops.read)throw new FS.ErrnoError(28);var i="undefined"!=typeof a;if(i){if(!e.seekable)throw new FS.ErrnoError(70)}else a=e.position;var o=e.stream_ops.read(e,t,r,n,a);return i||(e.position+=o),o},write:(e,t,r,n,a,i)=>{if(n<0||a<0)throw new FS.ErrnoError(28);if(FS.isClosed(e))throw new FS.ErrnoError(8);if(0===(2097155&e.flags))throw new FS.ErrnoError(8);if(FS.isDir(e.node.mode))throw new FS.ErrnoError(31);if(!e.stream_ops.write)throw new FS.ErrnoError(28);e.seekable&&1024&e.flags&&FS.llseek(e,0,2);var o="undefined"!=typeof a;if(o){if(!e.seekable)throw new FS.ErrnoError(70)}else a=e.position;var s=e.stream_ops.write(e,t,r,n,a,i);return o||(e.position+=s),s},allocate:(e,t,r)=>{if(FS.isClosed(e))throw new FS.ErrnoError(8);if(t<0||r<=0)throw new FS.ErrnoError(28);if(0===(2097155&e.flags))throw new FS.ErrnoError(8);if(!FS.isFile(e.node.mode)&&!FS.isDir(e.node.mode))throw new FS.ErrnoError(43);if(!e.stream_ops.allocate)throw new FS.ErrnoError(138);e.stream_ops.allocate(e,t,r)},mmap:(e,t,r,n,a)=>{if(0!==(2&n)&&0===(2&a)&&2!==(2097155&e.flags))throw new FS.ErrnoError(2);if(1===(2097155&e.flags))throw new FS.ErrnoError(2);if(!e.stream_ops.mmap)throw new FS.ErrnoError(43);return e.stream_ops.mmap(e,t,r,n,a)},msync:(e,t,r,n,a)=>e.stream_ops.msync?e.stream_ops.msync(e,t,r,n,a):0,munmap:e=>0,ioctl:(e,t,r)=>{if(!e.stream_ops.ioctl)throw new FS.ErrnoError(59);return e.stream_ops.ioctl(e,t,r)},readFile:(e,t={})=>{if(t.flags=t.flags||0,t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding)throw new Error('Invalid encoding type "'+t.encoding+'"');var r,n=FS.open(e,t.flags),a=FS.stat(e).size,i=new Uint8Array(a);return FS.read(n,i,0,a,0),"utf8"===t.encoding?r=UTF8ArrayToString(i,0):"binary"===t.encoding&&(r=i),FS.close(n),r},writeFile:(e,t,r={})=>{r.flags=r.flags||577;var n=FS.open(e,r.flags,r.mode);if("string"==typeof t){var a=new Uint8Array(lengthBytesUTF8(t)+1),i=stringToUTF8Array(t,a,0,a.length);FS.write(n,a,0,i,void 0,r.canOwn)}else{if(!ArrayBuffer.isView(t))throw new Error("Unsupported data type");FS.write(n,t,0,t.byteLength,void 0,r.canOwn)}FS.close(n)},cwd:()=>FS.currentPath,chdir:e=>{var t=FS.lookupPath(e,{follow:!0});if(null===t.node)throw new FS.ErrnoError(44);if(!FS.isDir(t.node.mode))throw new FS.ErrnoError(54);var r=FS.nodePermissions(t.node,"x");if(r)throw new FS.ErrnoError(r);FS.currentPath=t.path},createDefaultDirectories:()=>{FS.mkdir("/tmp"),FS.mkdir("/home"),FS.mkdir("/home/web_user")},createDefaultDevices:()=>{FS.mkdir("/dev"),FS.registerDevice(FS.makedev(1,3),{read:()=>0,write:(e,t,r,n,a)=>n}),FS.mkdev("/dev/null",FS.makedev(1,3)),TTY.register(FS.makedev(5,0),TTY.default_tty_ops),TTY.register(FS.makedev(6,0),TTY.default_tty1_ops),FS.mkdev("/dev/tty",FS.makedev(5,0)),FS.mkdev("/dev/tty1",FS.makedev(6,0));var e=getRandomDevice();FS.createDevice("/dev","random",e),FS.createDevice("/dev","urandom",e),FS.mkdir("/dev/shm"),FS.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{FS.mkdir("/proc");var e=FS.mkdir("/proc/self");FS.mkdir("/proc/self/fd"),FS.mount({mount:()=>{var t=FS.createNode(e,"fd",16895,73);return t.node_ops={lookup:(e,t)=>{var r=+t,n=FS.getStream(r);if(!n)throw new FS.ErrnoError(8);var a={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>n.path}};return a.parent=a,a}},t}},{},"/proc/self/fd")},createStandardStreams:()=>{Module.stdin?FS.createDevice("/dev","stdin",Module.stdin):FS.symlink("/dev/tty","/dev/stdin"),Module.stdout?FS.createDevice("/dev","stdout",null,Module.stdout):FS.symlink("/dev/tty","/dev/stdout"),Module.stderr?FS.createDevice("/dev","stderr",null,Module.stderr):FS.symlink("/dev/tty1","/dev/stderr");FS.open("/dev/stdin",0),FS.open("/dev/stdout",1),FS.open("/dev/stderr",1)},ensureErrnoError:()=>{FS.ErrnoError||(FS.ErrnoError=function(e,t){this.node=t,this.setErrno=function(e){this.errno=e},this.setErrno(e),this.message="FS error"},FS.ErrnoError.prototype=new Error,FS.ErrnoError.prototype.constructor=FS.ErrnoError,[44].forEach((e=>{FS.genericErrors[e]=new FS.ErrnoError(e),FS.genericErrors[e].stack="<generic error, no stack>"})))},staticInit:()=>{FS.ensureErrnoError(),FS.nameTable=new Array(4096),FS.mount(MEMFS,{},"/"),FS.createDefaultDirectories(),FS.createDefaultDevices(),FS.createSpecialDirectories(),FS.filesystems={MEMFS:MEMFS}},init:(e,t,r)=>{FS.init.initialized=!0,FS.ensureErrnoError(),Module.stdin=e||Module.stdin,Module.stdout=t||Module.stdout,Module.stderr=r||Module.stderr,FS.createStandardStreams()},quit:()=>{FS.init.initialized=!1;for(var e=0;e<FS.streams.length;e++){var t=FS.streams[e];t&&FS.close(t)}},getMode:(e,t)=>{var r=0;return e&&(r|=365),t&&(r|=146),r},findObject:(e,t)=>{var r=FS.analyzePath(e,t);return r.exists?r.object:null},analyzePath:(e,t)=>{try{e=(n=FS.lookupPath(e,{follow:!t})).path}catch(a){}var r={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var n=FS.lookupPath(e,{parent:!0});r.parentExists=!0,r.parentPath=n.path,r.parentObject=n.node,r.name=PATH.basename(e),n=FS.lookupPath(e,{follow:!t}),r.exists=!0,r.path=n.path,r.object=n.node,r.name=n.node.name,r.isRoot="/"===n.path}catch(a){r.error=a.errno}return r},createPath:(e,t,r,n)=>{e="string"==typeof e?e:FS.getPath(e);for(var a=t.split("/").reverse();a.length;){var i=a.pop();if(i){var o=PATH.join2(e,i);try{FS.mkdir(o)}catch(s){}e=o}}return o},createFile:(e,t,r,n,a)=>{var i=PATH.join2("string"==typeof e?e:FS.getPath(e),t),o=FS.getMode(n,a);return FS.create(i,o)},createDataFile:(e,t,r,n,a,i)=>{var o=t;e&&(e="string"==typeof e?e:FS.getPath(e),o=t?PATH.join2(e,t):e);var s=FS.getMode(n,a),d=FS.create(o,s);if(r){if("string"==typeof r){for(var u=new Array(r.length),c=0,l=r.length;c<l;++c)u[c]=r.charCodeAt(c);r=u}FS.chmod(d,146|s);var _=FS.open(d,577);FS.write(_,r,0,r.length,0,i),FS.close(_),FS.chmod(d,s)}return d},createDevice:(e,t,r,n)=>{var a=PATH.join2("string"==typeof e?e:FS.getPath(e),t),i=FS.getMode(!!r,!!n);FS.createDevice.major||(FS.createDevice.major=64);var o=FS.makedev(FS.createDevice.major++,0);return FS.registerDevice(o,{open:e=>{e.seekable=!1},close:e=>{n&&n.buffer&&n.buffer.length&&n(10)},read:(e,t,n,a,i)=>{for(var o=0,s=0;s<a;s++){var d;try{d=r()}catch(u){throw new FS.ErrnoError(29)}if(void 0===d&&0===o)throw new FS.ErrnoError(6);if(null===d||void 0===d)break;o++,t[n+s]=d}return o&&(e.node.timestamp=Date.now()),o},write:(e,t,r,a,i)=>{for(var o=0;o<a;o++)try{n(t[r+o])}catch(s){throw new FS.ErrnoError(29)}return a&&(e.node.timestamp=Date.now()),o}}),FS.mkdev(a,i,o)},forceLoadFile:e=>{if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!read_)throw new Error("Cannot load without read() or XMLHttpRequest.");try{e.contents=intArrayFromString(read_(e.url),!0),e.usedBytes=e.contents.length}catch(t){throw new FS.ErrnoError(29)}},createLazyFile:(e,t,r,n,a)=>{function i(){this.lengthKnown=!1,this.chunks=[]}if(i.prototype.get=function(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,r=e/this.chunkSize|0;return this.getter(r)[t]}},i.prototype.setDataGetter=function(e){this.getter=e},i.prototype.cacheLength=function(){var e=new XMLHttpRequest;if(e.open("HEAD",r,!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+r+". Status: "+e.status);var t,n=Number(e.getResponseHeader("Content-length")),a=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t,i=(t=e.getResponseHeader("Content-Encoding"))&&"gzip"===t,o=1048576;a||(o=n);var s=this;s.setDataGetter((e=>{var t=e*o,a=(e+1)*o-1;if(a=Math.min(a,n-1),"undefined"==typeof s.chunks[e]&&(s.chunks[e]=((e,t)=>{if(e>t)throw new Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>n-1)throw new Error("only "+n+" bytes available! programmer error!");var a=new XMLHttpRequest;if(a.open("GET",r,!1),n!==o&&a.setRequestHeader("Range","bytes="+e+"-"+t),a.responseType="arraybuffer",a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined"),a.send(null),!(a.status>=200&&a.status<300||304===a.status))throw new Error("Couldn't load "+r+". Status: "+a.status);return void 0!==a.response?new Uint8Array(a.response||[]):intArrayFromString(a.responseText||"",!0)})(t,a)),"undefined"==typeof s.chunks[e])throw new Error("doXHR failed!");return s.chunks[e]})),!i&&n||(o=n=1,n=this.getter(0).length,o=n,out("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=n,this._chunkSize=o,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest){if(!ENVIRONMENT_IS_WORKER)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var o=new i;Object.defineProperties(o,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var s={isDevice:!1,contents:o}}else s={isDevice:!1,url:r};var d=FS.createFile(e,t,s,n,a);s.contents?d.contents=s.contents:s.url&&(d.contents=null,d.url=s.url),Object.defineProperties(d,{usedBytes:{get:function(){return this.contents.length}}});var u={};function c(e,t,r,n,a){var i=e.node.contents;if(a>=i.length)return 0;var o=Math.min(i.length-a,n);if(i.slice)for(var s=0;s<o;s++)t[r+s]=i[a+s];else for(s=0;s<o;s++)t[r+s]=i.get(a+s);return o}return Object.keys(d.stream_ops).forEach((e=>{var t=d.stream_ops[e];u[e]=function(){return FS.forceLoadFile(d),t.apply(null,arguments)}})),u.read=(e,t,r,n,a)=>(FS.forceLoadFile(d),c(e,t,r,n,a)),u.mmap=(e,t,r,n,a)=>{FS.forceLoadFile(d);var i=mmapAlloc(t);if(!i)throw new FS.ErrnoError(48);return c(e,HEAP8,i,t,r),{ptr:i,allocated:!0}},d.stream_ops=u,d},createPreloadedFile:(e,t,r,n,a,i,o,s,d,u)=>{var c=t?PATH_FS.resolve(PATH.join2(e,t)):e,l=getUniqueRunDependency("cp "+c);function _(r){function _(r){u&&u(),s||FS.createDataFile(e,t,r,n,a,d),i&&i(),removeRunDependency(l)}Browser.handledByPreloadPlugin(r,c,_,(()=>{o&&o(),removeRunDependency(l)}))||_(r)}addRunDependency(l),"string"==typeof r?asyncLoad(r,(e=>_(e)),o):_(r)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(e,t,r)=>{t=t||(()=>{}),r=r||(()=>{});var n=FS.indexedDB();try{var a=n.open(FS.DB_NAME(),FS.DB_VERSION)}catch(i){return r(i)}a.onupgradeneeded=()=>{out("creating db"),a.result.createObjectStore(FS.DB_STORE_NAME)},a.onsuccess=()=>{var n=a.result.transaction([FS.DB_STORE_NAME],"readwrite"),i=n.objectStore(FS.DB_STORE_NAME),o=0,s=0,d=e.length;function u(){0==s?t():r()}e.forEach((e=>{var t=i.put(FS.analyzePath(e).object.contents,e);t.onsuccess=()=>{++o+s==d&&u()},t.onerror=()=>{s++,o+s==d&&u()}})),n.onerror=r},a.onerror=r},loadFilesFromDB:(e,t,r)=>{t=t||(()=>{}),r=r||(()=>{});var n=FS.indexedDB();try{var a=n.open(FS.DB_NAME(),FS.DB_VERSION)}catch(i){return r(i)}a.onupgradeneeded=r,a.onsuccess=()=>{var n=a.result;try{var o=n.transaction([FS.DB_STORE_NAME],"readonly")}catch(i){return void r(i)}var s=o.objectStore(FS.DB_STORE_NAME),d=0,u=0,c=e.length;function l(){0==u?t():r()}e.forEach((e=>{var t=s.get(e);t.onsuccess=()=>{FS.analyzePath(e).exists&&FS.unlink(e),FS.createDataFile(PATH.dirname(e),PATH.basename(e),t.result,!0,!0,!0),++d+u==c&&l()},t.onerror=()=>{u++,d+u==c&&l()}})),o.onerror=r},a.onerror=r}},SYSCALLS={DEFAULT_POLLMASK:5,calculateAt:function(e,t,r){if(PATH.isAbs(t))return t;var n;-100===e?n=FS.cwd():n=SYSCALLS.getStreamFromFD(e).path;if(0==t.length){if(!r)throw new FS.ErrnoError(44);return n}return PATH.join2(n,t)},doStat:function(e,t,r){try{var n=e(t)}catch(a){if(a&&a.node&&PATH.normalize(t)!==PATH.normalize(FS.getPath(a.node)))return-54;throw a}return HEAP32[r>>2]=n.dev,HEAP32[r+8>>2]=n.ino,HEAP32[r+12>>2]=n.mode,HEAPU32[r+16>>2]=n.nlink,HEAP32[r+20>>2]=n.uid,HEAP32[r+24>>2]=n.gid,HEAP32[r+28>>2]=n.rdev,tempI64=[n.size>>>0,(tempDouble=n.size,+Math.abs(tempDouble)>=1?tempDouble>0?(0|Math.min(+Math.floor(tempDouble/4294967296),4294967295))>>>0:~~+Math.ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[r+40>>2]=tempI64[0],HEAP32[r+44>>2]=tempI64[1],HEAP32[r+48>>2]=4096,HEAP32[r+52>>2]=n.blocks,tempI64=[Math.floor(n.atime.getTime()/1e3)>>>0,(tempDouble=Math.floor(n.atime.getTime()/1e3),+Math.abs(tempDouble)>=1?tempDouble>0?(0|Math.min(+Math.floor(tempDouble/4294967296),4294967295))>>>0:~~+Math.ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[r+56>>2]=tempI64[0],HEAP32[r+60>>2]=tempI64[1],HEAPU32[r+64>>2]=0,tempI64=[Math.floor(n.mtime.getTime()/1e3)>>>0,(tempDouble=Math.floor(n.mtime.getTime()/1e3),+Math.abs(tempDouble)>=1?tempDouble>0?(0|Math.min(+Math.floor(tempDouble/4294967296),4294967295))>>>0:~~+Math.ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[r+72>>2]=tempI64[0],HEAP32[r+76>>2]=tempI64[1],HEAPU32[r+80>>2]=0,tempI64=[Math.floor(n.ctime.getTime()/1e3)>>>0,(tempDouble=Math.floor(n.ctime.getTime()/1e3),+Math.abs(tempDouble)>=1?tempDouble>0?(0|Math.min(+Math.floor(tempDouble/4294967296),4294967295))>>>0:~~+Math.ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[r+88>>2]=tempI64[0],HEAP32[r+92>>2]=tempI64[1],HEAPU32[r+96>>2]=0,tempI64=[n.ino>>>0,(tempDouble=n.ino,+Math.abs(tempDouble)>=1?tempDouble>0?(0|Math.min(+Math.floor(tempDouble/4294967296),4294967295))>>>0:~~+Math.ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[r+104>>2]=tempI64[0],HEAP32[r+108>>2]=tempI64[1],0},doMsync:function(e,t,r,n,a){if(!FS.isFile(t.node.mode))throw new FS.ErrnoError(43);if(2&n)return 0;var i=HEAPU8.slice(e,e+r);FS.msync(t,i,a,r,n)},varargs:void 0,get:function(){return SYSCALLS.varargs+=4,HEAP32[SYSCALLS.varargs-4>>2]},getStr:function(e){return UTF8ToString(e)},getStreamFromFD:function(e){var t=FS.getStream(e);if(!t)throw new FS.ErrnoError(8);return t}};function ___syscall__newselect(e,t,r,n,a){try{for(var i=0,o=t?HEAP32[t>>2]:0,s=t?HEAP32[t+4>>2]:0,d=r?HEAP32[r>>2]:0,u=r?HEAP32[r+4>>2]:0,c=n?HEAP32[n>>2]:0,l=n?HEAP32[n+4>>2]:0,_=0,f=0,h=0,p=0,m=0,v=0,g=(t?HEAP32[t>>2]:0)|(r?HEAP32[r>>2]:0)|(n?HEAP32[n>>2]:0),y=(t?HEAP32[t+4>>2]:0)|(r?HEAP32[r+4>>2]:0)|(n?HEAP32[n+4>>2]:0),S=function(e,t,r,n){return e<32?t&n:r&n},E=0;E<e;E++){var b=1<<E%32;if(S(E,g,y,b)){var M=SYSCALLS.getStreamFromFD(E),A=SYSCALLS.DEFAULT_POLLMASK;M.stream_ops.poll&&(A=M.stream_ops.poll(M)),1&A&&S(E,o,s,b)&&(E<32?_|=b:f|=b,i++),4&A&&S(E,d,u,b)&&(E<32?h|=b:p|=b,i++),2&A&&S(E,c,l,b)&&(E<32?m|=b:v|=b,i++)}}return t&&(HEAP32[t>>2]=_,HEAP32[t+4>>2]=f),r&&(HEAP32[r>>2]=h,HEAP32[r+4>>2]=p),n&&(HEAP32[n>>2]=m,HEAP32[n+4>>2]=v),i}catch(w){if("undefined"==typeof FS||!(w instanceof FS.ErrnoError))throw w;return-w.errno}}var SOCKFS={mount:function(e){return Module.websocket=Module.websocket&&"object"===typeof Module.websocket?Module.websocket:{},Module.websocket._callbacks={},Module.websocket.on=function(e,t){return"function"===typeof t&&(this._callbacks[e]=t),this},Module.websocket.emit=function(e,t){"function"===typeof this._callbacks[e]&&this._callbacks[e].call(this,t)},FS.createNode(null,"/",16895,0)},createSocket:function(e,t,r){if(1==(t&=-526337)&&r&&6!=r)throw new FS.ErrnoError(66);var n={family:e,type:t,protocol:r,server:null,error:null,peers:{},pending:[],recv_queue:[],sock_ops:SOCKFS.websocket_sock_ops},a=SOCKFS.nextname(),i=FS.createNode(SOCKFS.root,a,49152,0);i.sock=n;var o=FS.createStream({path:a,node:i,flags:2,seekable:!1,stream_ops:SOCKFS.stream_ops});return n.stream=o,n},getSocket:function(e){var t=FS.getStream(e);return t&&FS.isSocket(t.node.mode)?t.node.sock:null},stream_ops:{poll:function(e){var t=e.node.sock;return t.sock_ops.poll(t)},ioctl:function(e,t,r){var n=e.node.sock;return n.sock_ops.ioctl(n,t,r)},read:function(e,t,r,n,a){var i=e.node.sock,o=i.sock_ops.recvmsg(i,n);return o?(t.set(o.buffer,r),o.buffer.length):0},write:function(e,t,r,n,a){var i=e.node.sock;return i.sock_ops.sendmsg(i,t,r,n)},close:function(e){var t=e.node.sock;t.sock_ops.close(t)}},nextname:function(){return SOCKFS.nextname.current||(SOCKFS.nextname.current=0),"socket["+SOCKFS.nextname.current+++"]"},websocket_sock_ops:{createPeer:function(e,t,r){var n;if("object"==typeof t&&(n=t,t=null,r=null),n)if(n._socket)t=n._socket.remoteAddress,r=n._socket.remotePort;else{var a=/ws[s]?:\/\/([^:]+):(\d+)/.exec(n.url);if(!a)throw new Error("WebSocket URL must be in the format ws(s)://address:port");t=a[1],r=parseInt(a[2],10)}else try{var i=Module.websocket&&"object"===typeof Module.websocket,o="ws:#".replace("#","//");if(i&&"string"===typeof Module.websocket.url&&(o=Module.websocket.url),"ws://"===o||"wss://"===o){var s=t.split("/");o=o+s[0]+":"+r+"/"+s.slice(1).join("/")}var d="binary";i&&"string"===typeof Module.websocket.subprotocol&&(d=Module.websocket.subprotocol);var u=void 0;"null"!==d&&(u=d=d.replace(/^ +| +$/g,"").split(/ *, */)),i&&null===Module.websocket.subprotocol&&(d="null",u=void 0),(n=new WebSocket(o,u)).binaryType="arraybuffer"}catch(l){throw new FS.ErrnoError(23)}var c={addr:t,port:r,socket:n,dgram_send_queue:[]};return SOCKFS.websocket_sock_ops.addPeer(e,c),SOCKFS.websocket_sock_ops.handlePeerEvents(e,c),2===e.type&&"undefined"!=typeof e.sport&&c.dgram_send_queue.push(new Uint8Array([255,255,255,255,"p".charCodeAt(0),"o".charCodeAt(0),"r".charCodeAt(0),"t".charCodeAt(0),(65280&e.sport)>>8,255&e.sport])),c},getPeer:function(e,t,r){return e.peers[t+":"+r]},addPeer:function(e,t){e.peers[t.addr+":"+t.port]=t},removePeer:function(e,t){delete e.peers[t.addr+":"+t.port]},handlePeerEvents:function(e,t){var r=!0,n=function(){Module.websocket.emit("open",e.stream.fd);try{for(var r=t.dgram_send_queue.shift();r;)t.socket.send(r),r=t.dgram_send_queue.shift()}catch(n){t.socket.close()}};function a(n){if("string"==typeof n){n=(new TextEncoder).encode(n)}else{if(assert(void 0!==n.byteLength),0==n.byteLength)return;n=new Uint8Array(n)}var a=r;if(r=!1,a&&10===n.length&&255===n[0]&&255===n[1]&&255===n[2]&&255===n[3]&&n[4]==="p".charCodeAt(0)&&n[5]==="o".charCodeAt(0)&&n[6]==="r".charCodeAt(0)&&n[7]==="t".charCodeAt(0)){var i=n[8]<<8|n[9];return SOCKFS.websocket_sock_ops.removePeer(e,t),t.port=i,void SOCKFS.websocket_sock_ops.addPeer(e,t)}e.recv_queue.push({addr:t.addr,port:t.port,data:n}),Module.websocket.emit("message",e.stream.fd)}ENVIRONMENT_IS_NODE?(t.socket.on("open",n),t.socket.on("message",(function(e,t){t&&a(new Uint8Array(e).buffer)})),t.socket.on("close",(function(){Module.websocket.emit("close",e.stream.fd)})),t.socket.on("error",(function(t){e.error=14,Module.websocket.emit("error",[e.stream.fd,e.error,"ECONNREFUSED: Connection refused"])}))):(t.socket.onopen=n,t.socket.onclose=function(){Module.websocket.emit("close",e.stream.fd)},t.socket.onmessage=function(e){a(e.data)},t.socket.onerror=function(t){e.error=14,Module.websocket.emit("error",[e.stream.fd,e.error,"ECONNREFUSED: Connection refused"])})},poll:function(e){if(1===e.type&&e.server)return e.pending.length?65:0;var t=0,r=1===e.type?SOCKFS.websocket_sock_ops.getPeer(e,e.daddr,e.dport):null;return(e.recv_queue.length||!r||r&&r.socket.readyState===r.socket.CLOSING||r&&r.socket.readyState===r.socket.CLOSED)&&(t|=65),(!r||r&&r.socket.readyState===r.socket.OPEN)&&(t|=4),(r&&r.socket.readyState===r.socket.CLOSING||r&&r.socket.readyState===r.socket.CLOSED)&&(t|=16),t},ioctl:function(e,t,r){if(21531===t){var n=0;return e.recv_queue.length&&(n=e.recv_queue[0].data.length),HEAP32[r>>2]=n,0}return 28},close:function(e){if(e.server){try{e.server.close()}catch(a){}e.server=null}for(var t=Object.keys(e.peers),r=0;r<t.length;r++){var n=e.peers[t[r]];try{n.socket.close()}catch(a){}SOCKFS.websocket_sock_ops.removePeer(e,n)}return 0},bind:function(e,t,r){if("undefined"!=typeof e.saddr||"undefined"!=typeof e.sport)throw new FS.ErrnoError(28);if(e.saddr=t,e.sport=r,2===e.type){e.server&&(e.server.close(),e.server=null);try{e.sock_ops.listen(e,0)}catch(n){if(!(n instanceof FS.ErrnoError))throw n;if(138!==n.errno)throw n}}},connect:function(e,t,r){if(e.server)throw new FS.ErrnoError(138);if("undefined"!=typeof e.daddr&&"undefined"!=typeof e.dport){var n=SOCKFS.websocket_sock_ops.getPeer(e,e.daddr,e.dport);if(n)throw n.socket.readyState===n.socket.CONNECTING?new FS.ErrnoError(7):new FS.ErrnoError(30)}var a=SOCKFS.websocket_sock_ops.createPeer(e,t,r);throw e.daddr=a.addr,e.dport=a.port,new FS.ErrnoError(26)},listen:function(e,t){if(!ENVIRONMENT_IS_NODE)throw new FS.ErrnoError(138)},accept:function(e){if(!e.server||!e.pending.length)throw new FS.ErrnoError(28);var t=e.pending.shift();return t.stream.flags=e.stream.flags,t},getname:function(e,t){var r,n;if(t){if(void 0===e.daddr||void 0===e.dport)throw new FS.ErrnoError(53);r=e.daddr,n=e.dport}else r=e.saddr||0,n=e.sport||0;return{addr:r,port:n}},sendmsg:function(e,t,r,n,a,i){if(2===e.type){if(void 0!==a&&void 0!==i||(a=e.daddr,i=e.dport),void 0===a||void 0===i)throw new FS.ErrnoError(17)}else a=e.daddr,i=e.dport;var o,s=SOCKFS.websocket_sock_ops.getPeer(e,a,i);if(1===e.type){if(!s||s.socket.readyState===s.socket.CLOSING||s.socket.readyState===s.socket.CLOSED)throw new FS.ErrnoError(53);if(s.socket.readyState===s.socket.CONNECTING)throw new FS.ErrnoError(6)}if(ArrayBuffer.isView(t)&&(r+=t.byteOffset,t=t.buffer),o=t.slice(r,r+n),2===e.type&&(!s||s.socket.readyState!==s.socket.OPEN))return s&&s.socket.readyState!==s.socket.CLOSING&&s.socket.readyState!==s.socket.CLOSED||(s=SOCKFS.websocket_sock_ops.createPeer(e,a,i)),s.dgram_send_queue.push(o),n;try{return s.socket.send(o),n}catch(d){throw new FS.ErrnoError(28)}},recvmsg:function(e,t){if(1===e.type&&e.server)throw new FS.ErrnoError(53);var r=e.recv_queue.shift();if(!r){if(1===e.type){var n=SOCKFS.websocket_sock_ops.getPeer(e,e.daddr,e.dport);if(!n)throw new FS.ErrnoError(53);if(n.socket.readyState===n.socket.CLOSING||n.socket.readyState===n.socket.CLOSED)return null;throw new FS.ErrnoError(6)}throw new FS.ErrnoError(6)}var a=r.data.byteLength||r.data.length,i=r.data.byteOffset||0,o=r.data.buffer||r.data,s=Math.min(t,a),d={buffer:new Uint8Array(o,i,s),addr:r.addr,port:r.port};if(1===e.type&&s<a){var u=a-s;r.data=new Uint8Array(o,i+s,u),e.recv_queue.unshift(r)}return d}}};function getSocketFromFD(e){var t=SOCKFS.getSocket(e);if(!t)throw new FS.ErrnoError(8);return t}function setErrNo(e){return HEAP32[___errno_location()>>2]=e,e}function inetNtop4(e){return(255&e)+"."+(e>>8&255)+"."+(e>>16&255)+"."+(e>>24&255)}function inetNtop6(e){var t="",r=0,n=0,a=0,i=0,o=0,s=0,d=[65535&e[0],e[0]>>16,65535&e[1],e[1]>>16,65535&e[2],e[2]>>16,65535&e[3],e[3]>>16],u=!0,c="";for(s=0;s<5;s++)if(0!==d[s]){u=!1;break}if(u){if(c=inetNtop4(d[6]|d[7]<<16),-1===d[5])return t="::ffff:",t+=c;if(0===d[5])return t="::","0.0.0.0"===c&&(c=""),"0.0.0.1"===c&&(c="1"),t+=c}for(r=0;r<8;r++)0===d[r]&&(r-a>1&&(o=0),a=r,o++),o>n&&(i=r-(n=o)+1);for(r=0;r<8;r++)n>1&&0===d[r]&&r>=i&&r<i+n?r===i&&(t+=":",0===i&&(t+=":")):(t+=Number(_ntohs(65535&d[r])).toString(16),t+=r<7?":":"");return t}function readSockaddr(e,t){var r,n=HEAP16[e>>1],a=_ntohs(HEAPU16[e+2>>1]);switch(n){case 2:if(16!==t)return{errno:28};r=inetNtop4(r=HEAP32[e+4>>2]);break;case 10:if(28!==t)return{errno:28};r=inetNtop6(r=[HEAP32[e+8>>2],HEAP32[e+12>>2],HEAP32[e+16>>2],HEAP32[e+20>>2]]);break;default:return{errno:5}}return{family:n,addr:r,port:a}}function inetPton4(e){for(var t=e.split("."),r=0;r<4;r++){var n=Number(t[r]);if(isNaN(n))return null;t[r]=n}return(t[0]|t[1]<<8|t[2]<<16|t[3]<<24)>>>0}function jstoi_q(e){return parseInt(e)}function inetPton6(e){var t,r,n,a,i=[];if(!/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i.test(e))return null;if("::"===e)return[0,0,0,0,0,0,0,0];for((e=e.startsWith("::")?e.replace("::","Z:"):e.replace("::",":Z:")).indexOf(".")>0?((t=(e=e.replace(new RegExp("[.]","g"),":")).split(":"))[t.length-4]=jstoi_q(t[t.length-4])+256*jstoi_q(t[t.length-3]),t[t.length-3]=jstoi_q(t[t.length-2])+256*jstoi_q(t[t.length-1]),t=t.slice(0,t.length-2)):t=e.split(":"),n=0,a=0,r=0;r<t.length;r++)if("string"==typeof t[r])if("Z"===t[r]){for(a=0;a<8-t.length+1;a++)i[r+a]=0;n=a-1}else i[r+n]=_htons(parseInt(t[r],16));else i[r+n]=t[r];return[i[1]<<16|i[0],i[3]<<16|i[2],i[5]<<16|i[4],i[7]<<16|i[6]]}var DNS={address_map:{id:1,addrs:{},names:{}},lookup_name:function(e){var t,r=inetPton4(e);if(null!==r)return e;if(null!==(r=inetPton6(e)))return e;if(DNS.address_map.addrs[e])t=DNS.address_map.addrs[e];else{var n=DNS.address_map.id++;assert(n<65535,"exceeded max address mappings of 65535"),t="172.29."+(255&n)+"."+(65280&n),DNS.address_map.names[t]=e,DNS.address_map.addrs[e]=t}return t},lookup_addr:function(e){return DNS.address_map.names[e]?DNS.address_map.names[e]:null}};function getSocketAddress(e,t,r){if(r&&0===e)return null;var n=readSockaddr(e,t);if(n.errno)throw new FS.ErrnoError(n.errno);return n.addr=DNS.lookup_addr(n.addr)||n.addr,n}function ___syscall_connect(e,t,r){try{var n=getSocketFromFD(e),a=getSocketAddress(t,r);return n.sock_ops.connect(n,a.addr,a.port),0}catch(i){if("undefined"==typeof FS||!(i instanceof FS.ErrnoError))throw i;return-i.errno}}function ___syscall_fcntl64(e,t,r){SYSCALLS.varargs=r;try{var n=SYSCALLS.getStreamFromFD(e);switch(t){case 0:return(a=SYSCALLS.get())<0?-28:FS.createStream(n,a).fd;case 1:case 2:case 6:case 7:return 0;case 3:return n.flags;case 4:var a=SYSCALLS.get();return n.flags|=a,0;case 5:a=SYSCALLS.get();return HEAP16[a+0>>1]=2,0;case 16:case 8:default:return-28;case 9:return setErrNo(28),-1}}catch(i){if("undefined"==typeof FS||!(i instanceof FS.ErrnoError))throw i;return-i.errno}}function ___syscall_fstat64(e,t){try{var r=SYSCALLS.getStreamFromFD(e);return SYSCALLS.doStat(FS.stat,r.path,t)}catch(n){if("undefined"==typeof FS||!(n instanceof FS.ErrnoError))throw n;return-n.errno}}function ___syscall_getcwd(e,t){try{if(0===t)return-28;var r=FS.cwd(),n=lengthBytesUTF8(r)+1;return t<n?-68:(stringToUTF8(r,e,t),n)}catch(a){if("undefined"==typeof FS||!(a instanceof FS.ErrnoError))throw a;return-a.errno}}function ___syscall_ioctl(e,t,r){SYSCALLS.varargs=r;try{var n=SYSCALLS.getStreamFromFD(e);switch(t){case 21509:case 21505:case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:case 21523:case 21524:return n.tty?0:-59;case 21519:if(!n.tty)return-59;var a=SYSCALLS.get();return HEAP32[a>>2]=0,0;case 21520:return n.tty?-28:-59;case 21531:a=SYSCALLS.get();return FS.ioctl(n,t,a);default:return-28}}catch(i){if("undefined"==typeof FS||!(i instanceof FS.ErrnoError))throw i;return-i.errno}}function ___syscall_lstat64(e,t){try{return e=SYSCALLS.getStr(e),SYSCALLS.doStat(FS.lstat,e,t)}catch(r){if("undefined"==typeof FS||!(r instanceof FS.ErrnoError))throw r;return-r.errno}}function ___syscall_mkdirat(e,t,r){try{return t=SYSCALLS.getStr(t),t=SYSCALLS.calculateAt(e,t),"/"===(t=PATH.normalize(t))[t.length-1]&&(t=t.substr(0,t.length-1)),FS.mkdir(t,r,0),0}catch(n){if("undefined"==typeof FS||!(n instanceof FS.ErrnoError))throw n;return-n.errno}}function ___syscall_newfstatat(e,t,r,n){try{t=SYSCALLS.getStr(t);var a=256&n,i=4096&n;return n&=-6401,t=SYSCALLS.calculateAt(e,t,i),SYSCALLS.doStat(a?FS.lstat:FS.stat,t,r)}catch(o){if("undefined"==typeof FS||!(o instanceof FS.ErrnoError))throw o;return-o.errno}}function ___syscall_openat(e,t,r,n){SYSCALLS.varargs=n;try{t=SYSCALLS.getStr(t),t=SYSCALLS.calculateAt(e,t);var a=n?SYSCALLS.get():0;return FS.open(t,r,a).fd}catch(i){if("undefined"==typeof FS||!(i instanceof FS.ErrnoError))throw i;return-i.errno}}var PIPEFS={BUCKET_BUFFER_SIZE:8192,mount:function(e){return FS.createNode(null,"/",16895,0)},createPipe:function(){var e={buckets:[],refcnt:2};e.buckets.push({buffer:new Uint8Array(PIPEFS.BUCKET_BUFFER_SIZE),offset:0,roffset:0});var t=PIPEFS.nextname(),r=PIPEFS.nextname(),n=FS.createNode(PIPEFS.root,t,4096,0),a=FS.createNode(PIPEFS.root,r,4096,0);n.pipe=e,a.pipe=e;var i=FS.createStream({path:t,node:n,flags:0,seekable:!1,stream_ops:PIPEFS.stream_ops});n.stream=i;var o=FS.createStream({path:r,node:a,flags:1,seekable:!1,stream_ops:PIPEFS.stream_ops});return a.stream=o,{readable_fd:i.fd,writable_fd:o.fd}},stream_ops:{poll:function(e){var t=e.node.pipe;if(1===(2097155&e.flags))return 260;if(t.buckets.length>0)for(var r=0;r<t.buckets.length;r++){var n=t.buckets[r];if(n.offset-n.roffset>0)return 65}return 0},ioctl:function(e,t,r){return 28},fsync:function(e){return 28},read:function(e,t,r,n,a){for(var i=e.node.pipe,o=0,s=0;s<i.buckets.length;s++){var d=i.buckets[s];o+=d.offset-d.roffset}assert(t instanceof ArrayBuffer||ArrayBuffer.isView(t));var u=t.subarray(r,r+n);if(n<=0)return 0;if(0==o)throw new FS.ErrnoError(6);var c=Math.min(o,n),l=c,_=0;for(s=0;s<i.buckets.length;s++){var f=i.buckets[s],h=f.offset-f.roffset;if(c<=h){var p=f.buffer.subarray(f.roffset,f.offset);c<h?(p=p.subarray(0,c),f.roffset+=c):_++,u.set(p);break}p=f.buffer.subarray(f.roffset,f.offset);u.set(p),u=u.subarray(p.byteLength),c-=p.byteLength,_++}return _&&_==i.buckets.length&&(_--,i.buckets[_].offset=0,i.buckets[_].roffset=0),i.buckets.splice(0,_),l},write:function(e,t,r,n,a){var i=e.node.pipe;assert(t instanceof ArrayBuffer||ArrayBuffer.isView(t));var o=t.subarray(r,r+n),s=o.byteLength;if(s<=0)return 0;var d=null;0==i.buckets.length?(d={buffer:new Uint8Array(PIPEFS.BUCKET_BUFFER_SIZE),offset:0,roffset:0},i.buckets.push(d)):d=i.buckets[i.buckets.length-1],assert(d.offset<=PIPEFS.BUCKET_BUFFER_SIZE);var u=PIPEFS.BUCKET_BUFFER_SIZE-d.offset;if(u>=s)return d.buffer.set(o,d.offset),d.offset+=s,s;u>0&&(d.buffer.set(o.subarray(0,u),d.offset),d.offset+=u,o=o.subarray(u,o.byteLength));for(var c=o.byteLength/PIPEFS.BUCKET_BUFFER_SIZE|0,l=o.byteLength%PIPEFS.BUCKET_BUFFER_SIZE,_=0;_<c;_++){var f={buffer:new Uint8Array(PIPEFS.BUCKET_BUFFER_SIZE),offset:PIPEFS.BUCKET_BUFFER_SIZE,roffset:0};i.buckets.push(f),f.buffer.set(o.subarray(0,PIPEFS.BUCKET_BUFFER_SIZE)),o=o.subarray(PIPEFS.BUCKET_BUFFER_SIZE,o.byteLength)}if(l>0){f={buffer:new Uint8Array(PIPEFS.BUCKET_BUFFER_SIZE),offset:o.byteLength,roffset:0};i.buckets.push(f),f.buffer.set(o)}return s},close:function(e){var t=e.node.pipe;t.refcnt--,0===t.refcnt&&(t.buckets=null)}},nextname:function(){return PIPEFS.nextname.current||(PIPEFS.nextname.current=0),"pipe["+PIPEFS.nextname.current+++"]"}};function ___syscall_pipe(e){try{if(0==e)throw new FS.ErrnoError(21);var t=PIPEFS.createPipe();return HEAP32[e>>2]=t.readable_fd,HEAP32[e+4>>2]=t.writable_fd,0}catch(r){if("undefined"==typeof FS||!(r instanceof FS.ErrnoError))throw r;return-r.errno}}function ___syscall_poll(e,t,r){try{for(var n=0,a=0;a<t;a++){var i=e+8*a,o=HEAP32[i>>2],s=HEAP16[i+4>>1],d=32,u=FS.getStream(o);u&&(d=SYSCALLS.DEFAULT_POLLMASK,u.stream_ops.poll&&(d=u.stream_ops.poll(u))),(d&=24|s)&&n++,HEAP16[i+6>>1]=d}return n}catch(c){if("undefined"==typeof FS||!(c instanceof FS.ErrnoError))throw c;return-c.errno}}function ___syscall_socket(e,t,r){try{return SOCKFS.createSocket(e,t,r).stream.fd}catch(n){if("undefined"==typeof FS||!(n instanceof FS.ErrnoError))throw n;return-n.errno}}function ___syscall_stat64(e,t){try{return e=SYSCALLS.getStr(e),SYSCALLS.doStat(FS.stat,e,t)}catch(r){if("undefined"==typeof FS||!(r instanceof FS.ErrnoError))throw r;return-r.errno}}var nowIsMonotonic=!0;function __emscripten_get_now_is_monotonic(){return nowIsMonotonic}function readI53FromI64(e){return HEAPU32[e>>2]+4294967296*HEAP32[e+4>>2]}function __gmtime_js(e,t){var r=new Date(1e3*readI53FromI64(e));HEAP32[t>>2]=r.getUTCSeconds(),HEAP32[t+4>>2]=r.getUTCMinutes(),HEAP32[t+8>>2]=r.getUTCHours(),HEAP32[t+12>>2]=r.getUTCDate(),HEAP32[t+16>>2]=r.getUTCMonth(),HEAP32[t+20>>2]=r.getUTCFullYear()-1900,HEAP32[t+24>>2]=r.getUTCDay();var n=Date.UTC(r.getUTCFullYear(),0,1,0,0,0,0),a=(r.getTime()-n)/864e5|0;HEAP32[t+28>>2]=a}function __isLeapYear(e){return e%4===0&&(e%100!==0||e%400===0)}var __MONTH_DAYS_LEAP_CUMULATIVE=[0,31,60,91,121,152,182,213,244,274,305,335],__MONTH_DAYS_REGULAR_CUMULATIVE=[0,31,59,90,120,151,181,212,243,273,304,334];function __yday_from_date(e){return(__isLeapYear(e.getFullYear())?__MONTH_DAYS_LEAP_CUMULATIVE:__MONTH_DAYS_REGULAR_CUMULATIVE)[e.getMonth()]+e.getDate()-1}function __localtime_js(e,t){var r=new Date(1e3*readI53FromI64(e));HEAP32[t>>2]=r.getSeconds(),HEAP32[t+4>>2]=r.getMinutes(),HEAP32[t+8>>2]=r.getHours(),HEAP32[t+12>>2]=r.getDate(),HEAP32[t+16>>2]=r.getMonth(),HEAP32[t+20>>2]=r.getFullYear()-1900,HEAP32[t+24>>2]=r.getDay();var n=0|__yday_from_date(r);HEAP32[t+28>>2]=n,HEAP32[t+36>>2]=-60*r.getTimezoneOffset();var a=new Date(r.getFullYear(),0,1),i=new Date(r.getFullYear(),6,1).getTimezoneOffset(),o=a.getTimezoneOffset(),s=0|(i!=o&&r.getTimezoneOffset()==Math.min(o,i));HEAP32[t+32>>2]=s}function allocateUTF8(e){var t=lengthBytesUTF8(e)+1,r=_malloc(t);return r&&stringToUTF8Array(e,HEAP8,r,t),r}function __tzset_js(e,t,r){var n=(new Date).getFullYear(),a=new Date(n,0,1),i=new Date(n,6,1),o=a.getTimezoneOffset(),s=i.getTimezoneOffset(),d=Math.max(o,s);function u(e){var t=e.toTimeString().match(/\(([A-Za-z ]+)\)$/);return t?t[1]:"GMT"}HEAPU32[e>>2]=60*d,HEAP32[t>>2]=Number(o!=s);var c=u(a),l=u(i),_=allocateUTF8(c),f=allocateUTF8(l);s<o?(HEAPU32[r>>2]=_,HEAPU32[r+4>>2]=f):(HEAPU32[r>>2]=f,HEAPU32[r+4>>2]=_)}function _abort(){abort("")}var _emscripten_get_now,readEmAsmArgsArray=[];function readEmAsmArgs(e,t){var r;for(readEmAsmArgsArray.length=0,t>>=2;r=HEAPU8[e++];)t+=105!=r&t,readEmAsmArgsArray.push(105==r?HEAP32[t]:HEAPF64[t++>>1]),++t;return readEmAsmArgsArray}function runEmAsmFunction(e,t,r){var n=readEmAsmArgs(t,r);return ASM_CONSTS[e].apply(null,n)}function _emscripten_asm_const_int(e,t,r){return runEmAsmFunction(e,t,r)}function _emscripten_date_now(){return Date.now()}function _emscripten_memcpy_big(e,t,r){HEAPU8.copyWithin(e,t,t+r)}function getHeapMax(){return 2147483648}function emscripten_realloc_buffer(e){try{return wasmMemory.grow(e-buffer.byteLength+65535>>>16),updateGlobalBufferAndViews(wasmMemory.buffer),1}catch(t){}}function _emscripten_resize_heap(e){var t=HEAPU8.length;e>>>=0;var r=getHeapMax();if(e>r)return!1;for(var n=1;n<=4;n*=2){var a=t*(1+.2/n);if(a=Math.min(a,e+100663296),emscripten_realloc_buffer(Math.min(r,(i=Math.max(e,a))+((o=65536)-i%o)%o)))return!0}var i,o;return!1}_emscripten_get_now=()=>performance.now();var ENV={};function getExecutableName(){return thisProgram||"./this.program"}function getEnvStrings(){if(!getEnvStrings.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:getExecutableName()};for(var t in ENV)void 0===ENV[t]?delete e[t]:e[t]=ENV[t];var r=[];for(var t in e)r.push(t+"="+e[t]);getEnvStrings.strings=r}return getEnvStrings.strings}function writeAsciiToMemory(e,t,r){for(var n=0;n<e.length;++n)HEAP8[t++>>0]=e.charCodeAt(n);r||(HEAP8[t>>0]=0)}function _environ_get(e,t){var r=0;return getEnvStrings().forEach((function(n,a){var i=t+r;HEAPU32[e+4*a>>2]=i,writeAsciiToMemory(n,i),r+=n.length+1})),0}function _environ_sizes_get(e,t){var r=getEnvStrings();HEAPU32[e>>2]=r.length;var n=0;return r.forEach((function(e){n+=e.length+1})),HEAPU32[t>>2]=n,0}function _fd_close(e){try{var t=SYSCALLS.getStreamFromFD(e);return FS.close(t),0}catch(r){if("undefined"==typeof FS||!(r instanceof FS.ErrnoError))throw r;return r.errno}}function doReadv(e,t,r,n){for(var a=0,i=0;i<r;i++){var o=HEAPU32[t>>2],s=HEAPU32[t+4>>2];t+=8;var d=FS.read(e,HEAP8,o,s,n);if(d<0)return-1;if(a+=d,d<s)break}return a}function _fd_read(e,t,r,n){try{var a=doReadv(SYSCALLS.getStreamFromFD(e),t,r);return HEAPU32[n>>2]=a,0}catch(i){if("undefined"==typeof FS||!(i instanceof FS.ErrnoError))throw i;return i.errno}}function convertI32PairToI53Checked(e,t){return t+2097152>>>0<4194305-!!e?(e>>>0)+4294967296*t:NaN}function _fd_seek(e,t,r,n,a){try{var i=convertI32PairToI53Checked(t,r);if(isNaN(i))return 61;var o=SYSCALLS.getStreamFromFD(e);return FS.llseek(o,i,n),tempI64=[o.position>>>0,(tempDouble=o.position,+Math.abs(tempDouble)>=1?tempDouble>0?(0|Math.min(+Math.floor(tempDouble/4294967296),4294967295))>>>0:~~+Math.ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[a>>2]=tempI64[0],HEAP32[a+4>>2]=tempI64[1],o.getdents&&0===i&&0===n&&(o.getdents=null),0}catch(s){if("undefined"==typeof FS||!(s instanceof FS.ErrnoError))throw s;return s.errno}}function doWritev(e,t,r,n){for(var a=0,i=0;i<r;i++){var o=HEAPU32[t>>2],s=HEAPU32[t+4>>2];t+=8;var d=FS.write(e,HEAP8,o,s,n);if(d<0)return-1;a+=d}return a}function _fd_write(e,t,r,n){try{var a=doWritev(SYSCALLS.getStreamFromFD(e),t,r);return HEAPU32[n>>2]=a,0}catch(i){if("undefined"==typeof FS||!(i instanceof FS.ErrnoError))throw i;return i.errno}}function __arraySum(e,t){for(var r=0,n=0;n<=t;r+=e[n++]);return r}var __MONTH_DAYS_LEAP=[31,29,31,30,31,30,31,31,30,31,30,31],__MONTH_DAYS_REGULAR=[31,28,31,30,31,30,31,31,30,31,30,31];function __addDays(e,t){for(var r=new Date(e.getTime());t>0;){var n=__isLeapYear(r.getFullYear()),a=r.getMonth(),i=(n?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR)[a];if(!(t>i-r.getDate()))return r.setDate(r.getDate()+t),r;t-=i-r.getDate()+1,r.setDate(1),a<11?r.setMonth(a+1):(r.setMonth(0),r.setFullYear(r.getFullYear()+1))}return r}function writeArrayToMemory(e,t){HEAP8.set(e,t)}function _strftime(e,t,r,n){var a=HEAP32[n+40>>2],i={tm_sec:HEAP32[n>>2],tm_min:HEAP32[n+4>>2],tm_hour:HEAP32[n+8>>2],tm_mday:HEAP32[n+12>>2],tm_mon:HEAP32[n+16>>2],tm_year:HEAP32[n+20>>2],tm_wday:HEAP32[n+24>>2],tm_yday:HEAP32[n+28>>2],tm_isdst:HEAP32[n+32>>2],tm_gmtoff:HEAP32[n+36>>2],tm_zone:a?UTF8ToString(a):""},o=UTF8ToString(r),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var d in s)o=o.replace(new RegExp(d,"g"),s[d]);var u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],c=["January","February","March","April","May","June","July","August","September","October","November","December"];function l(e,t,r){for(var n="number"==typeof e?e.toString():e||"";n.length<t;)n=r[0]+n;return n}function _(e,t){return l(e,t,"0")}function f(e,t){function r(e){return e<0?-1:e>0?1:0}var n;return 0===(n=r(e.getFullYear()-t.getFullYear()))&&0===(n=r(e.getMonth()-t.getMonth()))&&(n=r(e.getDate()-t.getDate())),n}function h(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function p(e){var t=__addDays(new Date(e.tm_year+1900,0,1),e.tm_yday),r=new Date(t.getFullYear(),0,4),n=new Date(t.getFullYear()+1,0,4),a=h(r),i=h(n);return f(a,t)<=0?f(i,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var m={"%a":function(e){return u[e.tm_wday].substring(0,3)},"%A":function(e){return u[e.tm_wday]},"%b":function(e){return c[e.tm_mon].substring(0,3)},"%B":function(e){return c[e.tm_mon]},"%C":function(e){return _((e.tm_year+1900)/100|0,2)},"%d":function(e){return _(e.tm_mday,2)},"%e":function(e){return l(e.tm_mday,2," ")},"%g":function(e){return p(e).toString().substring(2)},"%G":function(e){return p(e)},"%H":function(e){return _(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),_(t,2)},"%j":function(e){return _(e.tm_mday+__arraySum(__isLeapYear(e.tm_year+1900)?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR,e.tm_mon-1),3)},"%m":function(e){return _(e.tm_mon+1,2)},"%M":function(e){return _(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return _(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=e.tm_yday+7-e.tm_wday;return _(Math.floor(t/7),2)},"%V":function(e){var t=Math.floor((e.tm_yday+7-(e.tm_wday+6)%7)/7);if((e.tm_wday+371-e.tm_yday-2)%7<=2&&t++,t){if(53==t){var r=(e.tm_wday+371-e.tm_yday)%7;4==r||3==r&&__isLeapYear(e.tm_year)||(t=1)}}else{t=52;var n=(e.tm_wday+7-e.tm_yday-1)%7;(4==n||5==n&&__isLeapYear(e.tm_year%400-1))&&t++}return _(t,2)},"%w":function(e){return e.tm_wday},"%W":function(e){var t=e.tm_yday+7-(e.tm_wday+6)%7;return _(Math.floor(t/7),2)},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,r=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(r?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var d in o=o.replace(/%%/g,"\0\0"),m)o.includes(d)&&(o=o.replace(new RegExp(d,"g"),m[d](i)));var v=intArrayFromString(o=o.replace(/\0\0/g,"%"),!1);return v.length>t?0:(writeArrayToMemory(v,e),v.length-1)}function _strftime_l(e,t,r,n,a){return _strftime(e,t,r,n)}function _zlt_tfjs_execute_afn(e,t,r,n,a){return execute_afn(e,t,r,n,a)}function _zlt_tfjs_execute_base_cls(e,t,r,n){return execute_base(e,t,r,n)}async function _zlt_tfjs_init(){}function _zoom_wcl_get_cpu_num(){return hardcodecpunumber()}function _zoom_wcl_get_csc_thread_num(){return 1}function _zoom_wcl_support_multi_thread(){return IsSupportMultiThread()}function getCFunc(e){return Module["_"+e]}function ccall(e,t,r,n,a){var i={string:e=>{var t=0;if(null!==e&&void 0!==e&&0!==e){var r=1+(e.length<<2);stringToUTF8(e,t=stackAlloc(r),r)}return t},array:e=>{var t=stackAlloc(e.length);return writeArrayToMemory(e,t),t}};var o=getCFunc(e),s=[],d=0;if(n)for(var u=0;u<n.length;u++){var c=i[r[u]];c?(0===d&&(d=stackSave()),s[u]=c(n[u])):s[u]=n[u]}var l=o.apply(null,s);return l=function(e){return 0!==d&&stackRestore(d),function(e){return"string"===t?UTF8ToString(e):"boolean"===t?Boolean(e):e}(e)}(l)}function cwrap(e,t,r,n){var a=(r=r||[]).every((e=>"number"===e||"boolean"===e));return"string"!==t&&a&&!n?getCFunc(e):function(){return ccall(e,t,r,arguments,n)}}var FSNode=function(e,t,r,n){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=FS.nextInode++,this.name=t,this.mode=r,this.node_ops={},this.stream_ops={},this.rdev=n},readMode=365,writeMode=146;Object.defineProperties(FSNode.prototype,{read:{get:function(){return(this.mode&readMode)===readMode},set:function(e){e?this.mode|=readMode:this.mode&=~readMode}},write:{get:function(){return(this.mode&writeMode)===writeMode},set:function(e){e?this.mode|=writeMode:this.mode&=~writeMode}},isFolder:{get:function(){return FS.isDir(this.mode)}},isDevice:{get:function(){return FS.isChrdev(this.mode)}}}),FS.FSNode=FSNode,FS.staticInit();var calledRun,asmLibraryArg={AdapterWhiteListCheck:_AdapterWhiteListCheck,CloseVideoEncoder:_CloseVideoEncoder,CreateGltPlatform:_CreateGltPlatform,DestroyGltPlatform:_DestroyGltPlatform,GetEncoderState:_GetEncoderState,GetLogLevel:_GetLogLevel,InitVideoDecoder:_InitVideoDecoder,InitVideoEncoder:_InitVideoEncoder,LimitWebCodecsEncoderTo360:_LimitWebCodecsEncoderTo360,Set_Share_Mode:_Set_Share_Mode,UserAgentIsTesla:_UserAgentIsTesla,VideoDecoder:_VideoDecoder,VideoDecoderConfigure:_VideoDecoderConfigure,VideoEncoderConfigure:_VideoEncoderConfigure,WebCodecsVideoEncoder:_WebCodecsVideoEncoder,_ZN11cpt_generic6thread4joinEv:__ZN11cpt_generic6thread4joinEv,_ZN11cpt_generic6threadD1Ev:__ZN11cpt_generic6threadD1Ev,_ZN5Nydus16CWCLWallRenderer14CreateInstanceEPvRKNS_9NydusRectEPPNS_13IWallRendererE:__ZN5Nydus16CWCLWallRenderer14CreateInstanceEPvRKNS_9NydusRectEPPNS_13IWallRendererE,__assert_fail:___assert_fail,__cxa_allocate_exception:___cxa_allocate_exception,__cxa_throw:___cxa_throw,__syscall__newselect:___syscall__newselect,__syscall_connect:___syscall_connect,__syscall_fcntl64:___syscall_fcntl64,__syscall_fstat64:___syscall_fstat64,__syscall_getcwd:___syscall_getcwd,__syscall_ioctl:___syscall_ioctl,__syscall_lstat64:___syscall_lstat64,__syscall_mkdirat:___syscall_mkdirat,__syscall_newfstatat:___syscall_newfstatat,__syscall_openat:___syscall_openat,__syscall_pipe:___syscall_pipe,__syscall_poll:___syscall_poll,__syscall_socket:___syscall_socket,__syscall_stat64:___syscall_stat64,_emscripten_get_now_is_monotonic:__emscripten_get_now_is_monotonic,_gmtime_js:__gmtime_js,_localtime_js:__localtime_js,_tzset_js:__tzset_js,abort:_abort,emscripten_asm_const_int:_emscripten_asm_const_int,emscripten_date_now:_emscripten_date_now,emscripten_get_now:_emscripten_get_now,emscripten_memcpy_big:_emscripten_memcpy_big,emscripten_resize_heap:_emscripten_resize_heap,environ_get:_environ_get,environ_sizes_get:_environ_sizes_get,fd_close:_fd_close,fd_read:_fd_read,fd_seek:_fd_seek,fd_write:_fd_write,strftime:_strftime,strftime_l:_strftime_l,zlt_tfjs_execute_afn:_zlt_tfjs_execute_afn,zlt_tfjs_execute_base_cls:_zlt_tfjs_execute_base_cls,zlt_tfjs_init:_zlt_tfjs_init,zoom_wcl_get_cpu_num:_zoom_wcl_get_cpu_num,zoom_wcl_get_csc_thread_num:_zoom_wcl_get_csc_thread_num,zoom_wcl_support_multi_thread:_zoom_wcl_support_multi_thread},asm=createWasm(),___wasm_call_ctors=Module.___wasm_call_ctors=function(){return(___wasm_call_ctors=Module.___wasm_call_ctors=Module.asm.__wasm_call_ctors).apply(null,arguments)},_malloc=Module._malloc=function(){return(_malloc=Module._malloc=Module.asm.malloc).apply(null,arguments)},__Video_Init=Module.__Video_Init=function(){return(__Video_Init=Module.__Video_Init=Module.asm._Video_Init).apply(null,arguments)},__Video_UnInit=Module.__Video_UnInit=function(){return(__Video_UnInit=Module.__Video_UnInit=Module.asm._Video_UnInit).apply(null,arguments)},__Video_Decode=Module.__Video_Decode=function(){return(__Video_Decode=Module.__Video_Decode=Module.asm._Video_Decode).apply(null,arguments)},__Change_Connect_Type=Module.__Change_Connect_Type=function(){return(__Change_Connect_Type=Module.__Change_Connect_Type=Module.asm._Change_Connect_Type).apply(null,arguments)},__Smooth_Send_For_Qos=Module.__Smooth_Send_For_Qos=function(){return(__Smooth_Send_For_Qos=Module.__Smooth_Send_For_Qos=Module.asm._Smooth_Send_For_Qos).apply(null,arguments)},__Video_Try_Analysis=Module.__Video_Try_Analysis=function(){return(__Video_Try_Analysis=Module.__Video_Try_Analysis=Module.asm._Video_Try_Analysis).apply(null,arguments)},__Video_Encode=Module.__Video_Encode=function(){return(__Video_Encode=Module.__Video_Encode=Module.asm._Video_Encode).apply(null,arguments)},__Video_Encode_YUV=Module.__Video_Encode_YUV=function(){return(__Video_Encode_YUV=Module.__Video_Encode_YUV=Module.asm._Video_Encode_YUV).apply(null,arguments)},__Video_VirtualBackground_Special_Action=Module.__Video_VirtualBackground_Special_Action=function(){return(__Video_VirtualBackground_Special_Action=Module.__Video_VirtualBackground_Special_Action=Module.asm._Video_VirtualBackground_Special_Action).apply(null,arguments)},__Qos_Sender_Send_Data_In_Main_Thread=Module.__Qos_Sender_Send_Data_In_Main_Thread=function(){return(__Qos_Sender_Send_Data_In_Main_Thread=Module.__Qos_Sender_Send_Data_In_Main_Thread=Module.asm._Qos_Sender_Send_Data_In_Main_Thread).apply(null,arguments)},__Video_Websocket_Speed=Module.__Video_Websocket_Speed=function(){return(__Video_Websocket_Speed=Module.__Video_Websocket_Speed=Module.asm._Video_Websocket_Speed).apply(null,arguments)},__Video_Start_Encode=Module.__Video_Start_Encode=function(){return(__Video_Start_Encode=Module.__Video_Start_Encode=Module.asm._Video_Start_Encode).apply(null,arguments)},__Video_Stop_Encode=Module.__Video_Stop_Encode=function(){return(__Video_Stop_Encode=Module.__Video_Stop_Encode=Module.asm._Video_Stop_Encode).apply(null,arguments)},__Request_Video_Qos_Data=Module.__Request_Video_Qos_Data=function(){return(__Request_Video_Qos_Data=Module.__Request_Video_Qos_Data=Module.asm._Request_Video_Qos_Data).apply(null,arguments)},__Video_Update_Format=Module.__Video_Update_Format=function(){return(__Video_Update_Format=Module.__Video_Update_Format=Module.asm._Video_Update_Format).apply(null,arguments)},__Video_Get_Sending_Status=Module.__Video_Get_Sending_Status=function(){return(__Video_Get_Sending_Status=Module.__Video_Get_Sending_Status=Module.asm._Video_Get_Sending_Status).apply(null,arguments)},__Video_Get_Encode_Codec_Info=Module.__Video_Get_Encode_Codec_Info=function(){return(__Video_Get_Encode_Codec_Info=Module.__Video_Get_Encode_Codec_Info=Module.asm._Video_Get_Encode_Codec_Info).apply(null,arguments)},__Video_Get_Decode_Codec_Info=Module.__Video_Get_Decode_Codec_Info=function(){return(__Video_Get_Decode_Codec_Info=Module.__Video_Get_Decode_Codec_Info=Module.asm._Video_Get_Decode_Codec_Info).apply(null,arguments)},__Video_Set_Data_Encryption=Module.__Video_Set_Data_Encryption=function(){return(__Video_Set_Data_Encryption=Module.__Video_Set_Data_Encryption=Module.asm._Video_Set_Data_Encryption).apply(null,arguments)},__Add_Video_Cooker_info=Module.__Add_Video_Cooker_info=function(){return(__Add_Video_Cooker_info=Module.__Add_Video_Cooker_info=Module.asm._Add_Video_Cooker_info).apply(null,arguments)},__Remove_Video_Cooker_Info=Module.__Remove_Video_Cooker_Info=function(){return(__Remove_Video_Cooker_Info=Module.__Remove_Video_Cooker_Info=Module.asm._Remove_Video_Cooker_Info).apply(null,arguments)},__Get_Video_Meat_Weight=Module.__Get_Video_Meat_Weight=function(){return(__Get_Video_Meat_Weight=Module.__Get_Video_Meat_Weight=Module.asm._Get_Video_Meat_Weight).apply(null,arguments)},__Set_Max_Receiving_Channel_Num=Module.__Set_Max_Receiving_Channel_Num=function(){return(__Set_Max_Receiving_Channel_Num=Module.__Set_Max_Receiving_Channel_Num=Module.asm._Set_Max_Receiving_Channel_Num).apply(null,arguments)},__update_sync_time=Module.__update_sync_time=function(){return(__update_sync_time=Module.__update_sync_time=Module.asm._update_sync_time).apply(null,arguments)},__release_video_receiving_channel=Module.__release_video_receiving_channel=function(){return(__release_video_receiving_channel=Module.__release_video_receiving_channel=Module.asm._release_video_receiving_channel).apply(null,arguments)},__change_hw_status=Module.__change_hw_status=function(){return(__change_hw_status=Module.__change_hw_status=Module.asm._change_hw_status).apply(null,arguments)},__rotate_video=Module.__rotate_video=function(){return(__rotate_video=Module.__rotate_video=Module.asm._rotate_video).apply(null,arguments)},__update_video_uplink_bandwidth_limitation_by_server=Module.__update_video_uplink_bandwidth_limitation_by_server=function(){return(__update_video_uplink_bandwidth_limitation_by_server=Module.__update_video_uplink_bandwidth_limitation_by_server=Module.asm._update_video_uplink_bandwidth_limitation_by_server).apply(null,arguments)},_free=Module._free=function(){return(_free=Module._free=Module.asm.free).apply(null,arguments)},__create_vb_thread=Module.__create_vb_thread=function(){return(__create_vb_thread=Module.__create_vb_thread=Module.asm._create_vb_thread).apply(null,arguments)},__create_vb_no_sab_thread=Module.__create_vb_no_sab_thread=function(){return(__create_vb_no_sab_thread=Module.__create_vb_no_sab_thread=Module.asm._create_vb_no_sab_thread).apply(null,arguments)},__signal_vb_thread_blur=Module.__signal_vb_thread_blur=function(){return(__signal_vb_thread_blur=Module.__signal_vb_thread_blur=Module.asm._signal_vb_thread_blur).apply(null,arguments)},__signal_vb_thread_bg=Module.__signal_vb_thread_bg=function(){return(__signal_vb_thread_bg=Module.__signal_vb_thread_bg=Module.asm._signal_vb_thread_bg).apply(null,arguments)},__signal_vb_thread_video_yuv=Module.__signal_vb_thread_video_yuv=function(){return(__signal_vb_thread_video_yuv=Module.__signal_vb_thread_video_yuv=Module.asm._signal_vb_thread_video_yuv).apply(null,arguments)},__signal_vb_thread_video_rgba=Module.__signal_vb_thread_video_rgba=function(){return(__signal_vb_thread_video_rgba=Module.__signal_vb_thread_video_rgba=Module.asm._signal_vb_thread_video_rgba).apply(null,arguments)},__signal_vb_thread_close=Module.__signal_vb_thread_close=function(){return(__signal_vb_thread_close=Module.__signal_vb_thread_close=Module.asm._signal_vb_thread_close).apply(null,arguments)},__update_video_cropping_mode=Module.__update_video_cropping_mode=function(){return(__update_video_cropping_mode=Module.__update_video_cropping_mode=Module.asm._update_video_cropping_mode).apply(null,arguments)},__collect_video_monitor_info=Module.__collect_video_monitor_info=function(){return(__collect_video_monitor_info=Module.__collect_video_monitor_info=Module.asm._collect_video_monitor_info).apply(null,arguments)},__request_nack_t_periodically_for_qos=Module.__request_nack_t_periodically_for_qos=function(){return(__request_nack_t_periodically_for_qos=Module.__request_nack_t_periodically_for_qos=Module.asm._request_nack_t_periodically_for_qos).apply(null,arguments)},__Sharing_Encode_Init=Module.__Sharing_Encode_Init=function(){return(__Sharing_Encode_Init=Module.__Sharing_Encode_Init=Module.asm._Sharing_Encode_Init).apply(null,arguments)},__Sharing_Encode_Try_Analysis=Module.__Sharing_Encode_Try_Analysis=function(){return(__Sharing_Encode_Try_Analysis=Module.__Sharing_Encode_Try_Analysis=Module.asm._Sharing_Encode_Try_Analysis).apply(null,arguments)},__Sharing_Encode_Uninit=Module.__Sharing_Encode_Uninit=function(){return(__Sharing_Encode_Uninit=Module.__Sharing_Encode_Uninit=Module.asm._Sharing_Encode_Uninit).apply(null,arguments)},__Sharing_Encode=Module.__Sharing_Encode=function(){return(__Sharing_Encode=Module.__Sharing_Encode=Module.asm._Sharing_Encode).apply(null,arguments)},__Request_Sharing_Qos_Data=Module.__Request_Sharing_Qos_Data=function(){return(__Request_Sharing_Qos_Data=Module.__Request_Sharing_Qos_Data=Module.asm._Request_Sharing_Qos_Data).apply(null,arguments)},__Sharing_Set_Data_Encryption=Module.__Sharing_Set_Data_Encryption=function(){return(__Sharing_Set_Data_Encryption=Module.__Sharing_Set_Data_Encryption=Module.asm._Sharing_Set_Data_Encryption).apply(null,arguments)},__Get_Sharing_Sending_Status=Module.__Get_Sharing_Sending_Status=function(){return(__Get_Sharing_Sending_Status=Module.__Get_Sharing_Sending_Status=Module.asm._Get_Sharing_Sending_Status).apply(null,arguments)},__Get_Codec_Info=Module.__Get_Codec_Info=function(){return(__Get_Codec_Info=Module.__Get_Codec_Info=Module.asm._Get_Codec_Info).apply(null,arguments)},__Sharing_Pause_Encode=Module.__Sharing_Pause_Encode=function(){return(__Sharing_Pause_Encode=Module.__Sharing_Pause_Encode=Module.asm._Sharing_Pause_Encode).apply(null,arguments)},__Sharing_Resume_Encode=Module.__Sharing_Resume_Encode=function(){return(__Sharing_Resume_Encode=Module.__Sharing_Resume_Encode=Module.asm._Sharing_Resume_Encode).apply(null,arguments)},__Sharing_Stop_Encode=Module.__Sharing_Stop_Encode=function(){return(__Sharing_Stop_Encode=Module.__Sharing_Stop_Encode=Module.asm._Sharing_Stop_Encode).apply(null,arguments)},__Sharing_Websocket_Speed=Module.__Sharing_Websocket_Speed=function(){return(__Sharing_Websocket_Speed=Module.__Sharing_Websocket_Speed=Module.asm._Sharing_Websocket_Speed).apply(null,arguments)},__Add_Sharing_Cooker_info=Module.__Add_Sharing_Cooker_info=function(){return(__Add_Sharing_Cooker_info=Module.__Add_Sharing_Cooker_info=Module.asm._Add_Sharing_Cooker_info).apply(null,arguments)},__Remove_Sharing_Cooker_Info=Module.__Remove_Sharing_Cooker_Info=function(){return(__Remove_Sharing_Cooker_Info=Module.__Remove_Sharing_Cooker_Info=Module.asm._Remove_Sharing_Cooker_Info).apply(null,arguments)},__Get_Sharing_Meat_Weight=Module.__Get_Sharing_Meat_Weight=function(){return(__Get_Sharing_Meat_Weight=Module.__Get_Sharing_Meat_Weight=Module.asm._Get_Sharing_Meat_Weight).apply(null,arguments)},__Set_Sharing_Encryption_Key_Directly=Module.__Set_Sharing_Encryption_Key_Directly=function(){return(__Set_Sharing_Encryption_Key_Directly=Module.__Set_Sharing_Encryption_Key_Directly=Module.asm._Set_Sharing_Encryption_Key_Directly).apply(null,arguments)},__Add_Roster_Info_Directly=Module.__Add_Roster_Info_Directly=function(){return(__Add_Roster_Info_Directly=Module.__Add_Roster_Info_Directly=Module.asm._Add_Roster_Info_Directly).apply(null,arguments)},__Add_Rev_Channel=Module.__Add_Rev_Channel=function(){return(__Add_Rev_Channel=Module.__Add_Rev_Channel=Module.asm._Add_Rev_Channel).apply(null,arguments)},__Remove_Rev_Channel=Module.__Remove_Rev_Channel=function(){return(__Remove_Rev_Channel=Module.__Remove_Rev_Channel=Module.asm._Remove_Rev_Channel).apply(null,arguments)},__update_sharing_uplink_bandwidth_limitation_by_server=Module.__update_sharing_uplink_bandwidth_limitation_by_server=function(){return(__update_sharing_uplink_bandwidth_limitation_by_server=Module.__update_sharing_uplink_bandwidth_limitation_by_server=Module.asm._update_sharing_uplink_bandwidth_limitation_by_server).apply(null,arguments)},__collect_sharing_monitor_info=Module.__collect_sharing_monitor_info=function(){return(__collect_sharing_monitor_info=Module.__collect_sharing_monitor_info=Module.asm._collect_sharing_monitor_info).apply(null,arguments)},__set_annotation_action=Module.__set_annotation_action=function(){return(__set_annotation_action=Module.__set_annotation_action=Module.asm._set_annotation_action).apply(null,arguments)},__request_nack_t_periodically_for_sharing_qos=Module.__request_nack_t_periodically_for_sharing_qos=function(){return(__request_nack_t_periodically_for_sharing_qos=Module.__request_nack_t_periodically_for_sharing_qos=Module.asm._request_nack_t_periodically_for_sharing_qos).apply(null,arguments)},__Change_Connect_Type_For_Sharing=Module.__Change_Connect_Type_For_Sharing=function(){return(__Change_Connect_Type_For_Sharing=Module.__Change_Connect_Type_For_Sharing=Module.asm._Change_Connect_Type_For_Sharing).apply(null,arguments)},___errno_location=Module.___errno_location=function(){return(___errno_location=Module.___errno_location=Module.asm.__errno_location).apply(null,arguments)},_OnVideoFrameOutputCallback=Module._OnVideoFrameOutputCallback=function(){return(_OnVideoFrameOutputCallback=Module._OnVideoFrameOutputCallback=Module.asm.OnVideoFrameOutputCallback).apply(null,arguments)},_OnEncodedVideoChunkOutputCallback=Module._OnEncodedVideoChunkOutputCallback=function(){return(_OnEncodedVideoChunkOutputCallback=Module._OnEncodedVideoChunkOutputCallback=Module.asm.OnEncodedVideoChunkOutputCallback).apply(null,arguments)},_htons=Module._htons=function(){return(_htons=Module._htons=Module.asm.htons).apply(null,arguments)},_ntohs=Module._ntohs=function(){return(_ntohs=Module._ntohs=Module.asm.ntohs).apply(null,arguments)},stackSave=Module.stackSave=function(){return(stackSave=Module.stackSave=Module.asm.stackSave).apply(null,arguments)},stackRestore=Module.stackRestore=function(){return(stackRestore=Module.stackRestore=Module.asm.stackRestore).apply(null,arguments)},stackAlloc=Module.stackAlloc=function(){return(stackAlloc=Module.stackAlloc=Module.asm.stackAlloc).apply(null,arguments)},___cxa_demangle=Module.___cxa_demangle=function(){return(___cxa_demangle=Module.___cxa_demangle=Module.asm.__cxa_demangle).apply(null,arguments)},___cxa_is_pointer_type=Module.___cxa_is_pointer_type=function(){return(___cxa_is_pointer_type=Module.___cxa_is_pointer_type=Module.asm.__cxa_is_pointer_type).apply(null,arguments)},dynCall_iijiiiiiiiiiii=Module.dynCall_iijiiiiiiiiiii=function(){return(dynCall_iijiiiiiiiiiii=Module.dynCall_iijiiiiiiiiiii=Module.asm.dynCall_iijiiiiiiiiiii).apply(null,arguments)},dynCall_iijiiiiiiiiii=Module.dynCall_iijiiiiiiiiii=function(){return(dynCall_iijiiiiiiiiii=Module.dynCall_iijiiiiiiiiii=Module.asm.dynCall_iijiiiiiiiiii).apply(null,arguments)},dynCall_iijiiiiiiiiiiii=Module.dynCall_iijiiiiiiiiiiii=function(){return(dynCall_iijiiiiiiiiiiii=Module.dynCall_iijiiiiiiiiiiii=Module.asm.dynCall_iijiiiiiiiiiiii).apply(null,arguments)},dynCall_iij=Module.dynCall_iij=function(){return(dynCall_iij=Module.dynCall_iij=Module.asm.dynCall_iij).apply(null,arguments)},dynCall_iiijii=Module.dynCall_iiijii=function(){return(dynCall_iiijii=Module.dynCall_iiijii=Module.asm.dynCall_iiijii).apply(null,arguments)},dynCall_iiiiiiiiij=Module.dynCall_iiiiiiiiij=function(){return(dynCall_iiiiiiiiij=Module.dynCall_iiiiiiiiij=Module.asm.dynCall_iiiiiiiiij).apply(null,arguments)},dynCall_iiij=Module.dynCall_iiij=function(){return(dynCall_iiij=Module.dynCall_iiij=Module.asm.dynCall_iiij).apply(null,arguments)},dynCall_iiiiiijiji=Module.dynCall_iiiiiijiji=function(){return(dynCall_iiiiiijiji=Module.dynCall_iiiiiijiji=Module.asm.dynCall_iiiiiijiji).apply(null,arguments)},dynCall_iiiiiiiiiiiij=Module.dynCall_iiiiiiiiiiiij=function(){return(dynCall_iiiiiiiiiiiij=Module.dynCall_iiiiiiiiiiiij=Module.asm.dynCall_iiiiiiiiiiiij).apply(null,arguments)},dynCall_viiiiiij=Module.dynCall_viiiiiij=function(){return(dynCall_viiiiiij=Module.dynCall_viiiiiij=Module.asm.dynCall_viiiiiij).apply(null,arguments)},dynCall_viji=Module.dynCall_viji=function(){return(dynCall_viji=Module.dynCall_viji=Module.asm.dynCall_viji).apply(null,arguments)},dynCall_iiiiiiji=Module.dynCall_iiiiiiji=function(){return(dynCall_iiiiiiji=Module.dynCall_iiiiiiji=Module.asm.dynCall_iiiiiiji).apply(null,arguments)},dynCall_iiiiijiji=Module.dynCall_iiiiijiji=function(){return(dynCall_iiiiijiji=Module.dynCall_iiiiijiji=Module.asm.dynCall_iiiiijiji).apply(null,arguments)},dynCall_iiiiiiiiiiij=Module.dynCall_iiiiiiiiiiij=function(){return(dynCall_iiiiiiiiiiij=Module.dynCall_iiiiiiiiiiij=Module.asm.dynCall_iiiiiiiiiiij).apply(null,arguments)},dynCall_iiiiiiiij=Module.dynCall_iiiiiiiij=function(){return(dynCall_iiiiiiiij=Module.dynCall_iiiiiiiij=Module.asm.dynCall_iiiiiiiij).apply(null,arguments)},dynCall_ji=Module.dynCall_ji=function(){return(dynCall_ji=Module.dynCall_ji=Module.asm.dynCall_ji).apply(null,arguments)},dynCall_jiiiiii=Module.dynCall_jiiiiii=function(){return(dynCall_jiiiiii=Module.dynCall_jiiiiii=Module.asm.dynCall_jiiiiii).apply(null,arguments)},dynCall_jiji=Module.dynCall_jiji=function(){return(dynCall_jiji=Module.dynCall_jiji=Module.asm.dynCall_jiji).apply(null,arguments)},dynCall_viijii=Module.dynCall_viijii=function(){return(dynCall_viijii=Module.dynCall_viijii=Module.asm.dynCall_viijii).apply(null,arguments)},dynCall_iiiiij=Module.dynCall_iiiiij=function(){return(dynCall_iiiiij=Module.dynCall_iiiiij=Module.asm.dynCall_iiiiij).apply(null,arguments)},dynCall_iiiiijj=Module.dynCall_iiiiijj=function(){return(dynCall_iiiiijj=Module.dynCall_iiiiijj=Module.asm.dynCall_iiiiijj).apply(null,arguments)},dynCall_iiiiiijj=Module.dynCall_iiiiiijj=function(){return(dynCall_iiiiiijj=Module.dynCall_iiiiiijj=Module.asm.dynCall_iiiiiijj).apply(null,arguments)};function run(e){function t(){calledRun||(calledRun=!0,Module.calledRun=!0,ABORT||(initRuntime(),Module.onRuntimeInitialized&&Module.onRuntimeInitialized(),postRun()))}e=e||arguments_,runDependencies>0||(preRun(),runDependencies>0||(Module.setStatus?(Module.setStatus("Running..."),setTimeout((function(){setTimeout((function(){Module.setStatus("")}),1),t()}),1)):t()))}if(Module.cwrap=cwrap,dependenciesFulfilled=function e(){calledRun||run(),calledRun||(dependenciesFulfilled=e)},Module.preInit)for("function"==typeof Module.preInit&&(Module.preInit=[Module.preInit]);Module.preInit.length>0;)Module.preInit.pop()();run();